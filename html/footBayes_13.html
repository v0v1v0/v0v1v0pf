<div class="container">

<table style="width: 100%;"><tr>
<td>stan_foot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit football models  with Stan</h2>

<h3>Description</h3>

<p>Stan football modelling for the most famous models:
double Poisson, bivariate Poisson, Skellam, student t, diagonal-inflated bivariate Poisson and zero-inflated Skellam.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stan_foot(
  data,
  model,
  predict,
  ranking,
  dynamic_type,
  prior,
  prior_sd,
  ind_home = "TRUE",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame, or a matrix containing the following mandatory items: season, home team, away team,
home goals, away goals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>The type of Stan model used to fit the data.
One among the following: <code>"double_pois"</code>,
<code>"biv_pois"</code>, <code>"skellam"</code>, <code>"student_t"</code>, <code>"diag_infl_biv_pois"</code>, <code>"zero_infl_skellam"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict</code></td>
<td>
<p>The number of out-of-sample matches. If missing, the function returns
the fit for the training set only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranking</code></td>
<td>
<p>Eventual numeric ranking provided for the teams in the dataset (e.g., the Coca-Cola Fifa ranking)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dynamic_type</code></td>
<td>
<p>One among <code>"weekly"</code> or <code>"seasonal"</code> for weekly dynamic parameters or seasonal
dynamic parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>The prior distribution for the team-specific abilities.
Possible choices: <code>normal</code>, <code>student_t</code>, <code>cauchy</code>, <code>laplace</code>.
See the <span class="pkg">rstanarm</span> for a deep overview and read the vignette <a href="http://mc-stan.org/rstanarm/articles/priors.html"><em>Prior
Distributions for rstanarm Models</em></a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_sd</code></td>
<td>
<p>The prior distribution for the team-specific standard deviations. See the <code>prior</code> argument for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ind_home</code></td>
<td>
<p>Home effect (default is <code>TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Optional parameters passed to the function
in the <b>rstan</b> package. It is possibly to specify <code>iter</code>, <code>chains</code>, <code>cores</code>, <code>refresh</code>, etc.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code class="reqn">(y^{H}_{n}, y^{A}_{n})</code> denote the
observed number of goals scored by the home
and the away team in the <code class="reqn">n</code>-th game,
respectively. A general bivariate Poisson model
allowing for goals' correlation
(Karlis &amp; Ntzoufras, 2003) is the following:
</p>
<p style="text-align: center;"><code class="reqn"> Y^H_n, Y^A_n| \lambda_{1n}, \lambda_{2n}, \lambda_{3n}  \sim \mathsf{BivPoisson}(\lambda_{1n}, \lambda_{2n}, \lambda_{3n})</code>
</p>

<p style="text-align: center;"><code class="reqn">\log(\lambda_{1n})  = \mu+att_{h_n} + def_{a_n}</code>
</p>

<p style="text-align: center;"><code class="reqn">\log(\lambda_{2n})  = att_{a_n} + def_{h_n}</code>
</p>

<p style="text-align: center;"><code class="reqn">\log(\lambda_{3n})  =\beta_0,</code>
</p>

<p>where the case <code class="reqn">\lambda_{3n}=0</code> reduces to
the double Poisson model (Baio &amp; Blangiardo, 2010).
<code class="reqn">\lambda_{1n}, \lambda_{2n}</code> represent the
scoring rates for the home and the away team,
respectively, where: <code class="reqn">\mu</code> is the home effect;
the parameters <code class="reqn">att_T</code> and
<code class="reqn">def_T</code> represent the attack and the
defence abilities,
respectively, for each team <code class="reqn">T</code>, <code class="reqn">T=1,\ldots,N_T</code>;
the nested indexes <code class="reqn">h_{n}, a_{n}=1,\ldots,N_T</code>
denote the home and the away team playing in the <code class="reqn">n</code>-th game,
respectively. Attack/defence parameters are imposed a
sum-to-zero constraint to achieve identifiability and
assigned some weakly-informative prior distributions:
</p>
<p style="text-align: center;"><code class="reqn">att_T \sim \mathcal{N}(\mu_{att}, \sigma_{att})</code>
</p>

<p style="text-align: center;"><code class="reqn">def_T \sim \mathcal{N}(\mu_{def}, \sigma_{def}),</code>
</p>

<p>with hyperparameters <code class="reqn">\mu_{att}, \sigma_{att}, \mu_{def}, \sigma_{def}</code>.
</p>
<p>Instead of using the marginal number of goals,
another alternative is to modelling directly
the score difference <code class="reqn">(y^{H}_{n}- y^{A}_{n})</code>.
We can use the Poisson-difference distribution
(or Skellam distribution) to model goal
difference in the <code class="reqn">n</code>-th match (Karlis &amp; Ntzoufras, 2009):
</p>
<p style="text-align: center;"><code class="reqn">y^{H}_{n}- y^{A}_{n}| \lambda_{1n}, \lambda_{2n} \sim PD(\lambda_{1n}, \lambda_{2n}),</code>
</p>

<p>and the scoring rates <code class="reqn">\lambda_{1n}, \lambda_{2n}</code> are
unchanged with respect to the bivariate/double Poisson model.
If we want to use a continue distribution, we can
use a student t distribution with 7 degrees of
freedom (Gelman, 2014):
</p>
<p style="text-align: center;"><code class="reqn">y^{H}_{n}- y^{A}_{n} \sim t(7, ab_{h_{n}}-ab_{a(n)}, \sigma_y)</code>
</p>

<p style="text-align: center;"><code class="reqn">ab_t \sim \mathcal{N}(\mu + b \times {prior\_score}_t, sigma_{ab}),</code>
</p>

<p>where <code class="reqn">ab_t</code> is the overall ability for
the <code class="reqn">t</code>-th team, whereas <code class="reqn">prior\_score_t</code>
is a prior measure of team's strength (for instance a
ranking).
</p>
<p>These model rely on the assumption of static parameters.
However, we could assume dynamics in the attach/defence
abilities (Owen, 2011; Egidi et al., 2018) in terms of weeks or seasons through the argument
<code>dynamic_type</code>. In such a framework, for a given
number of times <code class="reqn">1, \ldots, \mathcal{T}</code>, the models
above would be unchanged, but the priors for the abilities
parameters at each time <code class="reqn">\tau, \tau=2,\ldots, \mathcal{T},</code> would be:
</p>
<p style="text-align: center;"><code class="reqn">att_{T, \tau} \sim \mathcal{N}({att}_{T, \tau-1}, \sigma_{att})</code>
</p>

<p style="text-align: center;"><code class="reqn">def_{T, \tau} \sim \mathcal{N}({def}_{T, \tau-1}, \sigma_{def}),</code>
</p>

<p>whereas for <code class="reqn">\tau=1</code> we have:
</p>
<p style="text-align: center;"><code class="reqn">att_{T, 1} \sim \mathcal{N}(\mu_{att}, \sigma_{att})</code>
</p>

<p style="text-align: center;"><code class="reqn">def_{T, 1} \sim \mathcal{N}(\mu_{def}, \sigma_{def}).</code>
</p>

<p>Of course, the identifiability constraint must be imposed for
each time <code class="reqn">\tau</code>.
</p>
<p>The current version of the package allows for the fit of a
diagonal-inflated bivariate Poisson and a zero-inflated Skellam model in the
spirit of (Karlis &amp; Ntzoufras, 2003) to better capture draw occurrences. See the vignette for further details.
</p>


<h3>Value</h3>

<p>An object of S4 class, <code>stanfit-class</code>.
</p>


<h3>Author(s)</h3>

<p>Leonardo Egidi <a href="mailto:legidi@units.it">legidi@units.it</a>, Vasilis Palaskas <a href="mailto:vasilis.palaskas94@gmail.com">vasilis.palaskas94@gmail.com</a>.
</p>


<h3>References</h3>

<p>Baio, G. and Blangiardo, M. (2010). Bayesian hierarchical model for the prediction of football
results. Journal of Applied Statistics 37(2), 253-264.
</p>
<p>Egidi, L., Pauli, F., and Torelli, N. (2018). Combining historical data
and bookmakers' odds in modelling football scores. Statistical Modelling, 18(5-6), 436-459.
</p>
<p>Gelman, A. (2014). Stan goes to the World Cup. From
"Statistical Modeling, Causal Inference, and Social Science" blog.
</p>
<p>Karlis, D. and Ntzoufras, I. (2003). Analysis of sports data by using bivariate poisson models.
Journal of the Royal Statistical Society: Series D (The Statistician) 52(3), 381-393.
</p>
<p>Karlis, D. and Ntzoufras,I. (2009).  Bayesian modelling of football outcomes: Using
the Skellam's distribution for the goal difference. IMA Journal of Management Mathematics 20(2), 133-145.
</p>
<p>Owen, A. (2011). Dynamic Bayesian forecasting models
of football match outcomes with estimation of the
evolution variance parameter. IMA Journal of Management Mathematics, 22(2), 99-113.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
require(tidyverse)
require(dplyr)

### Use Italian Serie A from 2000 to 2002

data("italy")
italy &lt;- as_tibble(italy)
italy_2000_2002&lt;- italy %&gt;%
 dplyr::select(Season, home, visitor, hgoal,vgoal) %&gt;%
 dplyr::filter(Season=="2000" |  Season=="2001"| Season=="2002")


### Fit Stan models
## no dynamics, no predictions

fit1 &lt;- stan_foot(data = italy_2000_2002,
                model="double_pois") # double poisson
print(fit1, pars =c("home", "sigma_att",
                    "sigma_def"))

fit2 &lt;- stan_foot(data = italy_2000_2002,
                model="biv_pois")    # bivariate poisson
print(fit2, pars =c("home", "rho",
                    "sigma_att", "sigma_def"))

fit3 &lt;- stan_foot(data = italy_2000_2002,
                model="skellam")     # skellam
print(fit3, pars =c("home", "sigma_att",
                    "sigma_def"))

fit4 &lt;- stan_foot(data = italy_2000_2002,
                model="student_t")   # student_t
print(fit4, pars =c("home", "beta"))

## seasonal dynamics, no prediction

fit5 &lt;- stan_foot(data = italy_2000_2002,
                model="double_pois",
                dynamic_type ="seasonal") # double poisson
print(fit5, pars =c("home", "Sigma_att",
                    "Sigma_def"))

## seasonal dynamics, prediction for the last season

fit6 &lt;- stan_foot(data = italy_2000_2002,
                model="double_pois",
                dynamic_type ="seasonal",
                predict = 306) # double poisson
print(fit6, pars =c("home", "Sigma_att",
                    "Sigma_def"))

## other priors' options

fit_p &lt;- stan_foot(data = italy_2000_2002,
                   model="double_pois",
                   priors = student_t (4, 0, NULL),
                   prior_sd = laplace(0,1)) # double poisson with
                                            # student_t priors for teams abilities
                                            # and laplace prior for the hyper sds
print(fit_p,  pars = c("home", "sigma_att",
                    "sigma_def"))

## End(Not run)
</code></pre>


</div>