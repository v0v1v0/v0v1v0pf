<div class="container">

<table style="width: 100%;"><tr>
<td>panel</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Constructs a <code>fixest</code> panel data base</h2>

<h3>Description</h3>

<p>Constructs a <code>fixest</code> panel data base out of a data.frame which allows to use leads and lags
in <code>fixest</code> estimations and to create new variables from leads and lags if the data.frame
was also a <code>data.table::data.table</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">panel(data, panel.id, time.step = NULL, duplicate.method = c("none", "first"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data.frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>panel.id</code></td>
<td>
<p>The panel identifiers. Can either be: i) a one sided formula
(e.g. <code>panel.id = ~id+time</code>), ii) a character vector of length 2
(e.g. <code>panel.id=c('id', 'time')</code>, or iii) a character scalar of two variables
separated by a comma (e.g. <code>panel.id='id,time'</code>). Note that you can combine variables
with <code>^</code> only inside formulas (see the dedicated section in <code>feols</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.step</code></td>
<td>
<p>The method to compute the lags, default is <code>NULL</code> (which means
automatically set). Can be equal to: <code>"unitary"</code>, <code>"consecutive"</code>, <code>"within.consecutive"</code>,
or to a number. If <code>"unitary"</code>, then the largest common divisor between consecutive
time periods is used (typically if the time variable represents years, it will be 1).
This method can apply only to integer (or convertible to integer) variables.
If <code>"consecutive"</code>, then the time variable can be of any type: two successive
time periods represent a lag of 1. If <code>"witihn.consecutive"</code> then <strong>within a given id</strong>,
two successive time periods represent a lag of 1. Finally, if the time variable is numeric,
you can provide your own numeric time step.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>duplicate.method</code></td>
<td>
<p>If several observations have the same id and time values,
then the notion of lag is not defined for them. If <code>duplicate.method = "none"</code> (default)
and duplicate values are found, this leads to an error. You can use
<code>duplicate.method = "first"</code> so that the first occurrence of identical id/time
observations will be used as lag.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function allows you to use leads and lags in a <code>fixest</code> estimation without having to
provide the argument <code>panel.id</code>. It also offers more options on how to set the panel
(with the additional arguments 'time.step' and 'duplicate.method').
</p>
<p>When the initial data set was also a <code>data.table</code>, not all operations are supported and some may
dissolve the <code>fixest_panel</code>. This is the case when creating subselections of the initial data
with additional attributes (e.g. <code>pdt[x&gt;0, .(x, y, z)]</code> would dissolve the <code>fixest_panel</code>,
meaning only a data.table would be the result of the call).
</p>
<p>If the initial data set was also a <code>data.table</code>, then you can create new variables from lags
and leads using the functions <code>l</code> and <code>f</code>. See the example.
</p>


<h3>Value</h3>

<p>It returns a data base identical to the one given in input, but with an additional attribute:
“panel_info”. This attribute contains vectors used to efficiently
create lags/leads of the data. When the data is subselected, some bookeeping is performed
on the attribute “panel_info”.
</p>


<h3>Author(s)</h3>

<p>Laurent Berge
</p>


<h3>See Also</h3>

<p>The estimation methods <code>feols</code>, <code>fepois</code> and <code>feglm</code>.
</p>
<p>The functions <code>l</code> and <code>f</code> to create lags and leads within <code>fixest_panel</code> objects.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(base_did)

# Setting a data set as a panel...
pdat = panel(base_did, ~id+period)

# ...then using the functions l and f
est1 = feols(y~l(x1, 0:1), pdat)
est2 = feols(f(y)~l(x1, -1:1), pdat)
est3 = feols(l(y)~l(x1, 0:3), pdat)
etable(est1, est2, est3, order = c("f", "^x"), drop="Int")

# or using the argument panel.id
feols(f(y)~l(x1, -1:1), base_did, panel.id = ~id+period)

# You can use panel.id in various ways:
pdat = panel(base_did, ~id+period)
# is identical to:
pdat = panel(base_did, c("id", "period"))
# and also to:
pdat = panel(base_did, "id,period")

# l() and f() can also be used within a data.table:
if(require("data.table")){
  pdat_dt = panel(as.data.table(base_did), ~id+period)
  # Now since pdat_dt is also a data.table
  #   you can create lags/leads directly
  pdat_dt[, x1_l1 := l(x1)]
  pdat_dt[, c("x1_l1_fill0", "y_f2") := .(l(x1, fill = 0), f(y, 2))]
}


</code></pre>


</div>