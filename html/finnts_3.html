<div class="container">

<table style="width: 100%;"><tr>
<td>forecast_time_series</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Finn Forecast Framework</h2>

<h3>Description</h3>

<p>Calls the Finn forecast framework to automatically forecast any historical time series.
</p>


<h3>Usage</h3>

<pre><code class="language-R">forecast_time_series(
  run_info = NULL,
  input_data,
  combo_variables,
  target_variable,
  date_type,
  forecast_horizon,
  external_regressors = NULL,
  hist_start_date = NULL,
  hist_end_date = NULL,
  combo_cleanup_date = NULL,
  fiscal_year_start = 1,
  clean_missing_values = TRUE,
  clean_outliers = FALSE,
  back_test_scenarios = NULL,
  back_test_spacing = NULL,
  modeling_approach = "accuracy",
  forecast_approach = "bottoms_up",
  parallel_processing = NULL,
  inner_parallel = FALSE,
  num_cores = NULL,
  target_log_transformation = FALSE,
  negative_forecast = FALSE,
  fourier_periods = NULL,
  lag_periods = NULL,
  rolling_window_periods = NULL,
  recipes_to_run = NULL,
  pca = NULL,
  models_to_run = NULL,
  models_not_to_run = NULL,
  run_global_models = NULL,
  run_local_models = TRUE,
  run_ensemble_models = NULL,
  average_models = TRUE,
  max_model_average = 3,
  feature_selection = FALSE,
  weekly_to_daily = TRUE,
  seed = 123,
  run_model_parallel = FALSE,
  return_data = TRUE,
  run_name = "finnts_forecast"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>run_info</code></td>
<td>
<p>Run info using <code>set_run_info()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_data</code></td>
<td>
<p>A data frame or tibble of historical time series data. Can also include external regressors for both
historical and future data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>combo_variables</code></td>
<td>
<p>List of column headers within input data to be used to separate individual time series.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_variable</code></td>
<td>
<p>The column header formatted as a character value within input data you want to forecast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date_type</code></td>
<td>
<p>The date granularity of the input data. Finn accepts the following as a character string
day, week, month, quarter, year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forecast_horizon</code></td>
<td>
<p>Number of periods to forecast into the future.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>external_regressors</code></td>
<td>
<p>List of column headers within input data to be used as features in multivariate models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hist_start_date</code></td>
<td>
<p>Date value of when your input_data starts. Default of NULL is to use earliest date value in
input_data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hist_end_date</code></td>
<td>
<p>Date value of when your input_data ends.Default of NULL is to use the latest date value in
input_data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>combo_cleanup_date</code></td>
<td>
<p>Date value to remove individual time series that don't contain non-zero values after
that specified date. Default of NULL is to not remove any time series and attempt to forecast all of them.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fiscal_year_start</code></td>
<td>
<p>Month number of start of fiscal year of input data, aids in building out date features.
Formatted as a numeric value. Default of 1 assumes fiscal year starts in January.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean_missing_values</code></td>
<td>
<p>If TRUE, cleans missing values. Only impute values for missing data within an
existing series, and does not add new values onto the beginning or end, but does provide a value of 0 for said
values. Turned off when running hierarchical forecasts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean_outliers</code></td>
<td>
<p>If TRUE, outliers are cleaned and inputted with values more in line with historical data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>back_test_scenarios</code></td>
<td>
<p>Number of specific back test folds to run when determining the best model.
Default of NULL will automatically choose the number of back tests to run based on historical data size,
which tries to always use a minimum of 80% of the data when training a model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>back_test_spacing</code></td>
<td>
<p>Number of periods to move back for each back test scenario. Default of NULL moves back 1
period at a time for year, quarter, and month data. Moves back 4 for week and 7 for day data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modeling_approach</code></td>
<td>
<p>How Finn should approach your data. Current default and only option is 'accuracy'. In the
future this could evolve to other areas like optimizing for interpretability over accuracy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forecast_approach</code></td>
<td>
<p>How the forecast is created. The default of 'bottoms_up' trains models for each individual
time series. 'grouped_hierarchy' creates a grouped time series to forecast at while 'standard_hierarchy' creates
a more traditional hierarchical time series to forecast, both based on the hts package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel_processing</code></td>
<td>
<p>Default of NULL runs no parallel processing and
forecasts each individual time series one after another. 'local_machine'
leverages all cores on current machine Finn is running on. 'spark'
runs time series in parallel on a spark cluster in Azure Databricks or
Azure Synapse.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inner_parallel</code></td>
<td>
<p>Run components of forecast process inside a specific
time series in parallel. Can only be used if parallel_processing is
set to NULL or 'spark'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_cores</code></td>
<td>
<p>Number of cores to run when parallel processing is set up. Used when running parallel computations
on local machine or within Azure. Default of NULL uses total amount of cores on machine minus one. Can't be greater
than number of cores on machine minus 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_log_transformation</code></td>
<td>
<p>If TRUE, log transform target variable before training models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>negative_forecast</code></td>
<td>
<p>If TRUE, allow forecasts to dip below zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fourier_periods</code></td>
<td>
<p>List of values to use in creating fourier series as features. Default of NULL automatically chooses
these values based on the date_type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lag_periods</code></td>
<td>
<p>List of values to use in creating lag features. Default of NULL automatically chooses these values
based on date_type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rolling_window_periods</code></td>
<td>
<p>List of values to use in creating rolling window features. Default of NULL automatically
chooses these values based on date type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recipes_to_run</code></td>
<td>
<p>List of recipes to run on multivariate models that can run different recipes. A value of NULL runs
all recipes, but only runs the R1 recipe for weekly and daily date types, and also for global models to prevent memory issues.
A value of "all" runs all recipes, regardless of date type or if it's a local/global model. A list like c("R1") or c("R2")
would only run models with the R1 or R2 recipe.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pca</code></td>
<td>
<p>If TRUE, run principle component analysis on any lagged features to speed up model run time. Default of NULL runs
PCA on day and week date types across all local multivariate models, and also for global models across all date types.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>models_to_run</code></td>
<td>
<p>List of models to run. Default of NULL runs all models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>models_not_to_run</code></td>
<td>
<p>List of models not to run, overrides values in models_to_run. Default of NULL doesn't turn off
any model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_global_models</code></td>
<td>
<p>If TRUE, run multivariate models on the entire data set (across all time series) as a global model.
Can be override by models_not_to_run. Default of NULL runs global models for all date types except week and day.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_local_models</code></td>
<td>
<p>If TRUE, run models by individual time series as local models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_ensemble_models</code></td>
<td>
<p>If TRUE, run ensemble models. Default of NULL runs ensemble models only for quarter and month
date types.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average_models</code></td>
<td>
<p>If TRUE, create simple averages of individual models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_model_average</code></td>
<td>
<p>Max number of models to average together. Will create model averages for 2 models up until input value
or max number of models ran.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_selection</code></td>
<td>
<p>Implement feature selection before model training</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weekly_to_daily</code></td>
<td>
<p>If TRUE, convert a week forecast down to day by evenly splitting across each day of week. Helps when aggregating
up to higher temporal levels like month or quarter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Set seed for random number generator. Numeric value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_model_parallel</code></td>
<td>
<p>If TRUE, runs model training in parallel, only works when parallel_processing is set to
'local_machine' or 'spark'. Recommended to use a value of FALSE and leverage
inner_parallel for new features.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_data</code></td>
<td>
<p>If TRUE, return the forecast results. Used to be backwards compatible
with previous finnts versions. Recommended to use a value of FALSE and leverage
<code>get_forecast_data()</code> for new features.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_name</code></td>
<td>
<p>Name used when submitting jobs to external compute like Azure Batch. Formatted as a character string.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of three separate data sets: the future forecast, the back test results, and the best model per time series.
</p>


<h3>Examples</h3>

<pre><code class="language-R">

run_info &lt;- set_run_info()

finn_forecast &lt;- forecast_time_series(
  run_info = run_info,
  input_data = m750 %&gt;% dplyr::rename(Date = date),
  combo_variables = c("id"),
  target_variable = "value",
  date_type = "month",
  forecast_horizon = 3,
  back_test_scenarios = 6,
  run_model_parallel = FALSE,
  models_to_run = c("arima", "ets", "snaive"),
  return_data = FALSE
)

fcst_tbl &lt;- get_forecast_data(run_info)

models_tbl &lt;- get_trained_models(run_info)

</code></pre>


</div>