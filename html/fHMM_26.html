<div class="container">

<table style="width: 100%;"><tr>
<td>fit_model</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Model fitting</h2>

<h3>Description</h3>

<p>This function fits a hidden Markov model via numerical likelihood
maximization.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit_model(
  data,
  controls = data[["controls"]],
  fit = list(),
  runs = 10,
  origin = FALSE,
  accept = 1:3,
  gradtol = 0.01,
  iterlim = 100,
  print.level = 0,
  steptol = 0.01,
  ncluster = 1,
  seed = NULL,
  verbose = TRUE,
  initial_estimate = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An object of class <code>fHMM_data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li>
</ul>
<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>A <code>list</code> of controls specifying the model fitting.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>runs</code>, defines the number of numerical optimization runs,
</p>
</li>
<li> <p><code>origin</code>, defines initialization at the true parameters,
</p>
</li>
<li> <p><code>accept</code>, defines the set of accepted optimization runs,
</p>
</li>
<li> <p><code>gradtol</code>, defines the gradient tolerance,
</p>
</li>
<li> <p><code>iterlim</code>, defines the iteration limit,
</p>
</li>
<li> <p><code>print.level</code>, defines the level of printing,
</p>
</li>
<li> <p><code>steptol</code>, defines the minimum allowable relative step length.
</p>
</li>
</ul>
<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values, see below.
</p>
<p>Specifications in <code>fit</code> override individual specifications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>runs</code></td>
<td>
<p>An <code>integer</code>, setting the number of randomly initialized
optimization runs of the model likelihood from which the best one is selected
as the final model.
</p>
<p>By default, <code>runs = 10</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>origin</code></td>
<td>
<p>Only relevant for simulated data, i.e., if the <code>data</code> control is
<code>NA</code>.
</p>
<p>In this case, a <code>logical</code>. If <code>origin = TRUE</code> the optimization is
initialized at the true parameter values.
This sets <code>run = 1</code> and <code>accept = 1:5</code>.
</p>
<p>By default, <code>origin = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>accept</code></td>
<td>
<p>An <code>integer</code> (vector), specifying which optimization runs are
accepted based on the output code of <code>nlm</code>.
</p>
<p>By default, <code>accept = 1:3</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gradtol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the gradient tolerance, passed on
to <code>nlm</code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterlim</code></td>
<td>
<p>A positive <code>integer</code> value, specifying the iteration limit, passed on
to <code>nlm</code>.
</p>
<p>By default, <code>iterlim = 100</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.level</code></td>
<td>
<p>One of <code>0</code>, <code>1</code>, and <code>2</code> to control the verbosity of the
numerical likelihood optimization, passed on to <code>nlm</code>.
</p>
<p>By default, <code>print.level = 0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>steptol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the step tolerance, passed on
to <code>nlm</code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncluster</code></td>
<td>
<p>Set the number of clusters for parallel optimization runs to reduce
optimization time.
By default, <code>ncluster = 1</code> (no clustering).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Set a seed for the generation of initial values.
No seed by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Set to <code>TRUE</code> to print progress messages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial_estimate</code></td>
<td>
<p>Optionally defines an initial estimate for the numerical likelihood
optimization. Good initial estimates can improve the optimization process.
Can be:
</p>

<ul>
<li> <p><code>NULL</code> (the default), in this case
</p>

<ul>
<li>
<p> applies a heuristic to calculate a good initial estimate
</p>
</li>
<li>
<p> or uses the true parameter values (if available and
<code>data$controls$origin</code> is <code>TRUE</code>)
</p>
</li>
</ul>
</li>
<li>
<p> or an object of class <code>parUncon</code> (i.e., a <code>numeric</code> of
unconstrained model parameters), for example the estimate of a
previously fitted model (i.e. the element <code>model$estimate</code>).
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Multiple optimization runs starting from different initial values are
computed in parallel if <code>ncluster &gt; 1</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>fHMM_model</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">### 2-state HMM with normal distributions

# set specifications
controls &lt;- set_controls(
  states = 2, sdds = "normal", horizon = 100, runs = 10
)

# define parameters
parameters &lt;- fHMM_parameters(controls, mu = c(-1, 1), seed = 1)

# sample data
data &lt;- prepare_data(controls, true_parameter = parameters, seed = 1)

# fit model
model &lt;- fit_model(data, seed = 1)

# inspect fit
summary(model)
plot(model, "sdds")

# decode states
model &lt;- decode_states(model)
plot(model, "ts")

# predict
predict(model, ahead = 5)

</code></pre>


</div>