<div class="container">

<table style="width: 100%;"><tr>
<td>INFCvpe</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate bole volume or tree phytomass for individual stems, with associated accuracy info</h2>

<h3>Description</h3>

<p>Using the functions developed for INFC 2005 (the 2005 Italian national forest inventory),
stem volume or tree compartment phytomass are estimated for each
<code>(EPPOcode, dbh.cm, htot.m)</code> input tuple.
Accompaining the main value, accuracy estimates are returned, as attributes.
The functions are documented in Tabacchi et al. (2011a)
</p>


<h3>Usage</h3>

<pre><code class="language-R">INFCvpe(EPPOcode, dbh.cm, htot.m, quantity = "vol")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>EPPOcode</code></td>
<td>
<p>Character vector of tree species code, as defined in EPPO database,
(See <code>INFCspecies()</code> and  <a href="https://gd.eppo.int">https://gd.eppo.int</a> )</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dbh.cm</code></td>
<td>
<p>Numeric vector of stem/s breast height diameter (in cm)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>htot.m</code></td>
<td>
<p>Numeric vector of tree total height/s (in m). Length equal to dbh.cm vector or one.
In this case same value will be replicated for all dbh.cm entries</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantity</code></td>
<td>
<p>(default = <code>vol</code>) Character vector specifying required quantity,
one of <code>c("vol", "dw1" : "dw4")</code>. Use <code>qantities()</code> to retrieve
codes definitions. Length equal to dbh.cm vector or one.
In this case same value will be replicated for all dbh.cm entries</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Output value will have following added attributes with estimates accuracy evaluations
for each stem:</p>

<ol>
<li> <p><code>pag</code> - page number, referred to original source
</p>
</li>
<li> <p><code>wrv</code> - weighted residual variance
</p>
</li>
<li> <p><code>Var_ea</code> - variance for an estimated average<br>
or variance for 'confidence interval' estimation,
see <code>prediction.lm(.., interval = "confidence")</code>
</p>
</li>
<li> <p><code>Var_ie</code> - variance for an individual estimate<br>
or 'prediction variance', (see <code>prediction.lm(.., interval = "prediction")</code> and
Freese, 1964 - in:Tabacchi, 2011
</p>
</li>
<li> <p><code>InDomain</code> - logical indicating whether the (dbh, htot) point lies
out of the domain explored by the experimental data (see 'INFCtabulate()')
</p>
</li>
</ol>
<h3>Value</h3>

<p>The functions returns a Numeric vector of the same length
of the <code>dbh.cm</code> argument, with accuracy info as attributes
</p>


<h3>See Also</h3>

<p><code>INFCvpe_summarise()</code> and functions related to <code>INFCvpe_sum()</code> to produce
estimates of aggregates with better accuracy evaluation
</p>


<h3>Examples</h3>

<pre><code class="language-R"># COMPARE WITH Tabacchi (2011a) page 25 ----
(v &lt;- INFCvpe("ACRCA", dbh.cm = 22, htot.m = 14))
# [1] 252.9581
# attr(,"pag")
# [1] 231
# attr(,"wrv")
# [1] 2.271e-05
# attr(,"Var_ea")
# [1] 33.17182
# attr(,"Var_ie")
# [1] 1075.883
# attr(,"InDomain")
# [1] TRUE

# Standard Error of the Estimate
see &lt;- sqrt(attr(v, "Var_ie"))
# Degrees of freedom
df &lt;- INFCcatalog$n_oss[INFCcatalog$pag == attr(v, "pag")] -
      INFCcatalog$n_par[INFCcatalog$pag == attr(v, "pag")]
# confidence level
p &lt;- 95/100
# Confidence Interval Half Width
cihw &lt;- qt(1-(1-p)/2, df) * see
cat(" *** Volume confidence interval (p = ", p*100, "%) is [", round(v, 1),
    " +/- ", round(cihw, 1), "] dm^3\n", sep = "")

# ESTIMATION OF PHYTOMASS ----
Quantities[5,] %&gt;% as.data.frame()
#   quantity         quantity_definition
# 1      dw4 phytomass of the whole tree [kg]
tree_phy &lt;- INFCvpe(c("ACRCA", "ALUCO"),
                    dbh.cm = c(22, 15),
                    htot.m = c(14, 16),
                    quantity = "dw4")
tree_phy
# [1] 185.1291  87.7970
# attr(,"pag")
# [1] 231 245
# attr(,"wrv")
# [1] 3.142e-05 2.104e-05
# attr(,"Var_ea")
# [1] 45.89002  9.12407
# attr(,"Var_ie")
# [1] 1488.5135  281.8072
# attr(,"InDomain")
# [1] TRUE TRUE

# PROCESSING A TALLY DATA-FRAME ----
tst_vol &lt;- ForIT_test_data %&gt;%
  dplyr::mutate(vol = INFCvpe(specie, d130, h_dendro),
                OutOfDomain = !attr(vol, "InDomain"))
tst_vol %&gt;%
  dplyr::filter(OutOfDomain)
tst_vol %&gt;%
  dplyr::filter(UC == "U1")

# SUMS AND direct ACCUARACY AGGREGATION (instead of via ?INFCvpeSUM) ----
df &lt;- function(pag) return(
  INFCcatalog %&gt;%
    dplyr::right_join(tibble::tibble(pag = !!pag), by = "pag") %&gt;%
    dplyr::transmute(df = n_oss - n_par) %&gt;%
    purrr::pluck(1)
)
p &lt;- 95/100
tst_vol %&gt;%
  dplyr::mutate(cihw = qt(1-(1-p)/2,
                          df(attr(vol, "pag"))) *
                  sqrt(attr(vol, "Var_ie"))
  ) %&gt;%
  dplyr::filter(!OutOfDomain) %&gt;%
  dplyr::group_by(specie) %&gt;%
  dplyr::summarise(.groups = "drop",
                   est = sum(vol),
                   cihw = sqrt(sum(cihw^2)),
  ) %&gt;%
  dplyr::left_join(INFCspecies %&gt;% dplyr::select(EPPOcode, pag),
                   by = c("specie" = "EPPOcode")) %&gt;%
  dplyr::left_join(INFCcatalog %&gt;% dplyr::select(pag, section),
                   by = "pag") %&gt;% 
  dplyr::select(-c(specie, pag)) %&gt;% 
  dplyr::rename(specie = section) %&gt;% 
  dplyr::mutate(dplyr::across(c("est", "cihw"), ~round(.x, 1))) %&gt;% 
  dplyr::arrange(specie) %&gt;%
  dplyr::select(specie, est, cihw) -&gt; tab
tab[c(2,1,3),] %&gt;% 
  t()
rm(tst_vol, tab, df)

</code></pre>


</div>