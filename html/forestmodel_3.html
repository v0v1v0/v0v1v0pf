<div class="container">

<table style="width: 100%;"><tr>
<td>forest_model</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Produce a forest plot based on a regression model</h2>

<h3>Description</h3>

<p>Produce a forest plot based on a regression model
</p>


<h3>Usage</h3>

<pre><code class="language-R">forest_model(
  model,
  panels = default_forest_panels(model, factor_separate_line = factor_separate_line),
  covariates = NULL,
  exponentiate = NULL,
  funcs = NULL,
  factor_separate_line = FALSE,
  format_options = forest_model_format_options(),
  theme = theme_forest(),
  limits = NULL,
  breaks = NULL,
  return_data = FALSE,
  recalculate_width = TRUE,
  recalculate_height = TRUE,
  model_list = NULL,
  merge_models = FALSE,
  exclude_infinite_cis = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>regression model produced by <code>lm</code>,
<code>glm</code>, <code>coxph</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>panels</code></td>
<td>
<p><code>list</code> with details of the panels that make up the plot (See Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>a character vector optionally listing the variables to include in the plot
(defaults to all variables)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exponentiate</code></td>
<td>
<p>whether the numbers on the x scale should be exponentiated for plotting</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>funcs</code></td>
<td>
<p>optional list of functions required for formatting <code>panels$display</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor_separate_line</code></td>
<td>
<p>whether to show the factor variable name on a separate line</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format_options</code></td>
<td>
<p>formatting options as a list as generated by <code>forest_model_format_options</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theme</code></td>
<td>
<p>theme to apply to the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limits</code></td>
<td>
<p>limits of the forest plot on the X-axis (taken as the range of the data
by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>breaks to appear on the X-axis (note these will be exponentiated
if <code>exponentiate == TRUE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_data</code></td>
<td>
<p>return the data to produce the plot as well as the plot itself</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recalculate_width</code></td>
<td>
<p><code>TRUE</code> to recalculate panel widths using the current device
or the desired plot width in inches</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recalculate_height</code></td>
<td>
<p><code>TRUE</code> to shrink text size using the current device
or the desired plot height in inches</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_list</code></td>
<td>
<p>list of models to incorporate into a single forest plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>merge_models</code></td>
<td>
<p>if 'TRUE', merge all models in one section.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_infinite_cis</code></td>
<td>
<p>whether to exclude points and confidence intervals
that go to positive or negative infinity from plotting. They will still be
displayed as text. Defaults to <code>TRUE</code>, since otherwise plot is malformed</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function takes the model output from one of the common model functions in
R (e.g. <code>lm</code>, <code>glm</code>,
<code>coxph</code>). If a <code>label</code> attribute was present on any of the
columns in the original data (e.g. from the <code>labelled</code> package),
this label is used in preference to the column name.
</p>
<p>The <code>panels</code> parameter is a <code>list</code> of lists each of which have an element
<code>width</code>
and, optionally, <code>item</code>, <code>display</code>, <code>display_na</code>,
<code>heading</code>, <code>hjust</code> and <code>fontface</code>. <code>item</code> can be <code>"forest"</code> for the forest
plot (exactly one required) or <code>"vline"</code> for a vertical line.
<code>display</code> indicates which column to display as text. It can be a quoted variable name
or a formula. The column display can include the standard ones produced by
<code>tidy</code> and in addition
<code>variable</code> (the term in the model; for factors this is the bare variable without the  level),
<code>level</code> (the level of factors),
<code>reference</code> (TRUE for the reference level of a factor). For <code>coxph</code>
models, there will also be <code>n_events</code> for the number of events in the group with
that level of the factor and <code>person_time</code> for the person-time in that group.
The function <code>trans</code> is definded to be the
transformation between the coefficients and the scales (e.g. <code>exp</code>). Other functions not
in base R can be provided as a <code>list</code> with the parameter <code>funcs</code>.
<code>display_na</code> allows for an alternative display for NA terms within <code>estimate</code>.
</p>


<h3>Value</h3>

<p>A ggplot ready for display or saving, or (with <code>return_data == TRUE</code>,
a <code>list</code> with the parameters to call <code>panel_forest_plot</code> in the
element <code>plot_data</code> and the ggplot itself in the element <code>plot</code>)
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library("survival")
library("dplyr")
pretty_lung &lt;- lung %&gt;%
  transmute(time,
    status,
    Age = age,
    Sex = factor(sex, labels = c("Male", "Female")),
    ECOG = factor(lung$ph.ecog),
    `Meal Cal` = meal.cal
  )

print(forest_model(coxph(Surv(time, status) ~ ., pretty_lung)))

# Example with custom panels

panels &lt;- list(
  list(width = 0.03),
  list(width = 0.1, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.1, display = ~level),
  list(width = 0.05, display = ~n, hjust = 1, heading = "N"),
  list(width = 0.05, display = ~n_events, width = 0.05, hjust = 1, heading = "Events"),
  list(
    width = 0.05,
    display = ~ replace(sprintf("%0.1f", person_time / 365.25), is.na(person_time), ""),
    heading = "Person-\nYears", hjust = 1
  ),
  list(width = 0.03, item = "vline", hjust = 0.5),
  list(
    width = 0.55, item = "forest", hjust = 0.5, heading = "Hazard ratio", linetype = "dashed",
    line_x = 0
  ),
  list(width = 0.03, item = "vline", hjust = 0.5),
  list(width = 0.12, display = ~ ifelse(reference, "Reference", sprintf(
    "%0.2f (%0.2f, %0.2f)",
    trans(estimate), trans(conf.low), trans(conf.high)
  )), display_na = NA),
  list(
    width = 0.05,
    display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)),
    display_na = NA, hjust = 1, heading = "p"
  ),
  list(width = 0.03)
)
forest_model(coxph(Surv(time, status) ~ ., pretty_lung), panels)

data_for_lm &lt;- tibble(
  x = rnorm(100, 4),
  y = rnorm(100, 3, 0.5),
  z = rnorm(100, 2, 2),
  outcome = 3 * x - 2 * y + 4 * z + rnorm(100, 0, 0.1)
)

print(forest_model(lm(outcome ~ ., data_for_lm)))

data_for_logistic &lt;- data_for_lm %&gt;% mutate(
  outcome = (0.5 * (x - 4) * (y - 3) * (z - 2) + rnorm(100, 0, 0.05)) &gt; 0.5
)

print(forest_model(glm(outcome ~ ., binomial(), data_for_logistic)))
</code></pre>


</div>