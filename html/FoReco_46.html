<div class="container">

<table style="width: 100%;"><tr>
<td>ctmo</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cross-temporal middle-out reconciliation</h2>

<h3>Description</h3>

<p>The cross-temporal middle-out forecast reconciliation combines top-down
(cttd) and bottom-up (ctbu) methods in the cross-temporal framework for
genuine hierarchical/grouped time series. Given the base forecasts of an
intermediate cross-sectional level <code class="reqn">l</code> and aggregation order <code class="reqn">k</code>,
it performs
</p>

<ul>
<li>
<p> a top-down approach for the aggregation orders <code class="reqn">\geq k</code> and
cross-sectional levels <code class="reqn">\geq l</code>;
</p>
</li>
<li>
<p> a bottom-up approach, otherwise.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">ctmo(base, agg_mat, agg_order, id_rows = 1, order = max(agg_order),
     weights, tew = "sum", normalize = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>base</code></td>
<td>
<p>A (<code class="reqn">n_l \times hk</code>) numeric matrix containing the <code class="reqn">l</code>-level
base forecasts of temporal aggregation order <code class="reqn">k</code>; <code class="reqn">n_l</code> is the number of variables at
level <code class="reqn">l</code>, <code class="reqn">k</code> is an aggregation order (a factor of <code class="reqn">m</code>, and <code class="reqn">1&lt;k&lt;m</code>),
<code class="reqn">m</code> is the max aggregation order, and <code class="reqn">h</code> is the forecast horizon for the
lowest frequency time series.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agg_mat</code></td>
<td>
<p>A (<code class="reqn">n_a \times n_b</code>) numeric matrix representing the cross-sectional
aggregation matrix. It maps the <code class="reqn">n_b</code> bottom-level (free)
variables into the <code class="reqn">n_a</code> upper (constrained) variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agg_order</code></td>
<td>
<p>Highest available sampling frequency per seasonal cycle (max. order
of temporal aggregation, <code class="reqn">m</code>), or a vector representing a subset of <code class="reqn">p</code> factors
of <code class="reqn">m</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id_rows</code></td>
<td>
<p>A numeric vector indicating the <code class="reqn">l</code>-level rows of <code>agg_mat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>The intermediate fixed aggregation order <code class="reqn">k</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>A (<code class="reqn">n_b \times hm</code>) numeric matrix containing the proportions for each
high-frequency bottom time series; <code class="reqn">n_b</code> is the total number of high-frequency
bottom variables, <code class="reqn">m</code> is the max aggregation order, and <code class="reqn">h</code> is the forecast horizon
for the lowest frequency time series.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tew</code></td>
<td>
<p>A string specifying the type of temporal aggregation. Options include:
"<code>sum</code>" (simple summation, <em>default</em>), "<code>avg</code>" (average),
"<code>first</code>" (first value of the period), and "<code>last</code>"
(last value of the period).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normalize</code></td>
<td>
<p>If <code>TRUE</code> (<em>default</em>), the <code>weights</code> will sum to 1.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A (<code class="reqn">n \times h(k^\ast+m)</code>) numeric matrix of cross-temporal reconciled forecasts.
</p>


<h3>See Also</h3>

<p>Middle-out reconciliation: 
<code>csmo()</code>,
<code>temo()</code>
</p>
<p>Cross-temporal framework: 
<code>ctboot()</code>,
<code>ctbu()</code>,
<code>ctcov()</code>,
<code>ctlcc()</code>,
<code>ctrec()</code>,
<code>cttd()</code>,
<code>cttools()</code>,
<code>iterec()</code>,
<code>tcsrec()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(123)
# Aggregation matrix for Z = X + Y, X = XX + XY and Y = YX + YY
A &lt;- matrix(c(1,1,1,1,1,1,0,0,0,0,1,1), 3, byrow = TRUE)
# (2 x 6) base forecasts matrix (simulated), forecast horizon = 3
# and intermediate aggregation order k = 2 (max agg order = 4)
baseL2k2 &lt;- rbind(rnorm(3*2, 5), rnorm(3*2, 5))

# Same weights for different forecast horizons, agg_order = 4
fix_weights &lt;- matrix(runif(4*4), 4, 4)
reco &lt;- ctmo(base = baseL2k2, id_rows = 2:3, agg_mat = A,
             order = 2, agg_order = 4, weights = fix_weights)

# Different weights for different forecast horizons
h_weights &lt;- matrix(runif(4*4*3), 4, 3*4)
recoh &lt;- ctmo(base = baseL2k2, id_rows = 2:3, agg_mat = A,
             order = 2, agg_order = 4, weights = h_weights)

</code></pre>


</div>