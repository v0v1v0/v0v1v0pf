<div class="container">

<table style="width: 100%;"><tr>
<td>set_controls</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Define and validate model specifications</h2>

<h3>Description</h3>

<p>This function defines and validates specifications for model estimation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">set_controls(
  controls = list(),
  hierarchy = FALSE,
  states = if (!hierarchy) 2 else c(2, 2),
  sdds = if (!hierarchy) "normal" else c("normal", "normal"),
  horizon = if (!hierarchy) 100 else c(100, 30),
  period = NA,
  data = NA,
  file = NA,
  date_column = if (!hierarchy) "Date" else c("Date", "Date"),
  data_column = if (!hierarchy) "Close" else c("Close", "Close"),
  from = NA,
  to = NA,
  logreturns = if (!hierarchy) FALSE else c(FALSE, FALSE),
  merge = function(x) mean(x),
  fit = list(),
  runs = 10,
  origin = FALSE,
  accept = 1:3,
  gradtol = 0.01,
  iterlim = 100,
  print.level = 0,
  steptol = 0.01
)

validate_controls(controls)

## S3 method for class 'fHMM_controls'
print(x, ...)

## S3 method for class 'fHMM_controls'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>controls</code></td>
<td>
<p>Either a <code>list</code> or an object of class <code>fHMM_controls</code>.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>hierarchy</code>, defines an hierarchical HMM,
</p>
</li>
<li> <p><code>states</code>, defines the number of states,
</p>
</li>
<li> <p><code>sdds</code>, defines the state-dependent distributions,
</p>
</li>
<li> <p><code>horizon</code>, defines the time horizon,
</p>
</li>
<li> <p><code>period</code>, defines a flexible, periodic fine-scale time horizon,
</p>
</li>
<li> <p><code>data</code>, a <code>list</code> of controls that define the data,
</p>
</li>
<li> <p><code>fit</code>, a <code>list</code> of controls that define the model fitting
</p>
</li>
</ul>
<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values.
</p>
<p>Important: Specifications in <code>controls</code> always override individual
specifications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hierarchy</code></td>
<td>
<p>A <code>logical</code>, set to <code>TRUE</code> for an hierarchical HMM.
</p>
<p>If <code>hierarchy = TRUE</code>, some of the other controls must be specified for
the coarse-scale and the fine-scale layer.
</p>
<p>By default, <code>hierarchy = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>states</code></td>
<td>
<p>An <code>integer</code>, the number of states of the underlying Markov chain.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>states</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>states = 2</code> if <code>hierarchy = FALSE</code> and
<code>states = c(2, 2)</code> if <code>hierarchy = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdds</code></td>
<td>
<p>A <code>character</code>, specifying the state-dependent distribution. One of
</p>

<ul>
<li> <p><code>"normal"</code> (the normal distribution),
</p>
</li>
<li> <p><code>"lognormal"</code> (the log-normal distribution),
</p>
</li>
<li> <p><code>"t"</code> (the t-distribution),
</p>
</li>
<li> <p><code>"gamma"</code> (the gamma distribution),
</p>
</li>
<li> <p><code>"poisson"</code> (the Poisson distribution).
</p>
</li>
</ul>
<p>The distribution parameters, i.e. the
</p>

<ul>
<li>
<p> mean <code>mu</code>,
</p>
</li>
<li>
<p> standard deviation <code>sigma</code> (not for the Poisson distribution),
</p>
</li>
<li>
<p> degrees of freedom <code>df</code> (only for the t-distribution),
</p>
</li>
</ul>
<p>can be fixed via, e.g., <code>"t(df = 1)"</code> or
<code>"gamma(mu = 0, sigma = 1)"</code>.
To fix different values of a parameter for different states, separate by
"|", e.g. <code>"poisson(mu = 1|2|3)"</code>.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>sdds</code> must be a <code>vector</code> of length 2.
The first entry corresponds to the coarse-scale layer, while the second entry
corresponds to the fine-scale layer.
</p>
<p>By default, <code>sdds = "normal"</code> if <code>hierarchy = FALSE</code> and
<code>sdds = c("normal", "normal")</code> if <code>hierarchy = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>horizon</code></td>
<td>
<p>A <code>numeric</code>, specifying the length of the time horizon.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>horizon</code> must be a <code>vector</code> of length
2. The first entry corresponds to the coarse-scale layer, while the second
entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>horizon = 100</code> if <code>hierarchy = FALSE</code> and
<code>horizon = c(100, 30)</code> if <code>hierarchy = TRUE</code>.
</p>
<p>If <code>data</code> is specified (i.e., not <code>NA</code>), the first entry of
<code>horizon</code> is ignored and the (coarse-scale) time horizon is defined by
available data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>period</code></td>
<td>
<p>Only relevant if <code>hierarchy = TRUE</code>.
</p>
<p>In this case, a <code>character</code> which specifies a flexible, periodic
fine-scale time horizon and can be one of
</p>

<ul>
<li> <p><code>"w"</code> for a week,
</p>
</li>
<li> <p><code>"m"</code> for a month,
</p>
</li>
<li> <p><code>"q"</code> for a quarter,
</p>
</li>
<li> <p><code>"y"</code> for a year.
</p>
</li>
</ul>
<p>By default, <code>period = NA</code>. If <code>period</code> is not <code>NA</code>, it
overrules <code>horizon[2]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Either <code>NA</code>, in which case data is simulated (the default), or a
<code>list</code> of controls specifying the empirical data set.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>file</code>, defines the data set,
</p>
</li>
<li> <p><code>date_column</code>, defines the date column,
</p>
</li>
<li> <p><code>data_column</code>, defines the data column,
</p>
</li>
<li> <p><code>from</code>, defines a lower date limit,
</p>
</li>
<li> <p><code>to</code>, defines an upper date limit,
</p>
</li>
<li> <p><code>logreturns</code>, defines a data transformation to log-returns,
</p>
</li>
<li> <p><code>merge</code>, defines the merging for coarse-scale observations.
</p>
</li>
</ul>
<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values, see below.
</p>
<p>Specifications in <code>data</code> override individual specifications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>A <code>data.frame</code> with data and dates for modeling.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>file</code> can be a <code>list</code> of
length 2. The first entry is a <code>data.frame</code> and provides the data for
the coarse-scale layer, while the second entry corresponds to the fine-scale
layer. If <code>file</code> is a single <code>data.frame</code>, then the same
<code>data.frame</code> is used for both layers.
</p>
<p>Alternatively, it can be a <code>character</code> (of length two), the path to a
.csv-file with financial data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date_column</code></td>
<td>
<p>A <code>character</code>, the name of the column in <code>file</code> with dates.
</p>
<p>If <code>hierarchy = TRUE</code> and <code>file</code> is a <code>list</code> of two
<code>data.frame</code>s, <code>data_column</code> must be a <code>vector</code> of
length 2. The first entry corresponds to the coarse-scale layer, while the
second entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>date_column = "Date"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_column</code></td>
<td>
<p>A <code>character</code>, the name of the column in <code>file</code> with observations.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>data_column</code> must be a <code>vector</code> of
length 2. The first entry corresponds to the coarse-scale layer, while the
second entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>data_column = "Close"</code> if <code>hierarchy = FALSE</code> and
<code>data_column = c("Close", "Close")</code> if <code>hierarchy = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>A <code>character</code> of the format <code>"YYYY-MM-DD"</code>, setting a lower
date limit. No lower limit if <code>from = NA</code> (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>A <code>character</code> of the format <code>"YYYY-MM-DD"</code>, setting an upper
date limit. No lower limit if <code>to = NA</code> (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logreturns</code></td>
<td>
<p>A <code>logical</code>, if <code>TRUE</code> the data is transformed to log-returns.
</p>
<p>If <code>hierarchy = TRUE</code>, <code>logreturns</code> must be a <code>vector</code> of
length 2. The first entry corresponds to the coarse-scale layer, while the
second entry corresponds to the fine-scale layer.
</p>
<p>By default, <code>logreturns = FALSE</code> if <code>hierarchy = FALSE</code> and
<code>logreturns = c(FALSE, FALSE)</code> if <code>hierarchy = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>merge</code></td>
<td>
<p>Only relevant if <code>hierarchy = TRUE</code>.
</p>
<p>In this case, a <code>function</code>
which merges an input numeric vector of fine-scale data <code>x</code> into one
coarse-scale observation. For example,
</p>

<ul>
<li> <p><code>merge = function(x) mean(x)</code> (default) defines the mean of the
fine-scale data as the coarse-scale observation,
</p>
</li>
<li> <p><code>merge = function(x) mean(abs(x))</code> for the mean of the
absolute values,
</p>
</li>
<li> <p><code>merge = function(x) sum(abs(x))</code> for the sum of the
absolute values,
</p>
</li>
<li> <p><code>merge = function(x) (tail(x, 1) - head(x, 1)) / head(x, 1)</code> for
the relative change of the first to the last fine-scale observation.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>A <code>list</code> of controls specifying the model fitting.
</p>
<p>The <code>list</code> can contain the following elements, which are described
in more detail below:
</p>

<ul>
<li> <p><code>runs</code>, defines the number of numerical optimization runs,
</p>
</li>
<li> <p><code>origin</code>, defines initialization at the true parameters,
</p>
</li>
<li> <p><code>accept</code>, defines the set of accepted optimization runs,
</p>
</li>
<li> <p><code>gradtol</code>, defines the gradient tolerance,
</p>
</li>
<li> <p><code>iterlim</code>, defines the iteration limit,
</p>
</li>
<li> <p><code>print.level</code>, defines the level of printing,
</p>
</li>
<li> <p><code>steptol</code>, defines the minimum allowable relative step length.
</p>
</li>
</ul>
<p>Either none, all, or selected elements can be specified.
</p>
<p>Unspecified parameters are set to their default values, see below.
</p>
<p>Specifications in <code>fit</code> override individual specifications.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>runs</code></td>
<td>
<p>An <code>integer</code>, setting the number of randomly initialized
optimization runs of the model likelihood from which the best one is selected
as the final model.
</p>
<p>By default, <code>runs = 10</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>origin</code></td>
<td>
<p>Only relevant for simulated data, i.e., if the <code>data</code> control is
<code>NA</code>.
</p>
<p>In this case, a <code>logical</code>. If <code>origin = TRUE</code> the optimization is
initialized at the true parameter values.
This sets <code>run = 1</code> and <code>accept = 1:5</code>.
</p>
<p>By default, <code>origin = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>accept</code></td>
<td>
<p>An <code>integer</code> (vector), specifying which optimization runs are
accepted based on the output code of <code>nlm</code>.
</p>
<p>By default, <code>accept = 1:3</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gradtol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the gradient tolerance, passed on
to <code>nlm</code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterlim</code></td>
<td>
<p>A positive <code>integer</code> value, specifying the iteration limit, passed on
to <code>nlm</code>.
</p>
<p>By default, <code>iterlim = 100</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.level</code></td>
<td>
<p>One of <code>0</code>, <code>1</code>, and <code>2</code> to control the verbosity of the
numerical likelihood optimization, passed on to <code>nlm</code>.
</p>
<p>By default, <code>print.level = 0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>steptol</code></td>
<td>
<p>A positive <code>numeric</code> value, specifying the step tolerance, passed on
to <code>nlm</code>.
</p>
<p>By default, <code>gradtol = 0.01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x, object</code></td>
<td>
<p>An object of class <code>fHMM_controls</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Currently not used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See the <a href="https://loelschlaeger.de/fHMM/articles/">vignette on controls</a>
for more details.
</p>


<h3>Value</h3>

<p>An object of class <code>fHMM_controls</code>, which is a <code>list</code> that contains
model and estimation specifications.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># 2-state HMM with t-distributions for simulated data
set_controls(
  states = 2,   # the number of states
  sdds   = "t", # the state-dependent distribution
  runs   = 50   # the number of optimization runs
)

# 3-state HMM with normal distributions for the DAX closing prices
set_controls(
  states      = 3,
  sdds        = "normal",
  file        = download_data("^GDAXI"), # the data set
  date_column = "Date",                   # the column with the dates
  data_column = "Close"                   # the column with the data
)

# hierarchical HMM with Gamma and Poisson state distributions
set_controls(
  hierarchy = TRUE,                  # defines a hierarchy
  states    = c(3, 2),               # coarse scale and fine scale states
  sdds      = c("gamma", "poisson"), # distributions for both layers
  horizon   = c(100, NA),            # 100 simulated coarse-scale data points 
  period    = "m"                    # monthly simulated fine-scale data
)

# hierarchical HMM with data from .csv-file
set_controls(
  hierarchy = TRUE,
  states    = c(3, 2),
  sdds      = c("t", "t"),
  file      = c(               
    system.file("extdata", "dax.csv", package = "fHMM"),
    system.file("extdata", "dax.csv", package = "fHMM")
  ),
  date_column = c("Date", "Date"), 
  data_column = c("Close", "Close"),
  logreturns  = c(TRUE, TRUE)
)

</code></pre>


</div>