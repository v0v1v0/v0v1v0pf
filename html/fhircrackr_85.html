<div class="container">

<table style="width: 100%;"><tr>
<td>fhir_sample_resources</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Randomly sample resources from a FHIR server</h2>

<h3>Description</h3>

<p>Downloads a random sample of resources of a given resource type from a FHIR server. The resources can be further constrained
using FHIR search parameters.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fhir_sample_resources(
  base_url,
  resource,
  parameters = NULL,
  username = NULL,
  password = NULL,
  token = NULL,
  add_headers = NULL,
  sample_size = 20,
  seed = 1,
  verbose = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>base_url</code></td>
<td>
<p>A character vector of length one specifying the base URL of the FHIR server, e.g. <code>"http://hapi.fhir.org/baseR4"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resource</code></td>
<td>
<p>A character vector of length one or fhir_resource_type object with the resource type to be downloaded, e.g. <code>"Patient"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameters</code></td>
<td>
<p>Optional. Either a length 1 character vector containing properly formatted FHIR search parameters, e.g.
<code>"gender=male&amp;_summary=count"</code> or a named list or named character vector e.g. <code>list(gender="male", "_summary"="count")</code>
or <code>c(gender="male", "_summary"="count")</code>. Note that parameter names beginning with <code style="white-space: pre;">⁠_⁠</code> have to be put in quotation marks!</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>username</code></td>
<td>
<p>A character vector of length one containing the username for basic authentication.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>password</code></td>
<td>
<p>A character vector of length one containing the password for basic authentication.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token</code></td>
<td>
<p>A character vector of length one or object of class httr::Token, for bearer token authentication (e.g. OAuth2). See <code>fhir_authenticate()</code>
for how to create this.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_headers</code></td>
<td>
<p>A named character vector of custom headers to add to the HTTP request, e.g. <code>c(myHeader = "somevalue")</code> or
<code>c(firstHeader = "value1", secondHeader = "value2")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_size</code></td>
<td>
<p>A integer of length 1 containing the number of resources to sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>A integer of length 1 containing the seed for the random generator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>An integer of length 1 containing the level of verbosity. Defaults to 1.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function performs three steps to draw a random sample of resources from a FHIR server:
</p>

<ol>
<li>
<p> Count how many resources matching the type <code>resource</code> and the search parameters in <code>parameters</code> are found on the server. This is done to assert that the desired <code>sample_size</code>
is bigger than the number of resources it is drawn from. This step can also be performed individually using <code>fhir_count_resource()</code>.
</p>
</li>
<li>
<p> Extract the resource (aka logical) IDs of all requested resources (without downloading the resources completely).
This step can be also be performed individually using <code>fhir_get_resource_ids()</code>
</p>
</li>
<li>
<p> Draw a random sample of size <code>sample_size</code> from the vector of resource IDs and download the corresponding set of resources from the server.
This can also be done individually using <code>fhir_sample_resources_by_ids()</code>
</p>
</li>
</ol>
<p>The actual download of the resources is done by <code>fhir_get_resources_by_ids()</code>. This function will attempt to download the resources using a
FHIR search request via POST where the IDs are part of the body. See <code>fhir_search()</code> for details. If this fails
(e.g. because the server doesn't allow POST operations), the function falls back on a GET request. If the set of IDs is too long to fit
into one GET request (i.e. if the request gets longer than 2083 characters), it will be spread across several requests.
</p>
<p>For more information on authentication options, please see the help page of <code>fhir_search()</code>
</p>


<h3>Value</h3>

<p>A fhir_bundle_list containing randomly sampled resources.
</p>


<h3>See Also</h3>

<p><code>fhir_search()</code>, <code>fhir_sample_resources_by_ids()</code>, <code>fhir_get_resources_by_ids()</code>, <code>fhir_count_resource()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">

#the try({}, silent = TRUE) statement is only there to catch errors when the server is down
#you can skip it when the server is reachable

try({

#how many resources are on the server?
count &lt;- fhir_count_resource(
  base_url    = 'https://hapi.fhir.org/baseR4',
  resource    = "Patient",
  parameters  = "gender=female")

#randomly sample 30 of them
bundles &lt;- fhir_sample_resources(
  base_url    = 'https://hapi.fhir.org/baseR4',
  resource    = "Patient",
  parameters  = "gender=female",
  sample_size = 30,
  seed        = 1)

bundles

}, silent = TRUE)

</code></pre>


</div>