<div class="container">

<table style="width: 100%;"><tr>
<td>scramblase_assay_input_template</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>scramblase_assay_plot</h2>

<h3>Description</h3>

<p>Functions for the presentation and evaluaton of dithionite 
scramblase assays
</p>


<h3>Usage</h3>

<pre><code class="language-R">scramblase_assay_input_template(
  path = "scramblase_assay_input_template.txt",
  input_directory = NULL,
  overwrite = FALSE
)

scramblase_assay_plot(
  x,
  scale_to = c("model", "data"),
  ppr_scale_factor = 0.65,
  force_through_origin = TRUE,
  generation_of_algorithm = c(2, 1),
  split_by_experiment = TRUE,
  r_bar = 88,
  sigma_r_bar = 28
)

scramblase_assay_stats(
  x,
  scale_to = c("model", "data"),
  ppr_scale_factor = 0.65,
  force_through_origin = TRUE,
  generation_of_algorithm = c(2, 1),
  split_by_experiment = TRUE,
  r_bar = 88,
  sigma_r_bar = 28
)

scramblase_assay_traces(
  x,
  ppr_scale_factor = 0.65,
  time_min_sec = NA_real_,
  time_max_sec = NA_real_,
  adjust = TRUE,
  timepoint_of_measurement = 400,
  n_averaging = 10,
  annotate_traces = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p><code>character</code> object giving the path of an <b>empty</b>
template for a spreadsheet that can provide <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_directory</code></td>
<td>
<p>if not <code>NULL</code>, <code>character</code> object
giving the path to a directory where spectrometer output resides for the
prepopulation of the template spreadsheet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p><code>logical</code> object allowing to overwrite existing
template paths.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p><code>data.frame</code> or path to a tab delimited file 
representing it (see "Details").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale_to</code></td>
<td>
<p>Defines the source of <code>ymax</code>, defaulting to 
<code>model</code>. See "Details".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppr_scale_factor</code></td>
<td>
<p><code>numeric</code> object providing a scale factor
to adjust internally calculated <code>Protein per Phospholipid (mg/mmol)</code>
ratios (<code>PPR</code>; see "Details").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force_through_origin</code></td>
<td>
<p><code>logical</code> indicating whether to force 
the fitted curve(s) to penetrate the origin (defaulting to <code>TRUE</code>). See
"Details".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>generation_of_algorithm</code></td>
<td>
<p>Either <code>2</code> or <code>1</code>
(<code>numeric</code>; defaulting to <code>2</code>). See "Details".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split_by_experiment</code></td>
<td>
<p>A single <code>logical</code>, indicating whether or
not calculations and plots will treat experimental series from different
experiments separately (<code>TRUE</code>, default) or whether data from all
experiments included is used for a single calculation/plot per experimental
series (<code>FALSE</code>). While the former emphasizes reproducibility, the
latter likely produces a more reliable fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_bar</code></td>
<td>
<p>A <code>numeric</code>, representing the average radius of the
liposomes used in the assay. Only used in <code>generatio_of_algorithm = 2</code>
and defaulting to <code>88</code> (see Ploier et al. 2016 for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_r_bar</code></td>
<td>
<p>A <code>numeric</code>, representing the standard
deviationaverage of the radius distribution  of the liposomes used in the
assay. Only used in <code>generatio_of_algorithm = 2</code> and defaulting to
<code>28</code> (see Ploier et al. 2016 for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_min_sec</code></td>
<td>
<p>A single <code>numeric</code>. If given, 
<code>scramblase_assay_traces</code> produces a time/x axis trimmed to
this value (in seconds).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_max_sec</code></td>
<td>
<p>A single <code>numeric</code>. If given, 
<code>scramblase_assay_traces</code> produces a time/x axis trimmed to
this value (in seconds).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>A single <code>logical</code>, indicating whether (default) or 
not spectral traces to be plotted are algorithmically aligned at the time
point of dithionite addition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timepoint_of_measurement</code></td>
<td>
<p>A <code>numeric</code> indicating the time
(in sec) at which fluorescence extrema are calculated (DEPENDENT ON
<code>adjust</code>!).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_averaging</code></td>
<td>
<p>A <code>numeric</code> indicating the number of
data points used for extrema calculations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annotate_traces</code></td>
<td>
<p>A <code>logical</code> idicating whether fluorescence
traces should be annotated.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>data.frame</code> accepted by the majority of the 
functions a an <code>R</code> object or path to a corresponding file (<code>x</code>) 
must have the following <b>mandatory</b> columns:
</p>

<dl>
<dt>
<code>Path</code>:</dt>
<dd>
<p>Paths to existing and readable <code>ASCII</code> output files 
of a fluorimeter. See <code>parse_fluorimeter_output</code> for details and
supported formats.</p>
</dd>
<dt>
<code>Protein Reconstituted (mg)</code>:</dt>
<dd>
<p>Self-explanatory. In the case of
<code>scramblase_assay_traces</code> <strong>ONLY</strong> this may be abused by
taking <code>character</code> values rather than the usually required
<code>numeric</code>s. Handy when e.g. plotting traces for "Liposomes"
and "Proteoliposomes", rather than defined PPRs.</p>
</dd>
</dl>
<p>Further (<b>facultative</b>) columns are:
</p>

<dl>
<dt>
<code>Fluorescence Assay Vol. w/o DT (ul)</code>:</dt>
<dd>
<p>Volume of the 
fluorescence assay prior to addition of ditihionite (defaulting to
<code>2000</code>).</p>
</dd>
<dt>
<code>Fluorescence Assay Vol. with DT (ul)</code>:</dt>
<dd>
<p>Volume of the 
fluorescence assay after the addition ditihionite (defaulting to
<code>2040</code>).</p>
</dd>
<dt>
<code>Lipid in Reconstitution (mmol)</code>:</dt>
<dd>
<p>Self-explanatory. For the 
standard phospholipid experiment defaulting to <code>0.0045</code> (1 ml of a 
4.5 mM solution).</p>
</dd>
<dt>
<code>Timepoint of Measurement (s)</code>:</dt>
<dd>
<p>The time to determine terminal 
fluorescence, calculated from the point when dithionite is added, in
seconds, defaulting to <code>400</code>).</p>
</dd>
<dt>
<code>Experiment</code>:</dt>
<dd>
<p>Identifier for any given experiment. Used for 
<code>facet_wrap</code> during generation of <code>ggplot</code> output.
All data with one <code>Experiment</code> identifier ends up on one plot/facet.</p>
</dd>
<dt>
<code>Experimental Series</code>:</dt>
<dd>
<p>Identifier for a given series/graph (e.g.
<code>Extract</code> and <code>Depleted Extract</code>). Used by <code>color</code> during 
generation of <code>ggplot</code> output to differentiate lines in the
same plot/facet.</p>
</dd>
</dl>
<p>Based on Goren et al. (2014) and Ploier et al. (2016) data is processed as
follows (the majority of the processing is split off into the internal
function <code>scramblase_assay_calculations</code>):
</p>

<ul>
<li>
<p>Input is format checked and defaults are injected for facultative 
parameters/columns as appropriate (see input <code>data.frame</code> 
format above). The internal function 
<code>scramblase_assay_input_validation</code> supplies this 
functionality.
</p>
</li>
<li>
<p>Fluorescence spectra are parsed using 
<code>parse_fluorimeter_output</code>. This includes automated 
determination of when dithionite was added to the sample using 
<span class="pkg">pracma</span>-supplied methodology and resetting the acquisition time 
accordingly (<code>0</code> henceforth corresponds to the time of addition).
</p>
</li>
<li>
<p>Pre-dithionite-addition <code>Baseline Fluorescence</code> is determined for
each spectrum by averaging (<code>median</code>) over the 10 
values preceding dithionite addition.
</p>
</li>
<li>
<p>Post-dithinonite-addition <code>Minimum Fluorescence</code> is determined 
for each spectrum by averaging (<code>median</code>) over the last ten
datapoints <code class="reqn">\leq 400\,\mbox{s}</code> (or 
<code>Timepoint of Measurement (s)</code>, see above).
</p>
</li>
<li>
<p>The <code>Minimum Fluorescence</code> is volume-corrected based on 
<code>Reaction Volume w/o DT (ul)</code> and <code>Reaction Volume with DT (ul)</code>
(see above).
</p>
</li>
<li>
<p>For each spectrum/datapoint a measured <code>Fluorescence Reduction</code> 
is calculated as 
</p>
<p style="text-align: center;"><code class="reqn">1 - \left(\frac{\mbox{\small Minimum Fluorescence}}{\mbox{\small Baseline Fluorescence}}\right)</code>
</p>

</li>
<li>
<p>A <code>Relative Fluorescence Reduction</code> is calculated in comparison
to the liposomes-only/no-protein control).
</p>
</li>
<li>
<p>A <code>Protein per Phospholipid (mg/mmol)</code> ratio (<code>PPR</code>) is 
calculated. If <code>ppr_scale_factor</code> is not <code>NULL</code>, the value is
scaled (divided) by that value to account for liposomes that remain
inaccessible to reconstitution with scramblase molecules.
</p>
</li>
<li>
<p>Depending on <code>split_by_experiment</code>, data are <code>split</code> 
for parallel treatment using either <code>Experimental Series</code>
(<code>split_by_experiment = TRUE</code>) or a combined
<code>Experimental Series</code>/<code>Experiment</code>
(<code>split_by_experiment = FALSE</code>) identifier (see above).
</p>
</li>
<li>
<p>A probability for a liposome holding <code class="reqn">\geq 1</code> scramblase 
molecules is calculated using 
</p>
<p style="text-align: center;"><code class="reqn">\frac{y-y_0}{y_{\mbox{\scriptsize max}}-y_0}</code>
</p>

<p>where <code class="reqn">y</code> is the <code>Relative Fluorescence Reduction</code> and <code class="reqn">y_0</code>
is the <code>Relative Fluorescence Reduction</code> in an experiment without
addition of protein extract. Depending on the <code>scale_to</code> parameter, 
<code class="reqn">y_{\mbox{\scriptsize max}}</code> is either the maximal <code>Relative Fluorescence Reduction</code> 
in the series (<code>scale_to = "data"</code>) or derived from a 
mono-exponential fit to the data (<code>scale_to = "model"</code>). The latter 
(default) is a precaution for the case where the protein/phospholipid
titration did not reach the plateau of the saturation curve.
</p>
</li>
<li>
<p>A monoexponential curve is fitted using <code>nlsLM</code>.
</p>
<p>If <code>generation_of_algorithm</code> is <code>1</code>, the underlying formula is
derived from Goren et al. (2014) and data is fitted to either
</p>
<p style="text-align: center;"><code class="reqn">p(\geq 1)=b\cdot(1-e^{-\frac{\mbox{\tiny PPR}}{a}})</code>
</p>
 
<p>(if <code>force_through_origin = TRUE</code>; default) or
</p>
<p style="text-align: center;"><code class="reqn">p(\geq 1)=b-c\cdot e^{-\frac{\mbox{\tiny PPR}}{a}}</code>
</p>

<p>(if <code>force_through_origin = FALSE</code>). The latter implies more degrees
of freedom and occasionaly results in better fits to experimental data.
Mechanistic implication, however, are unclear.
</p>
<p>If <code>generation_of_algorithm</code> is <code>2</code> (default), the more
elaborate model put forth in Ploier et al. (2016) is employed, using
either
</p>
<p style="text-align: center;"><code class="reqn">p(\geq 1)=b\cdot(\frac{1}{\sqrt{1+\sigma^2\cdot a \cdot x}})\cdot exp(\frac{-\bar{r}^2\cdot a \cdot x}{1+\sigma^2\cdot a\cdot x})</code>
</p>

<p>(if <code>force_through_origin = TRUE</code>; default) or
</p>
<p style="text-align: center;"><code class="reqn">p(\geq 1)=b-c\cdot(\frac{1}{\sqrt{1+\sigma^2\cdot a \cdot x}})\cdot exp(\frac{-\bar{r}^2\cdot a \cdot x}{1+\sigma^2\cdot a\cdot x})</code>
</p>

<p>(if <code>force_through_origin = FALSE</code>).
</p>
</li>
<li>
<p>Data <code>split</code> apart above are recombined and a 
<code>ggplot</code> object is assembled with the following layers:
</p>

<ul>
<li>
<p>Lines (<code>geom_line</code>) representing the monoexponential
fit(s). <code>color</code> is used to differentiate 
<code>Experimental Series</code>.
</p>
</li>
<li>
<p>If <code>generation_of_algorithm</code> is <code>1</code>, segments
(<code>geom_segment</code>) representing the <code>PPR</code>
at which the fit constant <code class="reqn">a</code> is equal to <code>PPR</code>. This 
<code class="reqn">\tau</code> value has the implication that at this <code>PPR</code> all 
vesicles on average have one scramblase and 63% have one or more 
(i.e. are active). <code>color</code> is used to differentiate 
<code>Experimental Series</code>. Where <code>generation_of_algorithm</code> is
<code>2</code>, interpretation of <code class="reqn">a</code> is less obvious and this layer is
thus ommited in the plot.
</p>
</li>
<li>
<p>Points (<code>geom_point</code>) representing the corresponding 
datapoints. <code>color</code> is used to differentiate 
<code>Experimental Series</code>.
</p>
</li>
<li>
<p>Plots are finally <code>facet_wrap</code>ed by <code>Experiment</code> 
(if <code>split_by_experiment = TRUE</code>) and labels adjusted
cosmetically.</p>
</li>
</ul>
</li>
</ul>
<h3>Value</h3>

<p><code>scramblase_assay_traces</code> and <code>scramblase_assay_plot</code> return 
<code>ggplot</code> objects representing the raw fluorescence traces and a
complete PPR plot, respectively. <code>scramblase_assay_input_template</code> 
generates a tab-delimited <code>ASCII</code> file in the file system and invisibly
returns the path name. <code>scramblase_assay_stats</code> assembles (and prints) 
assay statistics as a <code>data.frame</code>.
</p>


<h3>Author(s)</h3>

<p>Johannes Graumann
</p>


<h3>References</h3>

<p>Menon, I., Huber, T., Sanyal, S., Banerjee, S., Barre, P., Canis, 
S., Warren, J.D., Hwa, J., Sakmar, T.P., and Menon, A.K. (2011)
&lt;DOI:10.1016/j.cub.2010.12.031&gt;
</p>
<p>Goren, M.A., Morizumi, T., Menon, I., Joseph, J.S., Dittman, J.S., 
Cherezov, V., Stevens, R.C., Ernst, O.P., and Menon, A.K. (2014)
&lt;DOI:10.1038/ncomms6115&gt;
</p>
<p>Ploier, B., Caro, L.N., Morizumi, T., Pandey, K., Pearring, J.N.,
Goren, M.A., Finnemann, S.C., Graumann, J., Arshavsky, V.Y., Dittman, J.S.,
Ernst, O.P., Menon, A.K. (2016). &lt;DOI:10.1038/ncomms12832&gt;
</p>


<h3>See Also</h3>

<p><code>parse_fluorimeter_output</code> <code>nlsLM</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(magrittr)
library(ggplot2)
# Extract example data
analysis_dir &lt;- file.path(tempdir(), "flippant-case-study")
extract_case_study_data(analysis_dir)
template_file &lt;- file.path(analysis_dir, "inputTable.txt")
# Plot the spectral traces
scramblase_assay_traces(
  template_file,
  time_max_sec = 350,
  timepoint_of_measurement = 350)
# Plot the PPR plot(s) faceting by experiment
scramblase_assay_plot(template_file)
# Generate tabular results
scramblase_assay_stats(template_file)
# Plot the PPR plot(s) forgoing faceting by experiment
scramblase_assay_plot(template_file, split_by_experiment = FALSE)
# Generate tabular results
scramblase_assay_stats(template_file, split_by_experiment = FALSE)
</code></pre>


</div>