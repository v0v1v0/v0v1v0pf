<div class="container">

<table style="width: 100%;"><tr>
<td>csrec</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Optimal combination cross-sectional reconciliation</h2>

<h3>Description</h3>

<p>This function performs optimal (in least squares sense) combination cross-sectional
forecast reconciliation for a linearly constrained (e.g., hierarchical/grouped)
multiple time series (Wickramasuriya et al., 2019, Panagiotelis et al., 2022,
Girolimetto and Di Fonzo, 2023). The reconciled forecasts are calculated
using either a projection approach (Byron, 1978, 1979) or the equivalent structural
approach by Hyndman et al. (2011). Non-negative (Di Fonzo and Girolimetto, 2023) and
immutable (including Zhang et al., 2023) reconciled forecasts can be considered.
</p>


<h3>Usage</h3>

<pre><code class="language-R">csrec(base, agg_mat, cons_mat, comb = "ols", res = NULL, approach = "proj",
      nn = NULL, settings = NULL, bounds = NULL, immutable = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>base</code></td>
<td>
<p>A (<code class="reqn">h \times n</code>) numeric matrix or multivariate time series (<code>mts</code> class)
containing the base forecasts to be reconciled; <code class="reqn">h</code> is the forecast horizon, and <code class="reqn">n</code> is
the total number of time series (<code class="reqn">n = n_a + n_b</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agg_mat</code></td>
<td>
<p>A (<code class="reqn">n_a \times n_b</code>) numeric matrix representing the cross-sectional
aggregation matrix. It maps the <code class="reqn">n_b</code> bottom-level (free)
variables into the <code class="reqn">n_a</code> upper (constrained) variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cons_mat</code></td>
<td>
<p>A (<code class="reqn">n_a \times n</code>) numeric matrix representing the cross-sectional
zero constraints. It spans the null space for the reconciled forecasts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comb</code></td>
<td>
<p>A string specifying the reconciliation method. For a complete list, see cscov.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p>An (<code class="reqn">N \times n</code>) optional numeric matrix containing the in-sample
residuals. This matrix is used to compute some covariance matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>approach</code></td>
<td>
<p>A string specifying the approach used to compute the reconciled
forecasts. Options include:
</p>

<ul>
<li>
<p> "<code>proj</code>" (<em>default</em>): Projection approach according to Byron (1978, 1979).
</p>
</li>
<li>
<p> "<code>strc</code>": Structural approach as proposed by Hyndman et al. (2011).
</p>
</li>
<li>
<p> "<code>proj_osqp</code>": Numerical solution using <a href="https://osqp.org/"><span class="pkg">osqp</span></a>
for projection approach.
</p>
</li>
<li>
<p> "<code>strc_osqp</code>": Numerical solution using <a href="https://osqp.org/"><span class="pkg">osqp</span></a>
for structural approach.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nn</code></td>
<td>
<p>A string specifying the algorithm to compute non-negative reconciled forecasts:
</p>

<ul>
<li>
<p> "<code>osqp</code>": quadratic programming optimization
(<a href="https://osqp.org/"><span class="pkg">osqp</span></a> solver).
</p>
</li>
<li>
<p> "<code>sntz</code>": heuristic "set-negative-to-zero" (Di Fonzo and Girolimetto, 2023).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>settings</code></td>
<td>
<p>An object of class <code>osqpSettings</code> specifying settings
for the <a href="https://osqp.org/"><span class="pkg">osqp</span></a> solver. For details, refer to the
<a href="https://osqp.org/"><span class="pkg">osqp</span> documentation</a> (Stellato et al., 2020).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bounds</code></td>
<td>
<p>A (<code class="reqn">n \times 2</code>) numeric matrix specifying the cross-sectional bounds.
The first column represents the lower bound, and the second column represents the upper bound.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>immutable</code></td>
<td>
<p>A numeric vector containing the column indices of the base forecasts
(<code>base</code> parameter) that should be fixed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Arguments passed on to <code>cscov</code>
</p>

<dl>
<dt><code>mse</code></dt>
<dd>
<p>If <code>TRUE</code> (<em>default</em>) the residuals used to compute the covariance
matrix are not mean-corrected.</p>
</dd>
<dt><code>shrink_fun</code></dt>
<dd>
<p>Shrinkage function of the covariance matrix, shrink_estim (<em>default</em>).</p>
</dd>
</dl>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A (<code class="reqn">h \times n</code>) numeric matrix of cross-sectional reconciled forecasts.
</p>


<h3>References</h3>

<p>Byron, R.P. (1978), The estimation of large social account matrices,
<em>Journal of the Royal Statistical Society, Series A</em>, 141, 3, 359-367.
<a href="https://doi.org/10.2307/2344807">doi:10.2307/2344807</a>
</p>
<p>Byron, R.P. (1979), Corrigenda: The estimation of large social account matrices,
<em>Journal of the Royal Statistical Society, Series A</em>, 142(3), 405.
<a href="https://doi.org/10.2307/2982515">doi:10.2307/2982515</a>
</p>
<p>Di Fonzo, T. and Girolimetto, D. (2023), Spatio-temporal reconciliation of solar
forecasts, <em>Solar Energy</em>, 251, 13–29. <a href="https://doi.org/10.1016/j.solener.2023.01.003">doi:10.1016/j.solener.2023.01.003</a>
</p>
<p>Girolimetto, D. and Di Fonzo, T. (2023), Point and probabilistic forecast reconciliation
for general linearly constrained multiple time series,
<em>Statistical Methods &amp; Applications</em>, in press. <a href="https://doi.org/10.1007/s10260-023-00738-6">doi:10.1007/s10260-023-00738-6</a>.
</p>
<p>Hyndman, R.J., Ahmed, R.A., Athanasopoulos, G. and Shang, H.L. (2011),
Optimal combination forecasts for hierarchical time series,
<em>Computational Statistics &amp; Data Analysis</em>, 55, 9, 2579-2589.
<a href="https://doi.org/10.1016/j.csda.2011.03.006">doi:10.1016/j.csda.2011.03.006</a>
</p>
<p>Panagiotelis, A., Athanasopoulos, G., Gamakumara, P. and Hyndman, R.J. (2021), Forecast
reconciliation: A geometric view with new insights on bias correction,
<em>International Journal of Forecasting</em>, 37, 1, 343–359.
<a href="https://doi.org/10.1016/j.ijforecast.2020.06.004">doi:10.1016/j.ijforecast.2020.06.004</a>
</p>
<p>Stellato, B., Banjac, G., Goulart, P., Bemporad, A. and Boyd, S. (2020), OSQP:
An Operator Splitting solver for Quadratic Programs,
<em>Mathematical Programming Computation</em>, 12, 4, 637-672.
<a href="https://doi.org/10.1007/s12532-020-00179-2">doi:10.1007/s12532-020-00179-2</a>
</p>
<p>Wickramasuriya, S.L., Athanasopoulos, G. and Hyndman, R.J. (2019), Optimal forecast
reconciliation for hierarchical and grouped time series through trace minimization,
<em>Journal of the American Statistical Association</em>, 114, 526, 804-819.
<a href="https://doi.org/10.1080/01621459.2018.1448825">doi:10.1080/01621459.2018.1448825</a>
</p>
<p>Zhang, B., Kang, Y., Panagiotelis, A. and Li, F. (2023), Optimal reconciliation with
immutable forecasts, <em>European Journal of Operational Research</em>, 308(2), 650–660.
<a href="https://doi.org/10.1016/j.ejor.2022.11.035">doi:10.1016/j.ejor.2022.11.035</a>
</p>


<h3>See Also</h3>

<p>Regression-based reconciliation: 
<code>ctrec()</code>,
<code>terec()</code>
</p>
<p>Cross-sectional framework: 
<code>csboot()</code>,
<code>csbu()</code>,
<code>cscov()</code>,
<code>cslcc()</code>,
<code>csmo()</code>,
<code>cstd()</code>,
<code>cstools()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(123)
# (2 x 3) base forecasts matrix (simulated), Z = X + Y
base &lt;- matrix(rnorm(6, mean = c(20, 10, 10)), 2, byrow = TRUE)
# (10 x 3) in-sample residuals matrix (simulated)
res &lt;- t(matrix(rnorm(n = 30), nrow = 3))

# Aggregation matrix for Z = X + Y
A &lt;- t(c(1,1))
reco &lt;- csrec(base = base, agg_mat = A, comb = "wls", res = res)

# Zero constraints matrix for Z - X - Y = 0
C &lt;- t(c(1, -1, -1))
reco &lt;- csrec(base = base, cons_mat = C, comb = "wls", res = res) # same results

# Non negative reconciliation
base[1,3] &lt;- -base[1,3] # Making negative one of the base forecasts for variable Y
nnreco &lt;- csrec(base = base, agg_mat = A, comb = "wls", res = res, nn = "osqp")
recoinfo(nnreco, verbose = FALSE)$info

</code></pre>


</div>