<div class="container">

<table style="width: 100%;"><tr>
<td>RRPlot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot and Analysis of Indices of Risk</h2>

<h3>Description</h3>

<p>Plots of calibration and performance of risk probabilites 
</p>


<h3>Usage</h3>

<pre><code class="language-R">	RRPlot(riskData=NULL,
	timetoEvent=NULL,
	riskTimeInterval=NULL,
	ExpectedPrevalence=NULL,
	atRate=c(0.90,0.80),
	atThr=NULL,
    plotRR=TRUE,
	title="",
	ysurvlim=c(0,1.0)
	)	
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>riskData</code></td>
<td>

<p>The data frame with two columns: First: Event label (event=1, censored=0). Second: Probability of any future event within the riskTimeInterval
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timetoEvent</code></td>
<td>

<p>The time to event vector
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>riskTimeInterval</code></td>
<td>

<p>The time interval of the probability estimations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ExpectedPrevalence</code></td>
<td>

<p>For Case-Control Studies: The expected prevalence of events.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>atRate</code></td>
<td>

<p>The desired TNR (specificity) or FNR (1.0-sensitivity) of the computed risk at threshold
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>atThr</code></td>
<td>

<p>The risk threshold
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotRR</code></td>
<td>

<p>If set to FALSE it will not generate the plots
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>

<p>The title postfix to be appended on each one of the generated plot titles
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ysurvlim</code></td>
<td>

<p>The y limits of the survival plot
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The RRPlot function will analyze the provided probabilities of risk and its associated events to generate calibration plots and plots of Relative Risk (RR) vs all the sensitivity values. Furthermore, it will compute and analyze the RR of the computed threshold that contains the prescribed rate of true negative cases (TNR) or if the atRate value is lower than 0.5 it will assume that it is the FNR (1-Specificity). If the user provides the time to event data, the function will also plot the Kaplan-Meier curve and return the logrank probability of differences between risk categories. For the calibration plot it will use the user provided riskTimeInterval to get the expected number of events. If the user does not provide the riskTimeInterval the function will use the maximum time of observations with events.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>CumulativeOvs</code></td>
<td>

<p>Matrix with the Cumulative and Observed Events
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OEData</code></td>
<td>

<p>Matrix with the Estimated and Observed Events
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DCA</code></td>
<td>

<p>Decision Curve Analysis data matrix
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RRData</code></td>
<td>

<p>The risk ratios data matrix for the ploted observations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timetoEventData</code></td>
<td>

<p>The dataframe with hazards, class and expeted time to event 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keyPoints</code></td>
<td>

<p>The threshold values and metrics at: Specified, Max BACC, Max RR, and 100
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OERatio</code></td>
<td>

<p>The Observed/Expected poisson test
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OE95ci</code></td>
<td>

<p>The mean OE Ratio over the top 90
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OARatio</code></td>
<td>

<p>The Observed/Accumlated poisson test
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OAcum95ci</code></td>
<td>

<p>The mean O/A Ratio over the top 90
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>

<p>The loess fit of the Risk Ratios
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ROCAnalysis</code></td>
<td>

<p>The Reciver Operating Curve and Binary performance analysis
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prevalence</code></td>
<td>

<p>The prevalence of events
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thr_atP</code></td>
<td>

<p>The p-value that contains atProb of the negative subjects
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c.index</code></td>
<td>

<p>The c-index with 90
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surfit</code></td>
<td>

<p>The survival fit object
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surdif</code></td>
<td>

<p>The logrank test analysis
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LogRankE</code></td>
<td>

<p>The bootstreped p-value of the logrank test
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Jose G. Tamez-Pena</p>


<h3>See Also</h3>

<p><code>EmpiricalSurvDiff</code></p>


<h3>Examples</h3>

<pre><code class="language-R">	## Not run: 

        ### RR Plot Example ####
        # Start the graphics device driver to save all plots in a pdf format
        pdf(file = "RRPlot.pdf",width = 8, height = 6)

		library(survival)
		library(FRESA.CAD)

		op &lt;- par(no.readonly = TRUE)

		### Libraries

		data(cancer, package="survival")
		lungD &lt;- lung
		lungD$inst &lt;- NULL
		lungD$status &lt;- lungD$status - 1
		lungD &lt;- lungD[complete.cases(lungD),]


		## Exploring Raw Features with RRPlot

		convar &lt;- colnames(lungD)[lapply(apply(lungD,2,unique),length) &gt; 10]
		convar &lt;- convar[convar != "time"]
		topvar &lt;- univariate_BinEnsemble(lungD[,c("status",convar)],"status")
		print(names(topvar))
		topv &lt;- min(5,length(topvar))
		topFive &lt;- names(topvar)[1:topv]
		RRanalysis &lt;- list();
		idx &lt;- 1
		for (topf in topFive)
		{
		  RRanalysis[[idx]] &lt;- RRPlot(cbind(lungD$status,lungD[,topf]),
									  atRate=c(0.90),
									  timetoEvent=lungD$time,
									  title=topf,
									  # plotRR=FALSE
		  )
		  idx &lt;- idx + 1
		}
		names(RRanalysis) &lt;- topFive

		## Reporting the Metrics

		ROCAUC &lt;- NULL
		CstatCI &lt;- NULL
		LogRangp &lt;- NULL
		Sensitivity &lt;- NULL
		Specificity &lt;- NULL

		for (topf in topFive)
		{
		  CstatCI &lt;- rbind(CstatCI,RRanalysis[[topf]]$c.index$cstatCI)
		  LogRangp &lt;- rbind(LogRangp,RRanalysis[[topf]]$surdif$pvalue)
		  Sensitivity &lt;- rbind(Sensitivity,RRanalysis[[topf]]$ROCAnalysis$sensitivity)
		  Specificity &lt;- rbind(Specificity,RRanalysis[[topf]]$ROCAnalysis$specificity)
		  ROCAUC &lt;- rbind(ROCAUC,RRanalysis[[topf]]$ROCAnalysis$aucs)
		}
		rownames(CstatCI) &lt;- topFive
		rownames(LogRangp) &lt;- topFive
		rownames(Sensitivity) &lt;- topFive
		rownames(Specificity) &lt;- topFive
		rownames(ROCAUC) &lt;- topFive

		print(ROCAUC)
		print(CstatCI)
		print(LogRangp)
		print(Sensitivity)
		print(Specificity)

		meanMatrix &lt;- cbind(ROCAUC[,1],CstatCI[,1],Sensitivity[,1],Specificity[,1])
		colnames(meanMatrix) &lt;- c("ROCAUC","C-Stat","Sen","Spe")
		print(meanMatrix)

		## COX Modeling
		ml &lt;- BSWiMS.model(Surv(time,status)~1,data=lungD,NumberofRepeats = 10)
		sm &lt;- summary(ml)
		print(sm$coefficients)

		### Cox Model Performance


		timeinterval &lt;- 2*mean(subset(lungD,status==1)$time)

		h0 &lt;- sum(lungD$status &amp; lungD$time &lt;= timeinterval)
		h0 &lt;- h0/sum((lungD$time &gt; timeinterval) | (lungD$status==1))
		print(t(c(h0=h0,timeinterval=timeinterval)),caption="Initial Parameters")

		index &lt;- predict(ml,lungD)

		rdata &lt;- cbind(lungD$status,ppoisGzero(index,h0))

		rrAnalysisTrain &lt;- RRPlot(rdata,atRate=c(0.90),
								  timetoEvent=lungD$time,
								  title="Raw Train: lung Cancer",
								  ysurvlim=c(0.00,1.0),
								  riskTimeInterval=timeinterval)


		### Reporting Performance 


		print(rrAnalysisTrain$keyPoints,caption="Key Values")
		print(rrAnalysisTrain$OERatio,caption="O/E Test")
		print(t(rrAnalysisTrain$OE95ci),caption="O/E Mean")
		print(rrAnalysisTrain$OARatio,caption="O/Acum Test")
		print(t(rrAnalysisTrain$OAcum95ci),caption="O/Acum Mean")
		print(rrAnalysisTrain$c.index$cstatCI,caption="C. Index")
		print(t(rrAnalysisTrain$ROCAnalysis$aucs),caption="ROC AUC")
		print((rrAnalysisTrain$ROCAnalysis$sensitivity),caption="Sensitivity")
		print((rrAnalysisTrain$ROCAnalysis$specificity),caption="Specificity")
		print(t(rrAnalysisTrain$thr_atP),caption="Probability Thresholds")
		print(rrAnalysisTrain$surdif,caption="Logrank test")


  
        dev.off()
	
## End(Not run)
</code></pre>


</div>