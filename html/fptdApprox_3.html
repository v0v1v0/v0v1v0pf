<div class="container">

<table style="width: 100%;"><tr>
<td>Approx.fpt.density</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Approximating First-Passage-Time Densities</h2>

<h3>Description</h3>

<p><code>Approx.fpt.density</code> computes values of the approximate first-passage-time (f.p.t.) density, for conditioned and unconditioned problems. <br></p>
<p>For the unconditioned case, values of the approximate densities for f.p.t. problems conditioned to suitable values of the initial distribution 
are also calculated. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">Approx.fpt.density(dp, t0, T, id, S, env = NULL, variableStep = TRUE, 
                   from.t0 = FALSE, to.T = FALSE, r = 4000, zeroSlope = 0.01, 
                   p0.tol = 8, k = 3, m = 100, n = 250, p = 0.2, alpha = 1, 
                   skip = TRUE, tol = 0.001, it.max)               
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dp</code></td>
<td>
<p>an object of class “diffproc” defining a family of diffusion processes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t0, T</code></td>
<td>
<p>lower and upper limits of the considered time interval. Must be finite.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>a numerical value specifying a fixed initial value of the process in the time instant specified in the <code>t0</code> argument
(for a conditioned f.p.t. problem), or a four-component list specifying the initial distribution of the process (for an unconditioned f.p.t. problem).
In the last case the first component is the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> mathematical expression of the density as a character string, the second
one is a label to denote the distribution in the reports generated by the <code>report</code> method, the third one is the label to
denote the distribution for LaTeX, and the four one is a label to denote the distribution in the graphs generated by the <code>plot</code> method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>numerical value of a constant boundary or character string with the mathematical expression of a time 
dependent boundary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>a named list of objects of numeric or character type specifying the values of names which occur in
the mathematical expressions in objects <code>dp</code> and <code>S</code>, or of names which occur in the specification of the previous values.
Defaults to NULL, interpreted as an empty list. It is copied into a temporary environment for evaluating the mathematical expressions 
in the <code>dp</code> object and <code>S</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variableStep</code></td>
<td>
<p>a logical value indicating whether a variable integration step is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from.t0</code></td>
<td>
<p>a logical value indicating whether the approximation should be calculated from the lower end of the
interval considered, <code class="reqn">t_0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to.T</code></td>
<td>
<p>a logical value indicating whether the approximation should be calculated to the upper end of the
interval considered, <code class="reqn">T</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>number of points at which the FPTL function is evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zeroSlope</code></td>
<td>
<p>maximum slope required to consider that a growing function is constant.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p0.tol</code></td>
<td>
<p>controls where the First-Passage-Time Location function begins to increase significantly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>controls whether the First-Passage-Time Location function decreases very slowly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>Number of equally spaced values to select from the specified initial distribution in the case of an unconditioned f.p.t. problem.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Number of points used to determine the integration step in subintervals <code class="reqn">[t_i^*, t_{max,i}^+]</code> 
<code class="reqn">i=1, \ldots, m</code>, from interesting instants provided by the FPTL function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Ratio of n used to determine the integration step in subintervals  
<code class="reqn">[t_{max,i}^+, t_{i+1}^*]</code>, <code class="reqn">i=1, \ldots, m</code>, <code class="reqn">[t_0, t_1^*]</code> and 
<code class="reqn">[t_{max,m}^{+}, T]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Parameter used to determine the integration step in subintervals 
<code class="reqn">[t_{max,i}^+, t_{i+1}^*]</code>, <code class="reqn">i=1, \ldots, m</code>, <code class="reqn">[t_0, t_1^*]</code> and 
<code class="reqn">[t_{max,m}^{+}, T]</code>, in order to reduce the computational cost of approximating the f.p.t. density function 
in those cases where <code class="reqn">t_{i+1}^* - t_{max,i}^+ &gt;&gt; t_{max,i}^{-} - \thinspace t_i^*</code>, 
for some <code class="reqn">i</code>, <code class="reqn">t_1^* - t_0 &gt;&gt; t_{max,1}^{-} - \thinspace t_1^*</code> or 
<code class="reqn">T - t_{max,m}^+ &gt;&gt; t_{max,m}^{-} - \thinspace t_m^*</code>, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skip</code></td>
<td>
<p>a logical value indicating whether the intervals at which the FPTL function is near zero could be
avoided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>If the cumulative integral of the approximation is greater than or equal to 1 - tol the algorithm is stopped.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>it.max</code></td>
<td>
<p>If the number of iterations required for the approximation process is greater than it.max, the function asks for permission to continue.
Defaults to 50000 for a conditioned f.p.t. problem, and 1000000 for an unconditioned f.p.t. problem.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For an unconditioned f.p.t. problem, this function allows to compute directly the approximate f.p.t. density from an object of class “diffproc”. 
In contrast to the approximation of a conditioned f.p.t. density by using the <code>Approx.cfpt.density</code> function, in this case it is not necessary for users to make 
previous calls to the functions <code>FPTL</code> and <code>summary.FPTL</code>. <br></p>
<p>For a diffusion process <code class="reqn">\{X(t), t_0 \leq t \leq T \}</code> with non-degenerate initial distribution 
the unconditioned f.p.t. variable, through a continuous boundary <code class="reqn">S(t)</code>, is defined as
</p>
<p style="text-align: center;"><code class="reqn">T_{S(t), X(t_0)} = \left\{
\begin{array}{lll}
Inf \ \{ t \geq t_0 \ : \ X(t) &gt; S(t) \} &amp; &amp; if \ X(t_0) &lt; S(t_0) \\[7pt]
Inf \ \{ t \geq t_0 \ : \ X(t) &lt; S(t) \} &amp; &amp; if \ X(t_0) &gt; S(t_0)
\end{array}
 \right. ,</code>
</p>

<p>Its density function can be obtained by means of the numerical integration, in the range of variation of <code class="reqn">X(t_0)</code>, 
of the corresponding f.p.t. densities conditioned to values of <code class="reqn">X(t_0)</code>, weighted by the initial density function. <br></p>
<p>For each conditioned problem related to an unconditioned f.p.t. problem, the <code>Approx.fpt.density</code> function makes internal calls to  
<code>FPTL</code> and <code>summary.fptl</code> functions, in order to localize each conditioned f.p.t. variable, according to the 
<code>zeroSlope</code>, <code>p0.tol</code> and <code>k</code> arguments. Then, the function makes a internall
call to <code>Integration.Steps</code> function, in order to determine the suitable subintervals and 
integration steps to be used to approximate the unconditioned f.p.t. density and conditioned f.p.t. densities according to the <code>variableStep</code>, 
<code>from.t0</code>, <code>to.T</code>, <code>n</code>, <code>p</code> and <code>alpha</code> arguments. <br></p>
<p>From this information, a suitable sequence of time instants in <code class="reqn">[t_0, T]</code> for the approximation of the f.p.t. densities is available.
For each time instant t in such sequence, the <code>Approx.fpt.density</code> function computes the value of the f.p.t. density conditioned to 
<code>m</code> values of the initial distribution (equally spaced in its range of variation), and then it computes the value of the unconditioned f.p.t density. <br></p>
<p>For the approximation of each conditioned f.p.t density, the numerical procedure proposed by Buonocore et al. (1987), 
based on the composite trapezoid method, has been implemented. This method has also been used in the numerical integration for obtaining
the unconditioned f.p.t. density. <br></p>
<p>The mathematical expression of the boundary <code>S</code> should be a function of <code class="reqn">t</code> and may include the argument <code>t0</code>,
the name <code>x0</code>, to refer to an initial value of the process, and the parameters specified in the <code>env</code> argument. 
The function checks if the mathematical expression shows syntax errors and if <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> can compute its symbolic derivative with respect to <code class="reqn">t</code>. <br></p>
<p>The <code>env</code> argument is a list of tagged values in <code>name = value</code> form with <code>name</code> other than <code class="reqn">x</code>, <code class="reqn">t</code>, <code class="reqn">y</code> and <code class="reqn">s</code>.
To name the expression of a function <code class="reqn">h(u)</code> as a character string we can use <code>`h(u)` = value</code> if we want to show its dependence on <code class="reqn">u</code>, or <code>h = value</code> otherwise. <br></p>
<p>The <code>env</code> argument is copied into a temporary environment for evaluating the mathematical expressions in objects <code>dp</code> and <code>S</code>. 
<span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> looks for the objects not found into this temporary environment in the parent.frame() environment. <br></p>
<p>By default the function does not compute the approximate f.p.t. density from the time instant <code class="reqn">t_0</code>, but from a more suitable time instant 
provided by the First-Passage-Time Location (FPTL) function. It also uses a variable integration step. <br></p>
<p>If <code>skip = TRUE</code>, for each subinterval in which it could be possible to avoid calculating all the conditioned f.p.t. densities,
the function checks the value of the approximate unconditioned f.p.t. density
at the lower end of such subinterval. If it is almost 0, the approximate unconditioned f.p.t. density
calculation is avoided in the subinterval, and it continues from the upper end of the subinterval
considering a zero value of the approximate unconditioned f.p.t. density. <br></p>
<p>Similarly, if <code>to.T = FALSE</code>, the function checks the cumulative value of the integral for each upper end of the
subintervals for which it is not possible to avoid the application of the numerical algorithm for each conditioned problem. 
If it is greater than or equal to 1 - <code>tol</code>, the approximation procedure
is stopped. In any case, the procedure is stopped at the upper end of the last subinterval,
and if the cumulative value of the integral is less than 1 - <code>tol</code> the function issues a warning. <br></p>


<h3>Value</h3>

<p>The <code>Approx.fpt.density</code> function computes and returns an object of class “fpt.density”. This object 
is a three-component list:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a sequence of suitable time instants in <code class="reqn">[t_0, \ T]</code> according to the arguments in the function call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the approximate f.p.t. density function values on the x sequence for the unconditioned or conditioned problem at hand.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.x0</code></td>
<td>
<p>NULL for a conditioned f.p.t. problem or a matrix with the values, by columns, of the approximate f.p.t. 
densities conditioned to each considered value <code class="reqn">x_0</code> selected from the initial distribution for an unconditioned f.p.t. problem.</p>
</td>
</tr>
</table>
<p><br></p>
<p>It also includes six additional attributes:
</p>

<table>
<tr>
<td style="text-align: right;">
<code>Call</code> </td>
<td style="text-align: left;"> the unevaluated function call, substituting each object of length 1 (referred </td>
</tr>
<tr>
<td style="text-align: right;"> 
 </td>
<td style="text-align: left;"> by name in call) by its value. </td>
</tr>
<tr>
<td style="text-align: right;">
<code>Steps</code> </td>
<td style="text-align: left;"> matrix of subintervals and integration steps to consider for computing the </td>
</tr>
<tr>
<td style="text-align: right;"> 
 </td>
<td style="text-align: left;"> approximate f.p.t. density. </td>
</tr>
<tr>
<td style="text-align: right;"> 
<code>cumIntegral</code> </td>
<td style="text-align: left;"> vector of the values of the cumulative integral of the approximation for </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
<td style="text-align: left;"> each subinterval considered. </td>
</tr>
<tr>
<td style="text-align: right;">
<code>skips</code> </td>
<td style="text-align: left;"> a list that contains, for each subinterval, the indexes of the initial values </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
<td style="text-align: left;"> for which the calculation of the approximate conditioned f.p.t. densities </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
<td style="text-align: left;"> has been avoided. </td>
</tr>
<tr>
<td style="text-align: right;">
<code>CPUTime</code> </td>
<td style="text-align: left;"> matrix of user and system times, by columns, required to approximate </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
<td style="text-align: left;"> the density for each subinterval considered, by rows. </td>
</tr>
<tr>
<td style="text-align: right;">
<code>summary.fptl</code> </td>
<td style="text-align: left;"> the object of class “summary.fptl” that results in the internal calls to the </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
<td style="text-align: left;"> <code>summary.fptl</code> function which is used as <code>sfptl</code> argument in the internal </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
<td style="text-align: left;"> call to the <code>Integration.Steps</code> function. </td>
</tr>
<tr>
<td style="text-align: right;">
</td>
</tr>
</table>
<p><code>x</code> is the vector result of the concatenation of the sequences of equally spaced values in the suitable subintervals 
determined by the <code>Integration.Steps</code> function.                                                                                          
</p>


<h3>Author(s)</h3>

<p>Patricia Román-Román, Juan J. Serrano-Pérez and Francisco Torres-Ruiz.</p>


<h3>References</h3>

<p>Buonocore, A., Nobile, A.G. and Ricciardi, L.M. (1987) A new integral equation for the evaluation of
first-passage-time probability densities. <em>Adv. Appl. Probab.</em>, <b>19</b>, 784–800.
</p>
<p>Román, P., Serrano, J. J., Torres, F. (2008) First-passage-time location function: Application to determine first-passage-time densities in diffusion processes. <em>Comput. Stat. Data Anal.</em>, <b>52</b>, 4132–4146.
</p>
<p>P. Román-Román, J.J. Serrano-Pérez, F. Torres-Ruiz. (2012) An R package for an efficient approximation of first-passage-time densities for diffusion processes based on the FPTL function. <em>Applied Mathematics and Computation</em>, <b>218</b>, 8408–8428.
</p>
<p>P. Román-Román, J.J. Serrano-Pérez, F. Torres-Ruiz. (2014) More general problems on first-passage times for diffusion processes: A new version of the fptdApprox R package. <em>Applied Mathematics and Computation</em>, <b>244</b>, 432–446.
</p>


<h3>See Also</h3>

<p><code>diffproc</code> about creation of class “diffproc” objects.
</p>
<p><code>is.fpt.density</code> to test for objects of class “fpt.density”.
</p>
<p><code>print.fpt.density</code> to show objects of class “fpt.density”. 
</p>
<p><code>report.fpt.density</code> to generate a report.
</p>
<p><code>plot.fpt.density</code> for graphical display.
</p>
<p><code>FPTL</code> to evaluate the FPTL function and create objects of class “fptl”.
</p>
<p><code>summary.fptl</code> to locate the f.p.t. variable and create objects of class “summary.fptl”.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Continuing the diffproc(.) example:

## Making an efficient approximation of the f.p.t. density
## in the case of a conditioned f.p.t. problem. (optimal 
## variable integration steps and small computational cost)
yyy.cp &lt;- Approx.fpt.density(dp = Lognormal, t0 = 0, T = 18, id = 1, S = 
                        "4.5 + 4*t^2 + 7*t*sqrt(t)*sin(6*sqrt(t))", 
                        env = list(m = 0.48, sigma = 0.07))
yyy.cp

## Not run: 
## Making a less efficient approximation of the f.p.t. density 
## (optimal fixed integration step but high computational cost related to 
##  the efficient approximation)
yyy1.cp &lt;- Approx.fpt.density(dp = Lognormal, t0 = 0, T = 18, id = 1, S = 
                        "4.5 + 4*t^2 + 7*t*sqrt(t)*sin(6*sqrt(t))", 
                        env = list(m = 0.48, sigma = 0.07), 
                        variableStep = FALSE, from.t0 = TRUE, to.T = 
                        TRUE, skip = FALSE)
yyy1.cp

## Making an efficient approximation of the f.p.t. density 
## in the case of an unconditioned f.p.t. problem.
yyy.ucp &lt;- Approx.fpt.density(dp = Lognormal, t0 = 0, T = 18, id = 
                list("dlnorm(x,-0.005,0.1)", "Lambda(-0.005,0.1)", 
                "\\Lambda(-0.005,0.1)", "Lognormal(-0.005,0.1)"),
                S = "4.5 + 4*t^2 + 7*t*sqrt(t)*sin(6*sqrt(t))", 
                env = list(m = 0.48, sigma = 0.07), m=25)                 
yyy.ucp
## End(Not run)
</code></pre>


</div>