<div class="container">

<table style="width: 100%;"><tr>
<td>flag_weighted</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Flag aggregation by the weighted frequency method</h2>

<h3>Description</h3>

<p>This method can be used when you want to derive the flag of an aggregate that is a weighted average,
index, quantile, etc.
</p>


<h3>Usage</h3>

<pre><code class="language-R">flag_weighted(i, f, w)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>i</code></td>
<td>
<p>An integer column identifier of data.frame or a matrix containing the flags and weights used to derived
the flag for the aggregates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>A data.frame or a matrix containing the flags of the series (one column per period)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>A data.frame or a matrix with same size and dimesion as <code>f</code> containing the corresponding weights
for each flags.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>flag_weighted</code> Returns a character vector with the flag that has the highest weighted frequency or multiple flags in alphabetical 
order (in case there are more than one flag with the same highest weight) as the first value, and the sum of weights for the given flag(s) as 
the second value for the given columns of <code>f,w</code> defined by the parameter <code>i</code>.
</p>


<h3>See Also</h3>

<p><code>flag_divide</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">flag_weighted(1, 
              data.frame(f=c("pe","b","p","p","u","e","d"), stringsAsFactors = FALSE), 
              data.frame(w=c(10,3,7,12,31,9,54)))
flag_weighted(1, 
              data.frame(f=c("pe","b","p","p","up","e","d"), stringsAsFactors = FALSE),
              data.frame(w=c(10,3,7,12,31,9,54)))
flag_weighted(1, 
              data.frame(f=c("pe",NA,"pe",NA,NA,"d"), stringsAsFactors = FALSE),
              data.frame(w=c(10,3,7,12,31,9)))


flags &lt;- tidyr::spread(test_data[, c(1:3)], key = time, value = flags)
weights &lt;- tidyr::spread(test_data[, c(1, 3:4)], key = time, value = values)
flag_weighted(7,flags[, c(2:ncol(flags))],weights[, c(2:ncol(weights))])

weights&lt;-apply(weights[, c(2:ncol(weights))],2,function(x) x/sum(x,na.rm=TRUE))
weights[is.na(weights)] &lt;- 0
flags&lt;-flags[, c(2:ncol(flags))]
sapply(1:ncol(flags),flag_weighted,f=flags,w=weights)

</code></pre>


</div>