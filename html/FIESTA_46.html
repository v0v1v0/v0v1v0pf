<div class="container">

<table style="width: 100%;"><tr>
<td>modPBpop</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Photo-Based module - Generate population data for PB module.</h2>

<h3>Description</h3>

<p>Generates population data for generating photo-based estimation.  Plots that
are totally nonsampled are excluded from estimation dataset. Next, an
adjustment factor is calculated by strata to adjust for nonsampled
(nonresponse) conditions that have proportion less than 1. Attributes
adjusted to a per-acre value are summed by plot, divided by the adjustment
factor, and averaged by stratum.  Strata means are combined using the strata
weights and then expanded to using the total land area in the population.
</p>


<h3>Usage</h3>

<pre><code class="language-R">modPBpop(
  pntdat = NULL,
  pltpct = NULL,
  plotid = "plot_id",
  pntid = NULL,
  pltpctvars = NULL,
  plt = NULL,
  pltassgn = NULL,
  puniqueid = "CN",
  pltassgnid = "CN",
  nonsamp.pfilter = NULL,
  sumunits = FALSE,
  unitvar = NULL,
  unitarea = NULL,
  areavar = "ACRES",
  strata = FALSE,
  strtype = "POST",
  stratalut = NULL,
  strvar = "STRATUMCD",
  pvars2keep = NULL,
  saveobj = FALSE,
  objnm = "PBpopdat",
  savedata = FALSE,
  unit_opts = NULL,
  strata_opts = NULL,
  savedata_opts = NULL,
  PBstratdat = NULL,
  gui = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pntdat</code></td>
<td>
<p>DF/DT or comma-delimited file (*.csv). Point-level table with
one record per point. If NULL, aggregated point counts must be in pntcnt.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pltpct</code></td>
<td>
<p>DF/DT or comma-delimited file (*.csv). Plot-domain-level table
with percent observed by domain per plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotid</code></td>
<td>
<p>String. Unique identifier of plot in pnt. All values must
match puniqueid values, if pltassgn is not NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pntid</code></td>
<td>
<p>String. Unique identifier of points in pnt.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pltpctvars</code></td>
<td>
<p>String vector. Variables in pltpct for estimation. If
NULL, all variables are used except plotid in pltpct.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plt</code></td>
<td>
<p>DF/DT, comma-separated values (CSV) file(*.csv), or layer in dsn,
Can also be a shapefile(*.shp) with one record per plot, a spatial layer in
dsn, or a sf R object. Plot-level variables. If nonsampled plots are
included, PLOT_STATUS_CD variable must be in table. Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pltassgn</code></td>
<td>
<p>DF/DT, comma-delimited file(*.csv), SpatialDataFrame, or
shapefile(*.shp). The plot-level data with one record per plot, including
estimation unit and/or strata information. Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>puniqueid</code></td>
<td>
<p>String. Unique identifier of plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pltassgnid</code></td>
<td>
<p>String. Name of unique identifier of plot in pltassgn with
All values must match plotid values if pnt is not NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonsamp.pfilter</code></td>
<td>
<p>String. An expression for filtering nonsampled plots.
Must be R syntax.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sumunits</code></td>
<td>
<p>Logical. If TRUE, estimation units are combined to one table
for output. Note: only available if tabtype="AREA". Acres</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitvar</code></td>
<td>
<p>String. Name of the estimation unit variable in cond or
pltassgn with estimation unit assignment for each plot (e.g., 'ESTN_UNIT').
If one estimation unit, set unitvar=NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitarea</code></td>
<td>
<p>Numeric or DF. Total area by estimation unit. If only 1
estimation unit, include number of total acreage for the area of interest or
a data frame with areavar. If more than one estimation unit, provide a data
frame of total area by estimation unit, including unitvar and areavar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>areavar</code></td>
<td>
<p>String. Name of acre variable in unitarea. Default="ACRES".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>Logical. If TRUE, add data information for stratification.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strtype</code></td>
<td>
<p>String. If strata=TRUE, the type of strata ('POST', 'PRE').
Note: the variance equations are slightly different.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratalut</code></td>
<td>
<p>DF/DT. If strata=TRUE, look-up table with strata
proportions ('strwt') by strata (and estimation unit). To calculate 'strwt',
set getwt=TRUE and getwtvar= name of variable with information to calculate
weights from (e.g., pixel counts)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strvar</code></td>
<td>
<p>String. If strata=TRUE, name of the strata variable in
stratalut and cond or pltassgn data frame with stratum assignment for each
plot (Default = 'STRATUMCD').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvars2keep</code></td>
<td>
<p>String vector. Additional plot variables to keep in
dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveobj</code></td>
<td>
<p>Logical. If TRUE, saves SApopdat object to outfolder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>objnm</code></td>
<td>
<p>String. Name of *.rda object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedata</code></td>
<td>
<p>Logical. If TRUE, saves table(s) to outfolder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unit_opts</code></td>
<td>
<p>List. See help(unit_options()) for a list of options.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata_opts</code></td>
<td>
<p>List. See help(strata_options()) for a list of options.
Only used when strata = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedata_opts</code></td>
<td>
<p>List. See help(savedata_options()) for a list
of options. Only used when savedata = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PBstratdat</code></td>
<td>
<p>R List object. Output data list components from
FIESTA::DBgetStrata().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gui</code></td>
<td>
<p>Logical. If gui, user is prompted for parameters.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If variables are NULL, then it will prompt user to input variables.
</p>
<p>Necessary variables:<br></p>

<table>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <b>Data</b> </td>
<td style="text-align: left;">
<b>Variable</b> </td>
<td style="text-align: left;"> <b>Description</b>
</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> tree </td>
<td style="text-align: left;"> tuniqueid </td>
<td style="text-align: left;">
Unique identifier for each plot, to link to pltassgn (ex. PLT_CN).</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> CONDID </td>
<td style="text-align: left;"> Unique identifier of each condition on plot, to link to
cond.  Set CONDID=1, if only 1 condition per plot.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> TPA_UNADJ
</td>
<td style="text-align: left;"> Number of trees per acre each sample tree represents (ex. DESIGNCD=1:
TPA_UNADJ=6.018046 for trees on subplot; 74.965282 for trees on
microplot).</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> cond </td>
<td style="text-align: left;"> cuniqueid </td>
<td style="text-align: left;"> Unique identifier for each
plot, to link to pltassgn (ex. PLT_CN).</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> CONDID </td>
<td style="text-align: left;"> Unique
identifier of each condition on plot.  Set CONDID=1, if only 1 condition per
plot.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> CONDPROP_UNADJ </td>
<td style="text-align: left;"> Unadjusted proportion of condition on
each plot.  Set CONDPROP_UNADJ=1, if only 1 condition per plot.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;">
COND_STATUS_CD </td>
<td style="text-align: left;"> Status of each forested condition on plot (i.e.
accessible forest, nonforest, water, etc.)</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> NF_COND_STATUS_CD
</td>
<td style="text-align: left;"> If ACI=TRUE. Status of each nonforest condition on plot (i.e.
accessible nonforest, nonsampled nonforest)</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> SITECLCD </td>
<td style="text-align: left;"> If
landarea=TIMBERLAND. Measure of site productivity.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> RESERVCD
</td>
<td style="text-align: left;"> If landarea=TIMBERLAND. Reserved status.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> SUBPROP_UNADJ
</td>
<td style="text-align: left;"> Unadjusted proportion of subplot conditions on each plot.  Set
SUBPROP_UNADJ=1, if only 1 condition per subplot.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;">
MICRPROP_UNADJ </td>
<td style="text-align: left;"> If microplot tree attributes. Unadjusted proportion of
microplot conditions on each plot. Set MICRPROP_UNADJ=1, if only 1 condition
per microplot.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> MACRPROP_UNADJ </td>
<td style="text-align: left;"> If macroplot tree
attributes. Unadjusted proportion of macroplot conditions on each plot. Set
MACRPROP_UNADJ=1, if only 1 condition per macroplot.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> pltassgn </td>
<td style="text-align: left;">
puniqueid </td>
<td style="text-align: left;"> Unique identifier for each plot, to link to cond (ex. CN).</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> STATECD </td>
<td style="text-align: left;"> Identifies state each plot is located in.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> INVYR </td>
<td style="text-align: left;"> Identifies inventory year of each plot.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;">
PLOT_STATUS_CD </td>
<td style="text-align: left;"> Status of each plot (i.e. sampled, nonsampled).  If not
included, all plots are assumed as sampled.</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p>For available reference tables: sort(unique(FIESTAutils::ref_codes$VARIABLE)) <br></p>


<h3>Value</h3>

<p>A list with population data for Green-Book estimates.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>condx</code></td>
<td>
<p> Data frame. Condition-level data including plot-level
assignment of estimation unit and stratum (if strata=TRUE) and adjusted
condition proportion. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pltcondx</code></td>
<td>
<p> Data frame. Condition-level data,
merged with plot data. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cuniqueid</code></td>
<td>
<p> String. Unique identifier of plot
in condx and pltcondx. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condid</code></td>
<td>
<p> String. Unique identifier of
condition in condx and pltcondx. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treex</code></td>
<td>
<p> Data frame. If
esttype='TREE', tree-level data, including sample adjustment factor. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuniqueid</code></td>
<td>
<p> String. If esttype='TREE', unique identifier of plot in
treex. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ACI.filter</code></td>
<td>
<p> String. If ACI=FALSE, ACI.filter="COND_STATUS_CD
== 1" . </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitarea</code></td>
<td>
<p> String. Returned table of area by estimation
unit. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitvar</code></td>
<td>
<p> String. Variable name for estimation unit. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strlut</code></td>
<td>
<p> String. Strata-level table with pixel counts by strata
(P1POINTCNT), strata weights (strwt), number of plots by strata (n.strata),
total number of plots in estimation unit (n.total), sum of condition
proportions (*_UNADJ_SUM), area adjustments (*_ADJFAC), total area, and area
expansion by strata (EXPNS). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strvar</code></td>
<td>
<p> String. Variable name for
strata. If strata=FALSE, strvar="ONESTRAT". </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expcondtab</code></td>
<td>
<p> String. If
ACI=FALSE, ACI.filter="COND_STATUS_CD == 1" . </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotsampcnt</code></td>
<td>
<p> Data
frame. Number of plots by PLOT_STATUS_CD. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condsampcnt</code></td>
<td>
<p> Data frame.
Number of conditions by COND_STATUS_CD. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>states</code></td>
<td>
<p> String. State names
in dataset. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>invyrs</code></td>
<td>
<p> String. Range of inventory years in dataset. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratdat</code></td>
<td>
<p> Data frame. Strata information by estimation unit. </p>
</td>
</tr>
</table>
<table>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <b>Variable</b> </td>
<td style="text-align: left;"> <b>Description</b>
</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> unitvar
</td>
<td style="text-align: left;"> estimation unit </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> strvar </td>
<td style="text-align: left;"> stratum value </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> strwtvar
</td>
<td style="text-align: left;"> number of pixels by strata and estimation unit </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> n.strata </td>
<td style="text-align: left;">
number of plots in strata (after totally nonsampled plots removed) </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;">
n.total </td>
<td style="text-align: left;"> number of plots for estimation unit </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> strwt </td>
<td style="text-align: left;">
proportion of area (or plots) by strata and estimation unit (i.e., strata
weight) </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> CONDPROP_UNADJ_SUM </td>
<td style="text-align: left;"> summed condition proportion by
strata and estimation unit </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> CONDPROP_ADJFAC </td>
<td style="text-align: left;"> adjusted condition
proportion by strata after nonsampled plots removed </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> AREA_USED </td>
<td style="text-align: left;">
total area of estimation unit </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> expfac </td>
<td style="text-align: left;"> strata-level expansion
factor after nonsampled plots and conditions removed (AREA_USED/n.strata)
</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> EXPNS </td>
<td style="text-align: left;"> strata-level area expansions (expfac * strwt)</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p>Table(s) are also written to outfolder.
</p>


<h3>Note</h3>

<p>ADJUSTMENT FACTOR:<br> The adjustment factor is necessary to account for
nonsampled conditions. It is calculated for each estimation unit by strata.
by summing the unadjusted proportions of the subplot, microplot, and
macroplot (i.e. *PROP_UNADJ) and dividing by the number of plots in the
strata/estimation unit).
</p>
<p>An adjustment factor is determined for each tree based on the size of the
plot it was measured on. This is identified using TPA_UNADJ as follows:
</p>

<table>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <b>PLOT SIZE</b> </td>
<td style="text-align: right;"> <b>TPA_UNADJ</b> </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> SUBPLOT
</td>
<td style="text-align: right;"> 6.018046 </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> MICROPLOT </td>
<td style="text-align: right;"> 74.965282 </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> MACROPLOT </td>
<td style="text-align: right;">
0.999188 </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p>If ACI=FALSE, only nonsampled forest conditions are accounted for in the
adjustment factor. <br> If ACI=TRUE, the nonsampled nonforest conditions are
removed as well and accounted for in adjustment factor.  This is if you are
interested in estimates for all lands or nonforest lands in the
All-Condition-Inventory.
</p>
<p>unitcombine:<br> If TRUE and less than 2 plots in any one estimation unit,
all estimation units with 10 or less plots are combined. The current method
for combining is to group the estimation unit with less than 10 plots with
the estimation unit following in consecutive order (numeric or
alphabetical), restrained by survey unit (UNITCD) if included in dataset,
and continuing until the number of plots equals 10. If there are no
estimation units following in order, it is combined with the estimation unit
previous in order.
</p>
<p>stratcombine:<br> If TRUE and less than 2 plots in any one strata class
within an estimation unit, all strata classes with 2 or less plots are
combined. The current method for combining is to group the strata with less
than 2 plots with the strata class following in consecutive order (numeric
or alphabetical), restrained by estimation unit (if unitcombine=FALSE), and
continuing until the number of plots equals 10. If there are no strata
classes following in order, it is combined with the estimation unit previous
in order.
</p>


<h3>Author(s)</h3>

<p>Tracey S. Frescino, Paul L. Patterson, Elizabeth A. Freeman
</p>


<h3>References</h3>

<p>Scott, Charles T.; Bechtold, William A.; Reams, Gregory A.;
Smith, William D.; Westfall, James A.; Hansen, Mark H.; Moisen, Gretchen G.
2005. Sample-based estimators used by the Forest Inventory and Analysis
national information management system. Gen. Tech. Rep. SRS-80. Asheville,
NC: U.S. Department of Agriculture, Forest Service, Southern Research
Station, p.53-77.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load necessary data from FIESTA
## Point data
icepntfn &lt;- system.file("extdata",
                        "PB_data/icepnt_utco1135.csv",
                         package = "FIESTA")
icepnt &lt;- read.csv(icepntfn)

## Plot data
icepltfn &lt;- system.file("extdata",
                        "PB_data/icepltassgn_utco1135.csv",
                         package = "FIESTA")
iceplt &lt;- read.csv(icepltfn)

# Percent land cover at Time 1 (2011) for all land in Davis and Salt Lake
# Counties, UT
PBpopdat &lt;- modPBpop(pnt = icepnt, 
                     pltassgn = iceplt,
                     pltassgnid = "plot_id",
                     pntid = "dot_cnt")

str(PBpopdat, max.level = 1)

# We can also create population data for estimates by estimation unit
## Read in data for multiple estimation units
unitareafn &lt;- system.file("extdata", 
                          "PB_data/unitarea_utco1135.csv",
                           package = "FIESTA")
unitarea &lt;- read.csv(unitareafn)

## Run modPBpop
PBpopunit &lt;- modPBpop(pnt = icepnt, 
                      pltassgn = iceplt, 
                      pltassgnid = "plot_id", 
                      pntid = "dot_cnt",
                      unitarea = unitarea, 
                      unitvar = "ESTN_UNIT")
</code></pre>


</div>