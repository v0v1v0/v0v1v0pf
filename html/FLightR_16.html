<div class="container">

<table style="width: 100%;"><tr>
<td>run.particle.filter</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Run Particle Filter</h2>

<h3>Description</h3>

<p>Main function of FLightR, it takes fully prepared object created by <code>make.prerun.object</code> and produces a result object that can be used for plotting etc.
</p>


<h3>Usage</h3>

<pre><code class="language-R">run.particle.filter(
  all.out,
  cpus = NULL,
  threads = -1,
  nParticles = 1e+06,
  known.last = TRUE,
  precision.sd = 25,
  behav.mask.low.value = 0,
  k = NA,
  plot = TRUE,
  cluster.type = "PSOCK",
  a = 45,
  b = 1500,
  L = 90,
  adaptive.resampling = 0.99,
  check.outliers = FALSE,
  sink2file = FALSE,
  add.jitter = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>all.out</code></td>
<td>
<p>An object created by <code>make.prerun.object</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cpus</code></td>
<td>
<p>another way to specify  <code>threads</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threads</code></td>
<td>
<p>An amount of threads to use while running in parallel. default is -1. if value 1 submitted package will run sequentially</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nParticles</code></td>
<td>
<p>total amount of particles to be used with the run. 10 000 (1e4) is recommended for the preliminary run and 1 000 000 (1e6) for the final</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>known.last</code></td>
<td>
<p>Set to FALSE if your bird was not at a known place during last twilight in the data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>precision.sd</code></td>
<td>
<p>if <code>known.last</code> then what is the precision of this information. Will be used to resample particles proportionally to their distance from the known last point with probability <code>P = dnorm(0, precision.sd)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>behav.mask.low.value</code></td>
<td>
<p>Probability value that will be used instead of 0 in the behavioural mask. If set to 1 behavioural mask will not be active anymore</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>Kappa parameter from vonMises distribution. Default is NA, otherwise will generate particles in a direction of a previous transitions with kappa = k</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>Should function plot preliminary map in the end of the run?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster.type</code></td>
<td>
<p>see help to package parallel for details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>minimum distance that is used in the movement model - left boundary for truncated normal distribution of distances moved between twilights. Default is 45 for as default grid has a minimum distance of 50 km.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>Maximum distance allowed to fly between two consecutive twilights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>how many consecutive particles to resample</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive.resampling</code></td>
<td>
<p>Above what level of ESS resampling should be skipped</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check.outliers</code></td>
<td>
<p>switches ON the online outlier routine</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sink2file</code></td>
<td>
<p>will write run details in a file instead of showing on the screen</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.jitter</code></td>
<td>
<p>will add spatial jitter inside a grid cell for the median estimates</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>FLightR object, containing output and extracted results. It is a list with the following elements 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Indices</code></td>
<td>
<p>List with prior information and indices</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Spatial</code></td>
<td>
<p>Spatial data - Grid, Mask, spatial likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Calibration</code></td>
<td>
<p>all calibration parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Data</code></td>
<td>
<p>original data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Results</code></td>
<td>
<p>The main results object. Main components of it are
</p>

<dl>
<dt>Quantiles</dt>
<dd>
<p>dataframe containing results on locations. Each line corresponds to a twilight</p>
</dd>
<dt>Movement.results</dt>
<dd>
<p>dataframe containing all the movement results, Note - time at line n means time of the end of transition between n and n-1</p>
</dd>
<dt>outliers</dt>
<dd>
<p>id of twilights excluded by online outlier detection tool</p>
</dd>
<dt>LL</dt>
<dd>
<p>-Log likelihood</p>
</dd>
<dt>Points.rle</dt>
<dd>
<p>run length encoding object with posterior distribution for every twilight. Note that numbers of points correspond to line numbers in <code>$Spatial$Grid</code></p>
</dd>
<dt>Transitions.rle</dt>
<dd>
<p>run length encoding object with all the transitions</p>
</dd>
</dl>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Eldar Rakhimberdiev
</p>


<h3>Examples</h3>

<pre><code class="language-R">File&lt;-system.file("extdata", "Godwit_TAGS_format.csv", package = "FLightR")
# to run example fast we will cut the real data file by 2013 Aug 20
Proc.data&lt;-get.tags.data(File, end.date=as.POSIXct('2013-07-02', tz='GMT'))
Calibration.periods&lt;-data.frame(
       calibration.start=NA,
       calibration.stop=as.POSIXct("2013-08-20", tz='GMT'),
       lon=5.43, lat=52.93) 
       #use c() also for the geographic coordinates, if you have more than one calibration location
       # (e. g.,  lon=c(5.43, 6.00), lat=c(52.93,52.94))
print(Calibration.periods)

# NB Below likelihood.correction is set to FALSE for fast run! 
# Leave it as default TRUE for real examples
Calibration&lt;-make.calibration(Proc.data, Calibration.periods, likelihood.correction=FALSE)

Grid&lt;-make.grid(left=0, bottom=50, right=10, top=56,
  distance.from.land.allowed.to.use=c(-Inf, Inf),
  distance.from.land.allowed.to.stay=c(-Inf, Inf))

all.in&lt;-make.prerun.object(Proc.data, Grid, start=c(5.43, 52.93),
                             Calibration=Calibration, threads=2)
# here we will run only 1e4 partilces for a very short track.
# One should use 1e6 particles for the full run.
Result&lt;-run.particle.filter(all.in, threads=1,
           nParticles=1e3, known.last=TRUE,
           precision.sd=25, check.outliers=FALSE)

</code></pre>


</div>