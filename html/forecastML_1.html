<div class="container">

<table style="width: 100%;"><tr>
<td>combine_forecasts</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Combine multiple horizon-specific forecast models to produce one forecast</h2>

<h3>Description</h3>

<p>The horizon-specific models can either be combined to (a) produce final forecasts for only those
horizons at which they were trained (i.e., shorter-horizon models override longer-horizon models
when producing final short-horizon h-step-ahead forecasts) or (b) produce final forecasts using
any combination of horizon-specific models that minimized error over the validation/training dataset.
</p>


<h3>Usage</h3>

<pre><code class="language-R">combine_forecasts(
  ...,
  type = c("horizon", "error"),
  aggregate = stats::median,
  data_error = list(NULL),
  metric = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>One or more objects of class 'forecast_results' from running <code>predict.forecast_model()</code> on
an input forward-looking forecast dataset. These are the forecasts from the horizon-specific
direct forecasting models trained over the entire training dataset by setting <code>create_windows(..., window_length = 0)</code>.
If multiple models are passed in <code>...</code> with the same direct forecast horizon, for <code>type = 'horizon'</code>,
forecasts for the same direct forecast horizon are combined with <code>aggregate</code>; for <code>type = 'error'</code>, the model that
minimizes the error metric at the given direct forecast horizon produces the forecast.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Default: 'horizon'. A character vector of length 1 that identifies the forecast combination method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate</code></td>
<td>
<p>Default <code>median</code> for <code>type = 'horizon'</code>. A function–without parentheses–that aggregates forecasts if
more than one model passed in <code>...</code> has the same direct forecast horizon and <code>type = 'horizon'].</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_error</code></td>
<td>
<p>Optional. A list of objects of class 'validation_error' from running <code>return_error()</code>
on a training dataset. The length and order of <code>data_error</code> should match the models passed in <code>...</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>Required if <code>data_error</code> is given. A length 1 character vector naming the forecast
error metric used to select the optimal model at each forecast horizon from the models passed
in '...' e.g., 'mae'.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An S3 object of class 'forecastML' with final h-step-ahead forecasts.
</p>
<p><strong>Forecast combination type:</strong>
</p>

<ul>
<li> <p><code>type = 'horizon'</code>: 1 final h-step-ahead forecast is returned for each model object passed in <code>...</code>.
</p>
</li>
<li> <p><code>type = 'error'</code>: 1 final h-step-ahead forecast is returned by selecting, for each forecast horizon,
the model that minimized the chosen error metric at that horizon on the outer-loop validation data sets.
</p>
</li>
</ul>
<p><strong>Columns in returned 'forecastML' data.frame:</strong>
</p>

<ul>
<li> <p><code>model</code>: User-supplied model name in <code>train_model()</code>.
</p>
</li>
<li> <p><code>model_forecast_horizon</code>: The direct-forecasting time horizon that the model was trained on.
</p>
</li>
<li> <p><code>horizon</code>: Forecast horizons, 1:h, measured in dataset rows.
</p>
</li>
<li> <p><code>forecast_period</code>: The forecast period in row indices or dates. The forecast period starts at either <code>attributes(create_lagged_df())$data_stop + 1</code> for row indices or <code>attributes(create_lagged_df())$data_stop + 1 * frequency</code> for date indices.
</p>
</li>
<li> <p><code>"groups"</code>: If given, the user-supplied groups in <code>create_lagged_df()</code>.
</p>
</li>
<li> <p><code>"outcome_name"_pred</code>: The final forecasts.
</p>
</li>
<li> <p><code>"outcome_name"_pred_lower</code>: If given, the lower forecast bounds returned by the user-supplied prediction function.
</p>
</li>
<li> <p><code>"outcome_name"_pred_upper</code>: If given, the upper forecast bounds returned by the user-supplied prediction function.
</p>
</li>
</ul>
<h3>Methods and related functions</h3>

<p>The output of <code>combine_forecasts()</code> has the following generic S3 methods
</p>

<ul><li> <p><code>plot</code>
</p>
</li></ul>
<h3>Examples</h3>

<pre><code class="language-R"># Example with "type = 'horizon'".
data("data_seatbelts", package = "forecastML")

horizons &lt;- c(1, 3, 12)
lookback &lt;- 1:15

data_train &lt;- create_lagged_df(data_seatbelts, type = "train", outcome_col = 1,
                               lookback = lookback, horizon = horizons)

windows &lt;- create_windows(data_train, window_length = 0)

model_function &lt;- function(data, my_outcome_col) {
  model &lt;- lm(DriversKilled ~ ., data = data)
  return(model)
}

model_results &lt;- train_model(data_train, windows, model_name = "LM", model_function)

data_forecast &lt;- create_lagged_df(data_seatbelts, type = "forecast", outcome_col = 1,
                                  lookback = lookback, horizon = horizons)

prediction_function &lt;- function(model, data_features) {
  x &lt;- data_features
  data_pred &lt;- data.frame("y_pred" = predict(model, newdata = x))
  return(data_pred)
}

data_forecasts &lt;- predict(model_results, prediction_function = list(prediction_function),
                          data = data_forecast)

data_combined &lt;- combine_forecasts(data_forecasts)

plot(data_combined)
</code></pre>


</div>