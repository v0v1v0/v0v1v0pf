<div class="container">

<table style="width: 100%;"><tr>
<td>balance_hierarchy</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Aggregation matrix of a (possibly) unbalanced hierarchy in balanced form</h2>

<h3>Description</h3>

<p>A hierarchy with <code class="reqn">L</code> upper levels is said to be balanced if each variable at level
<code class="reqn">l</code> has at least one child at level <code class="reqn">l+1</code>. When this doesn't hold, the hierarchy
is unbalanced. This function transforms an aggregation matrix of an unbalanced hierarchy
into an aggregation matrix of a balanced one. This function is used to reconcile forecasts
with cslcc, which operates exclusively with balanced hierarchies.
</p>


<h3>Usage</h3>

<pre><code class="language-R">balance_hierarchy(agg_mat, nodes = "auto", sparse = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>agg_mat</code></td>
<td>
<p>A (<code class="reqn">n_a \times n_b</code>) numeric matrix representing the cross-sectional
aggregation matrix. It maps the <code class="reqn">n_b</code> bottom-level (free)
variables into the <code class="reqn">n_a</code> upper (constrained) variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodes</code></td>
<td>
<p>A (<code class="reqn">L \times 1</code>) numeric vector indicating the number of variables
in each of the upper <code class="reqn">L</code> levels of the hierarchy. The <em>default</em>
value is the string "<code>auto</code>" which calculates the number of variables in each level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse</code></td>
<td>
<p>Option to return sparse matrices (<em>default</em> is <code>TRUE</code>).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list containing four elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>bam</code></td>
<td>
<p>The balanced aggregation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agg_mat</code></td>
<td>
<p>The input matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodes</code></td>
<td>
<p>A (<code class="reqn">L \times 1</code>) numeric vector indicating the number of variables
in each of the <code class="reqn">L</code> upper levels of the balanced hierarchy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>The identification number of each variable in the balanced hierarchy.
It may contains duplicated values.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p>Utilities: 
<code>FoReco2matrix()</code>,
<code>aggts()</code>,
<code>commat()</code>,
<code>csprojmat()</code>,
<code>cstools()</code>,
<code>ctprojmat()</code>,
<code>cttools()</code>,
<code>df2aggmat()</code>,
<code>lcmat()</code>,
<code>recoinfo()</code>,
<code>res2matrix()</code>,
<code>shrink_estim()</code>,
<code>teprojmat()</code>,
<code>tetools()</code>,
<code>unbalance_hierarchy()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#    Unbalanced     -&gt;      Balanced
#        T                     T
#    |-------|             |-------|
#    A       |             A       B
#  |---|     |           |---|     |
# AA   AB    B          AA   AB    BA
A &lt;- matrix(c(1, 1, 1,
              1, 1, 0), 2, byrow = TRUE)
obj &lt;- balance_hierarchy(agg_mat = A, nodes = c(1, 1))
obj$bam
</code></pre>


</div>