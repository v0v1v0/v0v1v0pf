<div class="container">

<table style="width: 100%;"><tr>
<td>boot_predict</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bootstrap simulation for model prediction</h2>

<h3>Description</h3>

<p>Generate model predictions against a specified set of explanatory levels with
bootstrapped confidence intervals. Add a comparison by difference or ratio of
the first row of <code>newdata</code> with all subsequent rows.
</p>


<h3>Usage</h3>

<pre><code class="language-R">boot_predict(
  fit,
  newdata,
  type = "response",
  R = 100,
  estimate_name = NULL,
  confint_level = 0.95,
  conf.method = "perc",
  confint_sep = " to ",
  condense = TRUE,
  boot_compare = TRUE,
  compare_name = NULL,
  comparison = "difference",
  ref_symbol = "-",
  digits = c(2, 3)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>A model generated using <code>lm</code>, <code>glm</code>,
<code>lmmulti</code>, and <code>glmmulti</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>Dataframe usually generated with
<code>finalfit_newdata</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>the type of prediction required, see
<code>predict.glm</code>. The default for glm models is on the
scale of the response variable. Thus for a binomial model the default
predictions are predicted probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>Number of simulations. Note default R=100 is very low.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate_name</code></td>
<td>
<p>Name to be given to prediction variable y-hat.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confint_level</code></td>
<td>
<p>The confidence level to use for the confidence interval. 
Must be strictly greater than 0 and less than 1. Defaults to 0.95, 
which corresponds to a 95 percent confidence interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.method</code></td>
<td>
<p>Passed to the type argument of boot::boot.ci(). 
Defaults to "perc". The allowed types are "perc", "basic", "bca", and "norm". 
Does not support "stud" or "all"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confint_sep</code></td>
<td>
<p>String separating lower and upper confidence interval</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condense</code></td>
<td>
<p>Logical. FALSE gives numeric values, usually for plotting.
TRUE gives table for final output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot_compare</code></td>
<td>
<p>Include a comparison with the first row of <code>newdata</code>
with all subsequent rows. See <code>boot_compare</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare_name</code></td>
<td>
<p>Name to be given to comparison metric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comparison</code></td>
<td>
<p>Either "difference" or "ratio".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_symbol</code></td>
<td>
<p>Reference level symbol</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Rounding for estimate values and p-values, default c(2,3).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To use this, first generate <code>newdata</code> for specified levels of
explanatory variables using <code>finalfit_newdata</code>. Pass model
objects from <code>lm</code>, <code>glm</code>, <code>lmmulti</code>, and
<code>glmmulti</code>. The comparison metrics are made on individual
bootstrap samples distribution returned as a mean with confidence intervals.
A p-value is generated on the proportion of values on the other side of the
null from the mean, e.g. for a ratio greater than 1.0, p is the number of
bootstrapped predictions under 1.0, multiplied by two so is two-sided.
</p>


<h3>Value</h3>

<p>A dataframe of predicted values and confidence intervals, with the
option of including a comparison of difference between first row and all
subsequent rows of <code>newdata</code>.
</p>


<h3>See Also</h3>

<p>finalfit_newdata
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(finalfit)
library(dplyr)

# Predict probability of death across combinations of factor levels
explanatory = c("age.factor", "extent.factor", "perfor.factor")
dependent = 'mort_5yr'

# Generate combination of factor levels
colon_s %&gt;%
  finalfit_newdata(explanatory = explanatory, newdata = list(
    c("&lt;40 years",  "Submucosa", "No"),
    c("&lt;40 years", "Submucosa", "Yes"),
    c("&lt;40 years", "Adjacent structures", "No"),
    c("&lt;40 years", "Adjacent structures", "Yes")
   )) -&gt; newdata

# Run simulation
colon_s %&gt;%
  glmmulti(dependent, explanatory) %&gt;%
  boot_predict(newdata, estimate_name = "Predicted probability of death",
    compare_name = "Absolute risk difference", R=100, digits = c(2,3))

# Plotting
explanatory = c("nodes", "extent.factor", "perfor.factor")
colon_s %&gt;%
  finalfit_newdata(explanatory = explanatory, rowwise = FALSE, newdata = list(
  rep(seq(0, 30), 4),
  c(rep("Muscle", 62), rep("Adjacent structures", 62)),
  c(rep("No", 31), rep("Yes", 31), rep("No", 31), rep("Yes", 31))
)) -&gt; newdata

colon_s %&gt;%
  glmmulti(dependent, explanatory) %&gt;%
  boot_predict(newdata, boot_compare = FALSE, R=100, condense=FALSE) -&gt; plot

  library(ggplot2)
  theme_set(theme_bw())
  plot %&gt;%
    ggplot(aes(x = nodes, y = estimate, ymin = estimate_conf.low,
        ymax = estimate_conf.high, fill=extent.factor))+
      geom_line(aes(colour = extent.factor))+
      geom_ribbon(alpha=0.1)+
      facet_grid(.~perfor.factor)+
      xlab("Number of postive lymph nodes")+
      ylab("Probability of death")+
      labs(fill = "Extent of tumour", colour = "Extent of tumour")+
      ggtitle("Probability of death by lymph node count")
</code></pre>


</div>