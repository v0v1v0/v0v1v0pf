<div class="container">

<table style="width: 100%;"><tr>
<td>train_model</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Train a model across horizons and validation datasets</h2>

<h3>Description</h3>

<p>Train a user-defined forecast model for each horizon, 'h', and across the validation
datasets, 'd'. If <code>method = "direct"</code>, a total of 'h' * 'd' models are trained.
If <code>method = "multi_output"</code>, a total of 1 * 'd' models are trained.
These models can be trained in parallel with the <code>future</code> package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">train_model(
  lagged_df,
  windows,
  model_name,
  model_function,
  ...,
  use_future = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lagged_df</code></td>
<td>
<p>An object of class 'lagged_df' from <code>create_lagged_df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>windows</code></td>
<td>
<p>An object of class 'windows' from <code>create_windows</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_name</code></td>
<td>
<p>A name for the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_function</code></td>
<td>
<p>A user-defined wrapper function for model training that takes the following
arguments: (1) a horizon-specific data.frame made with <code>create_lagged_df(..., type = "train")</code>
(i.e., the dataset(s) stored in <code>lagged_df</code>) and, optionally, (2) any number of additional named arguments
which can be passed in <code>...</code> in this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Optional. Named arguments passed into the user-defined <code>model_function</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_future</code></td>
<td>
<p>Boolean. If <code>TRUE</code>, the <code>future</code> package is used for training models in parallel.
The models will train in parallel across either (1) model forecast horizons or (b) validation windows,
whichever is longer (i.e., <code>length(create_lagged_df())</code> or <code>nrow(create_windows())</code>). The user
should run <code>future::plan(future::multiprocess)</code> or similar prior to this function to train these models
in parallel.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An S3 object of class 'forecast_model': A nested list of trained models. Models can be accessed with
<code>my_trained_model$horizon_h$window_w$model</code> where 'h' gives the forecast horizon and 'w' gives
the validation dataset window number from <code>create_windows()</code>.
</p>


<h3>Methods and related functions</h3>

<p>The output of <code>train_model</code> can be passed into
</p>

<ul>
<li> <p><code>return_error</code>
</p>
</li>
<li> <p><code>return_hyper</code>
</p>
</li>
</ul>
<p>and has the following generic S3 methods
</p>

<ul>
<li> <p><code>predict</code>
</p>
</li>
<li> <p><code>plot</code> (from <code>predict.forecast_model(data = create_lagged_df(..., type = "train"))</code>)
</p>
</li>
<li> <p><code>plot</code> (from <code>predict.forecast_model(data = create_lagged_df(..., type = "forecast"))</code>)
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R"># Sampled Seatbelts data from the R package datasets.
data("data_seatbelts", package = "forecastML")

# Example - Training data for 2 horizon-specific models w/ common lags per predictor.
horizons &lt;- c(1, 12)
lookback &lt;- 1:15

data_train &lt;- create_lagged_df(data_seatbelts, type = "train", outcome_col = 1,
                               lookback = lookback, horizon = horizons)

# One custom validation window at the end of the dataset.
windows &lt;- create_windows(data_train, window_start = 181, window_stop = 192)

# User-define model - LASSO
# A user-defined wrapper function for model training that takes the following
# arguments: (1) a horizon-specific data.frame made with create_lagged_df(..., type = "train")
# (e.g., my_lagged_df$horizon_h) and, optionally, (2) any number of additional named arguments
# which are passed as '...' in train_model().
library(glmnet)
model_function &lt;- function(data, my_outcome_col) {

  x &lt;- data[, -(my_outcome_col), drop = FALSE]
  y &lt;- data[, my_outcome_col, drop = FALSE]
  x &lt;- as.matrix(x, ncol = ncol(x))
  y &lt;- as.matrix(y, ncol = ncol(y))

  model &lt;- glmnet::cv.glmnet(x, y, nfolds = 3)
  return(model)
}

# my_outcome_col = 1 is passed in ... but could have been defined in model_function().
model_results &lt;- train_model(data_train, windows, model_name = "LASSO", model_function,
                             my_outcome_col = 1)

# View the results for the model (a) trained on the first horizon
# and (b) to be assessed on the first outer-loop validation window.
model_results$horizon_1$window_1$model
</code></pre>


</div>