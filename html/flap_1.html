<div class="container">

<table style="width: 100%;"><tr>
<td>flap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Forecast Linear Augmented Projection</h2>

<h3>Description</h3>

<p>Reduces forecast variance by adjusting the forecasts of multivariate time
series to be consistent with the forecasts of linear combinations (components)
of the series by projecting all forecasts onto the space where the linear
constraints are satisfied.
</p>


<h3>Usage</h3>

<pre><code class="language-R">flap(fc, fc_comp, Phi, res, res_comp, p = seq_len(ncol(fc_comp)))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fc</code></td>
<td>
<p>An <code class="reqn">h</code> by <code class="reqn">m</code> matrix of base forecasts of the original
series to be projected. <code class="reqn">h</code> is the forecast horizon and <code class="reqn">m</code> is the
total number of series.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fc_comp</code></td>
<td>
<p>An <code class="reqn">h</code> by <code class="reqn">p</code> matrix of base forecasts of the components
used in the projection. <code class="reqn">h</code> is the forecast horizon and <code class="reqn">p</code> is the
total number of components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Phi</code></td>
<td>
<p>A <code class="reqn">p</code> by <code class="reqn">m</code> weight matrix mapping the original series into
the components such that <code class="reqn">c_t = \Phi z_t</code> where <code class="reqn">c_t</code> is the vector of
components and <code class="reqn">z_t</code> is the vector of original series.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p>A <code class="reqn">T</code> by <code class="reqn">m</code> (in-sample) forecast residual matrix of the
original series.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res_comp</code></td>
<td>
<p>A <code class="reqn">T</code> by <code class="reqn">p</code> (in-sample) forecast residual matrix of
the components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>The number of components to use in the projection. The default is
trying all the possible number of components capped at the number provided in
the forecast.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of class <code>flap</code> with each element containing a <code class="reqn">h</code> by
<code class="reqn">m</code> matrix of projected forecast of the original series for the corresponding
number of components <code>p</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Generate example data
# T = 70, m = 20
train &lt;- matrix(rnorm(70 * 20),ncol = 20)

# Obtain the forecast and the residual of the original series
mdl &lt;- apply(train, 2, forecast::ets)
fc &lt;- vapply(mdl, function(mdl) forecast::forecast(mdl, h=12)$mean,
             FUN.VALUE = numeric(12))
res &lt;- vapply(mdl, residuals, FUN.VALUE = numeric(70))

# Obtain components and their forecasts and residuals
pca &lt;- stats::prcomp(train, center = FALSE, scale. = FALSE)
mdl_comp &lt;- apply(pca$x, 2, forecast::ets)
fc_comp &lt;- vapply(mdl_comp, function(mdl) forecast::forecast(mdl, h=12)$mean,
                  FUN.VALUE = numeric(12))
res_comp &lt;- vapply(mdl_comp, residuals,
                   FUN.VALUE = numeric(nrow(pca$x)))
Phi &lt;- t(pca$rotation)

# flap!
flap(fc, fc_comp, Phi, res, res_comp)

</code></pre>


</div>