<div class="container">

<table style="width: 100%;"><tr>
<td>extract_data</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Internal function to create a familiarData object.</h2>

<h3>Description</h3>

<p>Compute various data related to model performance and calibration
from the provided dataset and <code>familiarEnsemble</code> object and store it as a
<code>familiarData</code> object.
</p>


<h3>Usage</h3>

<pre><code class="language-R">extract_data(
  object,
  data,
  data_element = waiver(),
  is_pre_processed = FALSE,
  cl = NULL,
  time_max = waiver(),
  aggregation_method = waiver(),
  rank_threshold = waiver(),
  ensemble_method = waiver(),
  stratification_method = waiver(),
  evaluation_times = waiver(),
  metric = waiver(),
  feature_cluster_method = waiver(),
  feature_cluster_cut_method = waiver(),
  feature_linkage_method = waiver(),
  feature_similarity_metric = waiver(),
  feature_similarity_threshold = waiver(),
  sample_cluster_method = waiver(),
  sample_linkage_method = waiver(),
  sample_similarity_metric = waiver(),
  sample_limit = waiver(),
  detail_level = waiver(),
  estimation_type = waiver(),
  aggregate_results = waiver(),
  confidence_level = waiver(),
  bootstrap_ci_method = waiver(),
  icc_type = waiver(),
  dynamic_model_loading = FALSE,
  message_indent = 0L,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>A <code>familiarEnsemble</code> object, which is an ensemble of one or more
<code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>dataObject</code> object, <code>data.table</code> or <code>data.frame</code> that
constitutes the data that are assessed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_element</code></td>
<td>
<p>String indicating which data elements are to be extracted.
Default is <code>all</code>, but specific elements can be specified to speed up
computations if not all elements are to be computed. This is an internal
parameter that is set by, e.g. the <code>export_model_vimp</code> method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is_pre_processed</code></td>
<td>
<p>Flag that indicates whether the data was already
pre-processed externally, e.g. normalised and clustered. Only used if the
<code>data</code> argument is a <code>data.table</code> or <code>data.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl</code></td>
<td>
<p>Cluster created using the <code>parallel</code> package. This cluster is then
used to speed up computation through parallellisation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_max</code></td>
<td>
<p>Time point which is used as the benchmark for e.g. cumulative
risks generated by random forest, or the cut-off value for Uno's concordance
index. If not provided explicitly, this parameter is read from settings used
at creation of the underlying <code>familiarModel</code> objects. Only used for
<code>survival</code> outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregation_method</code></td>
<td>
<p>Method for aggregating variable importances for the
purpose of evaluation. Variable importances are determined during feature
selection steps and after training the model. Both types are evaluated, but
feature selection variable importance is only evaluated at run-time.
</p>
<p>See the documentation for the <code>vimp_aggregation_method</code> argument in
<code>summon_familiar</code> for information concerning the different available
methods.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rank_threshold</code></td>
<td>
<p>The threshold used to  define the subset of highly
important features during evaluation.
</p>
<p>See the documentation for the <code>vimp_aggregation_rank_threshold</code> argument in
<code>summon_familiar</code> for more information.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ensemble_method</code></td>
<td>
<p>Method for ensembling predictions from models for the
same sample. Available methods are:
</p>

<ul>
<li> <p><code>median</code> (default): Use the median of the predicted values as the ensemble
value for a sample.
</p>
</li>
<li> <p><code>mean</code>: Use the mean of the predicted values as the ensemble value for a
sample.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratification_method</code></td>
<td>
<p>(<em>optional</em>) Method for determining the
stratification threshold for creating survival groups. The actual,
model-dependent, threshold value is obtained from the development data, and
can afterwards be used to perform stratification on validation data.
</p>
<p>The following stratification methods are available:
</p>

<ul>
<li> <p><code>median</code> (default): The median predicted value in the development cohort
is used to stratify the samples into two risk groups. For predicted outcome
values that build a continuous spectrum, the two risk groups in the
development cohort will be roughly equal in size.
</p>
</li>
<li> <p><code>mean</code>: The mean predicted value in the development cohort is used to
stratify the samples into two risk groups.
</p>
</li>
<li> <p><code>mean_trim</code>: As <code>mean</code>, but based on the set of predicted values
where the 5% lowest and 5% highest values are discarded. This reduces the
effect of outliers.
</p>
</li>
<li> <p><code>mean_winsor</code>: As <code>mean</code>, but based on the set of predicted values where
the 5% lowest and 5% highest values are winsorised. This reduces the effect
of outliers.
</p>
</li>
<li> <p><code>fixed</code>: Samples are stratified based on the sample quantiles of the
predicted values. These quantiles are defined using the
<code>stratification_threshold</code> parameter.
</p>
</li>
<li> <p><code>optimised</code>: Use maximally selected rank statistics to determine the
optimal threshold (Lausen and Schumacher, 1992; Hothorn et al., 2003) to
stratify samples into two optimally separated risk groups.
</p>
</li>
</ul>
<p>One or more stratification methods can be selected simultaneously.
</p>
<p>This parameter is only relevant for <code>survival</code> outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>evaluation_times</code></td>
<td>
<p>One or more time points that are used for in analysis of
survival problems when data has to be assessed at a set time, e.g.
calibration. If not provided explicitly, this parameter is read from
settings used at creation of the underlying <code>familiarModel</code> objects. Only
used for <code>survival</code> outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>One or more metrics for assessing model performance. See the
vignette on performance metrics for the available metrics. If not provided
explicitly, this parameter is read from settings used at creation of the
underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_cluster_method</code></td>
<td>
<p>The method used to perform clustering. These are
the same methods as for the <code>cluster_method</code> configuration parameter:
<code>none</code>, <code>hclust</code>, <code>agnes</code>, <code>diana</code> and <code>pam</code>.
</p>
<p><code>none</code> cannot be used when extracting data regarding mutual correlation or
feature expressions.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_cluster_cut_method</code></td>
<td>
<p>The method used to divide features into
separate clusters. The available methods are the same as for the
<code>cluster_cut_method</code> configuration parameter: <code>silhouette</code>, <code>fixed_cut</code> and
<code>dynamic_cut</code>.
</p>
<p><code>silhouette</code> is available for all cluster methods, but <code>fixed_cut</code> only
applies to methods that create hierarchical trees (<code>hclust</code>, <code>agnes</code> and
<code>diana</code>). <code>dynamic_cut</code> requires the <code>dynamicTreeCut</code> package and can only
be used with <code>agnes</code> and <code>hclust</code>.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_linkage_method</code></td>
<td>
<p>The method used for agglomerative clustering in
<code>hclust</code> and <code>agnes</code>. These are the same methods as for the
<code>cluster_linkage_method</code> configuration parameter: <code>average</code>, <code>single</code>,
<code>complete</code>, <code>weighted</code>, and <code>ward</code>.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_similarity_metric</code></td>
<td>
<p>Metric to determine pairwise similarity
between features. Similarity is computed in the same manner as for
clustering, and <code>feature_similarity_metric</code> therefore has the same options
as <code>cluster_similarity_metric</code>: <code>mcfadden_r2</code>, <code>cox_snell_r2</code>,
<code>nagelkerke_r2</code>, <code>spearman</code>, <code>kendall</code> and <code>pearson</code>.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_similarity_threshold</code></td>
<td>
<p>The threshold level for pair-wise
similarity that is required to form feature clusters with the <code>fixed_cut</code>
method.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_cluster_method</code></td>
<td>
<p>The method used to perform clustering based on
distance between samples. These are the same methods as for the
<code>cluster_method</code> configuration parameter: <code>hclust</code>, <code>agnes</code>, <code>diana</code> and
<code>pam</code>.
</p>
<p><code>none</code> cannot be used when extracting data for feature expressions.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_linkage_method</code></td>
<td>
<p>The method used for agglomerative clustering in
<code>hclust</code> and <code>agnes</code>. These are the same methods as for the
<code>cluster_linkage_method</code> configuration parameter: <code>average</code>, <code>single</code>,
<code>complete</code>, <code>weighted</code>, and <code>ward</code>.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_similarity_metric</code></td>
<td>
<p>Metric to determine pairwise similarity
between samples. Similarity is computed in the same manner as for
clustering, but <code>sample_similarity_metric</code> has different options that are
better suited to computing distance between samples instead of between
features: <code>gower</code>, <code>euclidean</code>.
</p>
<p>The underlying feature data is scaled to the <code class="reqn">[0, 1]</code> range (for
numerical features) using the feature values across the samples. The
normalisation parameters required can optionally be computed from feature
data with the outer 5% (on both sides) of feature values trimmed or
winsorised. To do so append <code style="white-space: pre;">⁠_trim⁠</code> (trimming) or <code style="white-space: pre;">⁠_winsor⁠</code> (winsorising) to
the metric name. This reduces the effect of outliers somewhat.
</p>
<p>If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_limit</code></td>
<td>
<p>(<em>optional</em>) Set the upper limit of the number of samples
that are used during evaluation steps. Cannot be less than 20.
</p>
<p>This setting can be specified per data element by providing a parameter
value in a named list with data elements, e.g.
<code>list("sample_similarity"=100, "permutation_vimp"=1000)</code>.
</p>
<p>This parameter can be set for the following data elements:
<code>sample_similarity</code> and <code>ice_data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>detail_level</code></td>
<td>
<p>(<em>optional</em>) Sets the level at which results are computed
and aggregated.
</p>

<ul>
<li> <p><code>ensemble</code>: Results are computed at the ensemble level, i.e. over all
models in the ensemble. This means that, for example, bias-corrected
estimates of model performance are assessed by creating (at least) 20
bootstraps and computing the model performance of the ensemble model for
each bootstrap.
</p>
</li>
<li> <p><code>hybrid</code> (default): Results are computed at the level of models in an
ensemble. This means that, for example, bias-corrected estimates of model
performance are directly computed using the models in the ensemble. If there
are at least 20 trained models in the ensemble, performance is computed for
each model, in contrast to <code>ensemble</code> where performance is computed for the
ensemble of models. If there are less than 20 trained models in the
ensemble, bootstraps are created so that at least 20 point estimates can be
made.
</p>
</li>
<li> <p><code>model</code>: Results are computed at the model level. This means that, for
example, bias-corrected estimates of model performance are assessed by
creating (at least) 20 bootstraps and computing the performance of the model
for each bootstrap.
</p>
</li>
</ul>
<p>Note that each level of detail has a different interpretation for bootstrap
confidence intervals. For <code>ensemble</code> and <code>model</code> these are the confidence
intervals for the ensemble and an individual model, respectively. That is,
the confidence interval describes the range where an estimate produced by a
respective ensemble or model trained on a repeat of the experiment may be
found with the probability of the confidence level. For <code>hybrid</code>, it
represents the range where any single model trained on a repeat of the
experiment may be found with the probability of the confidence level. By
definition, confidence intervals obtained using <code>hybrid</code> are at least as
wide as those for <code>ensemble</code>. <code>hybrid</code> offers the correct interpretation if
the goal of the analysis is to assess the result of a single, unspecified,
model.
</p>
<p><code>hybrid</code> is generally computationally less expensive then <code>ensemble</code>, which
in turn is somewhat less expensive than <code>model</code>.
</p>
<p>A non-default <code>detail_level</code> parameter can be specified for separate
evaluation steps by providing a parameter value in a named list with data
elements, e.g. <code>list("auc_data"="ensemble", "model_performance"="hybrid")</code>.
This parameter can be set for the following data elements: <code>auc_data</code>,
<code>decision_curve_analyis</code>, <code>model_performance</code>, <code>permutation_vimp</code>,
<code>ice_data</code>, <code>prediction_data</code> and <code>confusion_matrix</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimation_type</code></td>
<td>
<p>(<em>optional</em>) Sets the type of estimation that should be
possible. This has the following options:
</p>

<ul>
<li> <p><code>point</code>: Point estimates.
</p>
</li>
<li> <p><code>bias_correction</code> or <code>bc</code>: Bias-corrected estimates. A bias-corrected
estimate is computed from (at least) 20 point estimates, and <code>familiar</code> may
bootstrap the data to create them.
</p>
</li>
<li> <p><code>bootstrap_confidence_interval</code> or <code>bci</code> (default): Bias-corrected
estimates with bootstrap confidence intervals (Efron and Hastie, 2016). The
number of point estimates required depends on the <code>confidence_level</code>
parameter, and <code>familiar</code> may bootstrap the data to create them.
</p>
</li>
</ul>
<p>As with <code>detail_level</code>, a non-default <code>estimation_type</code> parameter can be
specified for separate evaluation steps by providing a parameter value in a
named list with data elements, e.g. <code>list("auc_data"="bci", "model_performance"="point")</code>. This parameter can be set for the following
data elements: <code>auc_data</code>, <code>decision_curve_analyis</code>, <code>model_performance</code>,
<code>permutation_vimp</code>, <code>ice_data</code>, and <code>prediction_data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate_results</code></td>
<td>
<p>(<em>optional</em>) Flag that signifies whether results
should be aggregated during evaluation. If <code>estimation_type</code> is
<code>bias_correction</code> or <code>bc</code>, aggregation leads to a single bias-corrected
estimate. If <code>estimation_type</code> is <code>bootstrap_confidence_interval</code> or <code>bci</code>,
aggregation leads to a single bias-corrected estimate with lower and upper
boundaries of the confidence interval. This has no effect if
<code>estimation_type</code> is <code>point</code>.
</p>
<p>The default value is equal to <code>TRUE</code> except when assessing metrics to assess
model performance, as the default violin plot requires underlying data.
</p>
<p>As with <code>detail_level</code> and <code>estimation_type</code>, a non-default
<code>aggregate_results</code> parameter can be specified for separate evaluation steps
by providing a parameter value in a named list with data elements, e.g.
<code>list("auc_data"=TRUE, , "model_performance"=FALSE)</code>. This parameter exists
for the same elements as <code>estimation_type</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confidence_level</code></td>
<td>
<p>(<em>optional</em>) Numeric value for the level at which
confidence intervals are determined. In the case bootstraps are used to
determine the confidence intervals bootstrap estimation, <code>familiar</code> uses the
rule of thumb <code class="reqn">n = 20 / ci.level</code> to determine the number of required
bootstraps.
</p>
<p>The default value is <code>0.95</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bootstrap_ci_method</code></td>
<td>
<p>(<em>optional</em>) Method used to determine bootstrap
confidence intervals (Efron and Hastie, 2016). The following methods are
implemented:
</p>

<ul>
<li> <p><code>percentile</code> (default): Confidence intervals obtained using the percentile
method.
</p>
</li>
<li> <p><code>bc</code>: Bias-corrected confidence intervals.
</p>
</li>
</ul>
<p>Note that the standard method is not implemented because this method is
often not suitable due to non-normal distributions. The bias-corrected and
accelerated (BCa) method is not implemented yet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>icc_type</code></td>
<td>
<p>String indicating the type of intraclass correlation
coefficient (<code>1</code>, <code>2</code> or <code>3</code>) that should be used to compute robustness for
features in repeated measurements during the evaluation of univariate
importance. These types correspond to the types in Shrout and Fleiss (1979).
If not provided explicitly, this parameter is read from settings used at
creation of the underlying <code>familiarModel</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dynamic_model_loading</code></td>
<td>
<p>(<em>optional</em>) Enables dynamic loading of models
during the evaluation process, if <code>TRUE</code>. Defaults to <code>FALSE</code>. Dynamic
loading of models may reduce the overall memory footprint, at the cost of
increased disk or network IO. Models can only be dynamically loaded if they
are found at an accessible disk or network location. Setting this parameter
to <code>TRUE</code> may help if parallel processing causes out-of-memory issues during
evaluation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>message_indent</code></td>
<td>
<p>Number of indentation steps for messages shown during
computation and extraction of various data elements.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Flag to indicate whether feedback should be provided on the
computation and extraction of various data elements.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Unused arguments.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>familiarData</code> object.
</p>


<h3>References</h3>


<ol><li>
<p> Shrout, P. E. &amp; Fleiss, J. L. Intraclass correlations: uses in
assessing rater reliability. Psychol. Bull. 86, 420–428 (1979).
</p>
</li></ol>
</div>