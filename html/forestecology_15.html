<div class="container">

<table style="width: 100%;"><tr>
<td>create_focal_vs_comp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create focal versus competitor trees data frame</h2>

<h3>Description</h3>

<p>"Focal versus competitor trees" data frames are the main data
frame used for analysis. "Focal trees" are all trees that satisfy the
following criteria
</p>

<ol>
<li>
<p> Were alive at both censuses
</p>
</li>
<li>
<p> Were not part of the study region's buffer as computed by <code>add_buffer_variable()</code>
</p>
</li>
<li>
<p> Were not a resprout at the second census. Such trees should be coded as
<code>"R"</code> in the <code>codes2</code> variable (OK if a resprout at first census)
</p>
</li>
</ol>
<p>For each focal tree, "competitor trees" are all trees that (1) were alive at
the first census and (2) within <code>comp_dist</code> distance of the focal tree.
</p>


<h3>Usage</h3>

<pre><code class="language-R">create_focal_vs_comp(growth_df, comp_dist, blocks, id, comp_x_var)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>growth_df</code></td>
<td>
<p>A <code>compute_growth()</code> output converted to <code>sf</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp_dist</code></td>
<td>
<p>Distance to determine which neighboring trees to a focal tree are competitors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocks</code></td>
<td>
<p>An sf object of a <code>blockCV</code> block output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>A character string of the variable name in <code>growth_df</code> uniquely identifying each tree</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp_x_var</code></td>
<td>
<p>A character string indicating which numerical variable to use as competitor explanatory variable</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>focal_vs_comp</code> data frame of all focal trees and for
each focal tree all possible competitor trees. In particular, for
each competitor tree we return <code>comp_x_var</code>. Potential examples of
<code>comp_x_var</code> include
<a href="https://en.wikipedia.org/wiki/Basal_area">basal area</a> or
estimate above ground biomass.
</p>


<h3>Note</h3>

<p>In order to speed computation, in particular of distances between all
focal/competitor tree pairs, we use the cross-validation <code>blockCV</code>
object to divide the study region into smaller subsets.
</p>


<h3>See Also</h3>

<p>Other data processing functions: 
<code>compute_growth()</code>,
<code>create_bayes_lm_data()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(ggplot2)
library(dplyr)
library(stringr)
library(sf)
library(sfheaders)
library(tibble)

# Create fold information sf object.
SpatialBlock_ex &lt;-
  tibble(
    # Study region boundary
    x = c(0, 0, 5, 5),
    y = c(0, 5, 5, 0)
  ) %&gt;%
  # Convert to sf object
  sf_polygon() %&gt;%
  mutate(folds = "1")

# Plot example data. Observe for comp_dist = 1.5, there are 6 focal vs comp pairs:
# 1. focal 1 vs comp 2
# 2. focal 2 vs comp 1
# 3. focal 2 vs comp 3
# 4. focal 3 vs comp 2
# 5. focal 4 vs comp 5
# 6. focal 5 vs comp 4
ggplot() +
  geom_sf(data = SpatialBlock_ex, fill = "transparent") +
  geom_sf_label(data = growth_toy, aes(label = ID))

# Return corresponding data frame
growth_toy %&gt;%
  mutate(basal_area = 0.0001 * pi * (dbh1 / 2)^2) %&gt;%
  create_focal_vs_comp(comp_dist = 1.5, blocks = SpatialBlock_ex, id = "ID",
                       comp_x_var = "basal_area")

# Load in growth_df with spatial data
# See ?growth_ex for attaching spatial data to growth_df
data(growth_spatial_ex)
# Load in blocks
data(blocks_ex)

focal_vs_comp_ex &lt;- growth_spatial_ex %&gt;%
  mutate(basal_area = 0.0001 * pi * (dbh1 / 2)^2) %&gt;%
  create_focal_vs_comp(comp_dist = 1, blocks = blocks_ex, id = "ID",
                       comp_x_var = "basal_area")
</code></pre>


</div>