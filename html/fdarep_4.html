<div class="container">

<table style="width: 100%;"><tr>
<td>DenseProductFPCA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Product Functional Principal Component Analysis for dense repeated functional data.</h2>

<h3>Description</h3>

<p>Note: The code works for dense functional data observed on a regular grid, missing values are allowed, written by Kehui Chen 10/09/2015, based on the original code by Pedro Delicado.
</p>


<h3>Usage</h3>

<pre><code class="language-R">DenseProductFPCA(
  X.age.year,
  n,
  num.years,
  num.ages,
  fpca.op1 = list(),
  fpca.op2 = list(),
  pc.j = NULL,
  pc.k = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X.age.year</code></td>
<td>
<p>An n by (num.years x num.ages) input data matrix, such that the ith row of the matrix gives the observed values for the ith individual. The values in each row are sorted first by years (dimension 1) and then by ages (dimension 2) within each year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>The sample size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num.years</code></td>
<td>
<p>Dimension 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num.ages</code></td>
<td>
<p>Dimension 2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fpca.op1</code></td>
<td>
<p>A list of options control parameters specified by <code>list(name=value)</code> for FPCA in direction of (age) dimension 2; check fdapace::FPCA for available control options and default settings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fpca.op2</code></td>
<td>
<p>A list of options control parameters specified by <code>list(name=value)</code> for FPCA in direction of (year) dimension 1; check fdapace::FPCA for available control options and default settings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pc.j</code></td>
<td>
<p>A scalar denoting the maximum number of components to consider for FPCA in direction of (age) dimension 2; default: chosen by FVE if NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pc.k</code></td>
<td>
<p>A scalar denoting the maximum number of components to consider for FPCA in direction of (year) dimension 1; default: chosen by FVE if NULL.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The code works for dense functional data (with missing values), with density in both the direction of (age) dimension 2 and (year) dimension 1.
</p>


<h3>Value</h3>

<p>A list containing the following fields:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Xest</code></td>
<td>
<p>An n by (num.years x num.ages) estimated matrix, based on the fitted Product FPCA model. The ith row of the matrix gives the observed values for the ith individual. The values in each row are sorted first by years (dimension 1) and then by ages (dimension 2) within each year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>An num.ages by num.years matrix containing the bivariate mean function estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pc.j</code></td>
<td>
<p>A scalar denoting the selected number of components for FPCA in direction of (age) dimension 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pc.k</code></td>
<td>
<p>A scalar denoting the selected number of components for FPCA in direction of (year) dimension 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>An n by (pc.k x pc.j) matrix of the estimated scores, such that the ith row of the matrix comprises estimated scores <code class="reqn">chi_{1,1}</code>, <code class="reqn">chi_{1,2}</code>,...<code class="reqn">chi_{1,pc.k}</code>, <code class="reqn">chi_{2,1}</code>, <code class="reqn">chi_{2,2}</code>, ..., <code class="reqn">chi_{2,pc.k}</code>, ..., <code class="reqn">chi_{pc.j,1}</code>, <code class="reqn">chi_{pc.j,2}</code>, ..., <code class="reqn">chi_{pc.j,pc.k}</code> for the ith individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res.psi</code></td>
<td>
<p>A list containing the FPCA output for FPCA in direction of (age) dimension 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res.phi</code></td>
<td>
<p>A list containing the FPCA output for FPCA in direction of (year) dimension 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eig</code></td>
<td>
<p>An (num.years x num.ages) by (pc.k x pc.j) matrix of the estimated product eigen functions. The rows are sorted first by years (dimension 1) and then by ages (dimension 2) within each year. The columns are sorted as in the scores.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi</code></td>
<td>
<p>An num.ages by pc.j matrix containing the estimated eigenfunctions from FPCA in direction of (age) dimension 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>An num.years by pc.k matrix containing the estimated eigenfunctions from FPCA in direction of (year) dimension 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FVE</code></td>
<td>
<p>A vector of length (pc.k x pc.j), indicating the fraction of total variance explained by each product function, with corresponding 'FVEthreshold'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>VarOrdered</code></td>
<td>
<p>Variance explained by each term. The terms are ordered by <code class="reqn">var(chi_{jk})</code>. One can select the best model by truncating at a desired level of FVE, and use names(VarOrdered) to see the corresponding model terms.</p>
</td>
</tr>
</table>
<h3>References</h3>


<ul>
<li> <p><cite>Chen, K., Delicado, P., &amp; M端ller, H. G. (2017). Modelling function-valued stochastic processes, with applications to fertility dynamics. Journal of the Royal Statistical Society Series B: Statistical Methodology, 79(1), 177-196.</cite>
</p>
</li>
<li> <p><cite>Chen, K., &amp; M端ller, H. G. (2012). Modeling repeated functional observations. Journal of the American Statistical Association, 107(500), 1599-1609.</cite>
</p>
</li>
<li> <p><cite>Hall, P.,  M端ller, H.G. and Wang, J.L. (2006). Properties of principal component methods for functional and longitudinal data analysis. Annals of Statistics, 34(3), 1493-1517.</cite>
</p>
</li>
<li> <p><cite>Yao, F., M端ller, H. G., &amp; Wang, J. L. (2005). Functional data analysis for sparse longitudinal data. Journal of the American statistical association, 100(470), 577-590.</cite>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
n &lt;- 100 ### sample size
N &lt;- 100
num.ages &lt;- 20 ### dimension 2
num.years &lt;- 15 ### dimension 1
dense_grid &lt;- seq(0,1,length=N)
Lt &lt;- list()
Ly &lt;- list()
 Lt &lt;- lapply(1:n, function(i) dense_grid)
 Ly &lt;- lapply(Lt, function(grid) {
 y_temp &lt;- matrix(0, num.ages, num.years)
  lapply(1:num.ages, function(s) {
    lapply(1:num.years, function(t) {
      y_temp[s, t] &lt;&lt;- y_temp[s, t] + cos(grid[t]) + rnorm(1, 0, 0.5)
    })
  })
  y_temp
 })
X.age.year &lt;- matrix(0,n,num.years*num.ages)
lapply(1:n, function(i) {
  X.age.year[i,] &lt;&lt;- as.vector(Ly[[i]])
})
res&lt;-DenseProductFPCA(X.age.year, n, 15, 20, fpca.op1=NULL, fpca.op2=NULL, pc.j = NULL, pc.k = NULL)
# Basic output
res$Xest
res$mu
res$pc.j
res$pc.k
res$scores
res$res.psi
res$psi
res$FVE
res$VarOrdered


</code></pre>


</div>