<div class="container">

<table style="width: 100%;"><tr>
<td>quantForestError</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Quantify random forest prediction error</h2>

<h3>Description</h3>

<p>Estimates the conditional misclassification rates, conditional mean squared
prediction errors, conditional biases, conditional prediction intervals, and
conditional error distributions of random forest predictions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">quantForestError(
  forest,
  X.train,
  X.test,
  Y.train = NULL,
  what = if (grepl("class", c(forest$type, forest$family, forest$treetype), TRUE))
    "mcr" else c("mspe", "bias", "interval", "p.error", "q.error"),
  alpha = 0.05,
  train_nodes = NULL,
  return_train_nodes = FALSE,
  n.cores = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>forest</code></td>
<td>
<p>The random forest object being used for prediction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X.train</code></td>
<td>
<p>A <code>matrix</code> or <code>data.frame</code> with the observations
that were used to train <code>forest</code>. Each row should be an observation,
and each column should be a predictor variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X.test</code></td>
<td>
<p>A <code>matrix</code> or <code>data.frame</code> with the observations to
be predicted; each row should be an observation, and each column should be
a predictor variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y.train</code></td>
<td>
<p>A vector of the responses of the observations that were used
to train <code>forest</code>. Required if <code>forest</code> was created using
<code>ranger</code>, but not if <code>forest</code> was created using <code>randomForest</code>,
<code>randomForestSRC</code>, or <code>quantregForest</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>what</code></td>
<td>
<p>A vector of characters indicating what estimates are desired.
Possible options are conditional mean squared prediction errors (<code>"mspe"</code>),
conditional biases (<code>"bias"</code>), conditional prediction intervals (<code>"interval"</code>),
conditional error distribution functions (<code>"p.error"</code>), conditional
error quantile functions (<code>"q.error"</code>), and conditional
misclassification rate (<code>"mcr"</code>). Note that the conditional
misclassification rate is available only for categorical outcomes, while
the other parameters are available only for real-valued outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>A vector of type-I error rates desired for the conditional prediction
intervals; required if <code>"interval"</code> is included in <code>what</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>train_nodes</code></td>
<td>
<p>A <code>data.table</code> indicating what out-of-bag prediction
errors each terminal node of each tree in <code>forest</code> contains. It should
be formatted like the output of <code>findOOBErrors</code>. If not provided,
it will be computed internally.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_train_nodes</code></td>
<td>
<p>A boolean indicating whether to return the
<code>train_nodes</code> computed and/or used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.cores</code></td>
<td>
<p>Number of cores to use (for parallel computation in <code>ranger</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function accepts classification or regression random forests built using
the <code>randomForest</code>, <code>ranger</code>, <code>randomForestSRC</code>, and
<code>quantregForest</code> packages. When training the random forest using
<code>randomForest</code>, <code>ranger</code>, or <code>quantregForest</code>, <code>keep.inbag</code>
must be set to <code>TRUE</code>. When training the random forest using
<code>randomForestSRC</code>, <code>membership</code> must be set to <code>TRUE</code>.
</p>
<p>The predictions computed by <code>ranger</code> can be parallelized by setting the
value of <code>n.cores</code> to be greater than 1.
</p>
<p>The random forest predictions are always returned as a <code>data.frame</code>. Additional
columns are included in the <code>data.frame</code> depending on the user's selections in
the argument <code>what</code>. In particular, including <code>"mspe"</code> in <code>what</code>
will add an additional column with the conditional mean squared prediction
error of each test prediction to the <code>data.frame</code>; including <code>"bias"</code> in
<code>what</code> will add an additional column with the conditional bias of each test
prediction to the <code>data.frame</code>; including <code>"interval"</code> in <code>what</code>
will add to the <code>data.frame</code> additional columns with the lower and
upper bounds of conditional prediction intervals for each test prediction;
and including <code>"mcr"</code> in <code>what</code> will add an additional column with
the conditional misclassification rate of each test prediction to the
<code>data.frame</code>. The conditional misclassification rate can be estimated
only for classification random forests, while the other parameters can be
estimated only for regression random forests.
</p>
<p>If <code>"p.error"</code> or <code>"q.error"</code> is included in <code>what</code>, or if
<code>return_train_nodes</code> is set to <code>TRUE</code>, then a list will be returned
as output. The first element of the list, named <code>"estimates"</code>, is the
<code>data.frame</code> described in the above paragraph. The other elements of the
list are the estimated cumulative distribution functions (<code>perror</code>) of
the conditional error distributions, the estimated quantile functions
(<code>qerror</code>) of the conditional error distributions, and/or a <code>data.table</code>
indicating what out-of-bag prediction errors each terminal node of each tree
in the random forest contains.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with one or more of the following columns, as described
in the details section:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>The random forest predictions of the test observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mspe</code></td>
<td>
<p>The estimated conditional mean squared prediction errors of
the random forest predictions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bias</code></td>
<td>
<p>The estimated conditional biases of the random forest
predictions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower_alpha</code></td>
<td>
<p>The estimated lower bounds of the conditional alpha-level
prediction intervals for the test observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper_alpha</code></td>
<td>
<p>The estimated upper bounds of the conditional alpha-level
prediction intervals for the test observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcr</code></td>
<td>
<p>The estimated conditional misclassification rate of the random
forest predictions</p>
</td>
</tr>
</table>
<p>In addition, one or both of the following functions, as described in the
details section:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>perror</code></td>
<td>
<p>The estimated cumulative distribution functions of the
conditional error distributions associated with the test predictions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qerror</code></td>
<td>
<p>The estimated quantile functions of the conditional error
distributions associated with the test predictions</p>
</td>
</tr>
</table>
<p>In addition, if <code>return_train_nodes</code> is <code>TRUE</code>, then a <code>data.table</code>
called <code>train_nodes</code> indicating what out-of-bag prediction errors each
terminal node of each tree in <code>forest</code> contains.
</p>


<h3>Author(s)</h3>

<p>Benjamin Lu <code>&lt;b.lu@berkeley.edu&gt;</code>; Johanna Hardin <code>&lt;jo.hardin@pomona.edu&gt;</code>
</p>


<h3>See Also</h3>

<p><code>perror</code>, <code>qerror</code>, <code>findOOBErrors</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># load data
data(airquality)

# remove observations with missing predictor variable values
airquality &lt;- airquality[complete.cases(airquality), ]

# get number of observations and the response column index
n &lt;- nrow(airquality)
response.col &lt;- 1

# split data into training and test sets
train.ind &lt;- sample(c("A", "B", "C"), n,
                    replace = TRUE, prob = c(0.8, 0.1, 0.1))
Xtrain &lt;- airquality[train.ind == "A", -response.col]
Ytrain &lt;- airquality[train.ind == "A", response.col]
Xtest1 &lt;- airquality[train.ind == "B", -response.col]
Xtest2 &lt;- airquality[train.ind == "C", -response.col]

# fit regression random forest to the training data
rf &lt;- randomForest::randomForest(Xtrain, Ytrain, nodesize = 5,
                                 ntree = 500,
                                 keep.inbag = TRUE)

# estimate conditional mean squared prediction errors,
# biases, prediction intervals, and error distribution
# functions for the observations in Xtest1. return
# train_nodes to avoid recomputation in the next
# line of code.
output1 &lt;- quantForestError(rf, Xtrain, Xtest1,
                            return_train_nodes = TRUE)

# estimate just the conditional mean squared prediction errors
# and prediction intervals for the observations in Xtest2.
# avoid recomputation by providing train_nodes from the
# previous line of code.
output2 &lt;- quantForestError(rf, Xtrain, Xtest2,
                            what = c("mspe", "interval"),
                            train_nodes = output1$train_nodes)

# for illustrative purposes, convert response to categorical
Ytrain &lt;- as.factor(Ytrain &gt; 31.5)

# fit classification random forest to the training data
rf &lt;- randomForest::randomForest(Xtrain, Ytrain, nodesize = 3,
                                 ntree = 500,
                                 keep.inbag = TRUE)

# estimate conditional misclassification rate of the
# predictions of Xtest1
output &lt;- quantForestError(rf, Xtrain, Xtest1)

</code></pre>


</div>