<div class="container">

<table style="width: 100%;"><tr>
<td>base.optim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit Parameters of a Model</h2>

<h3>Description</h3>

<p>Given a specific model, <code>base.optim</code> fits the corresponding parameters and saves the output.
</p>


<h3>Usage</h3>

<pre><code class="language-R">base.optim(
  binary,
  parms,
  fit.fn,
  homedir,
  use.optim = TRUE,
  optim.runs = 1,
  default.val = NULL,
  random.borders = 1,
  con.tol = 0.01,
  control.optim = list(maxit = 1000),
  parscale.pars = FALSE,
  scaling = NULL,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>binary</code></td>
<td>
<p>A vector containing zeroes and ones. Zero indicates that the corresponding parameter is not fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms</code></td>
<td>
<p>A named vector containing the initial values for <code>optim</code>. Must be in the same order as <code>binary</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit.fn</code></td>
<td>
<p>A cost function. Has to take the complete parameter vector as an input argument (needs to be named <code>parms</code>) and must return must return a selection criterion value (e.g. AICc or BIC). The binary vector containing the information which parameters are fitted, can also be used by taking <code>binary</code> as an additional function input argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>homedir</code></td>
<td>
<p>A string giving the directory in which the result folders generated by <code>famos</code> are found.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.optim</code></td>
<td>
<p>Logical. If true, the cost function <code>fit.fn</code> will be fitted via <code>optim</code>. If FALSE, the cost function will only be evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim.runs</code></td>
<td>
<p>The number of times that each model will be optimised. Default to 1. Numbers larger than 1 use random initial conditions (see <code>random.borders</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>default.val</code></td>
<td>
<p>A named list containing the values that the non-fitted parameters should take. If NULL, all non-fitted parameters will be set to zero. Default values can be either given by a numeric value or by the name of the corresponding parameter the value should be inherited from (NOTE: In this case the corresponding parameter entry has to contain a numeric value). Default to NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.borders</code></td>
<td>
<p>The ranges from which the random initial parameter conditions for all optim.runs &gt; 1 are sampled. Can be either given as a vector containing the relative deviations for all parameters or as a matrix containing in its first column the lower and in its second column the upper border values. Parameters are uniformly sampled based on <code>runif</code>. Default to 1 (100% deviation of all parameters). Alternatively, functions such as <code>rnorm</code>, <code>rchisq</code>, etc. can be used if the additional arguments are passed along as well.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>con.tol</code></td>
<td>
<p>The relative convergence tolerance. <code>famos</code> will rerun <code>optim</code> until the relative improvement between the current and the last fit is less than <code>con.tol</code>. Default is set to 0.01, meaning the fitting will terminate if the improvement is less than 1% of the previous value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control.optim</code></td>
<td>
<p>Control parameters passed along to <code>optim</code>. For more details, see <code>optim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parscale.pars</code></td>
<td>
<p>Logical. If TRUE (default), the <code>parscale</code> option will be used when fitting with <code>optim</code>. This is helpful, if the parameter values are on different scales.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scaling</code></td>
<td>
<p>Numeric vector determining how newly added model parameters are scaled. Only needed if <code>parscale.pars</code> is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. If TRUE, FAMoS will output all details about the current fitting procedure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The fitting routine of <code>base.optim</code> is based on the function <code>optim</code>. The number of fitting runs can be specified by the <code>optim.runs</code> parameter in the <code>famos</code> function. Here, the first fitting run takes the parameters supplied in <code>parms</code> as a starting condition, while all following fitting runs sample new initial sets according to a uniform distribution based on the intervals [<code>parms</code> - <code>abs</code>(<code>parms</code>), <code>parms</code> + <code>abs</code>(<code>parms</code>)].
Additionally, each fitting run is based on a <code>while</code>-loop that compares the outcome of the previous and the current fit. Each fitting run is terminated when the specified convergence tolerance <code>con.tol</code> is reached.
</p>


<h3>Value</h3>

<p>Saves the results obtained from fitting the corresponding model parameters in the respective files, from which they can be accessed by the main function <code>famos</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#setting data
true.p2 &lt;- 3
true.p5 &lt;- 2
sim.data &lt;- cbind.data.frame(range = 1:10,
                             y = true.p2^2 * (1:10)^2 - exp(true.p5 * (1:10)))

#define initial parameter values and corresponding test function
inits &lt;- c(p1 = 3, p2 = 4, p3 = -2, p4 = 2, p5 = 0)

cost_function &lt;- function(parms, binary, data){
  if(max(abs(parms)) &gt; 5){
    return(NA)
  }
  with(as.list(c(parms)), {
    res &lt;- p1*4 + p2^2*data$range^2 + p3*sin(data$range) + p4*data$range - exp(p5*data$range)
    diff &lt;- sum((res - data$y)^2)

    #calculate AICC
    nr.par &lt;- length(which(binary == 1))
    nr.data &lt;- nrow(data)
    AICC &lt;- diff + 2*nr.par + 2*nr.par*(nr.par + 1)/(nr.data - nr.par -1)

    return(AICC)
  })
}

#create directories if needed
make.directories(tempdir())

#optimise the model parameters
base.optim(binary = c(0,1,1,0,1),
           parms = inits,
           fit.fn = cost_function,
           homedir = tempdir(),
           data = sim.data)

#delete tempdir
unlink(paste0(tempdir(),"/FAMoS-Results"), recursive = TRUE)
</code></pre>


</div>