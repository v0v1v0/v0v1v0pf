<div class="container">

<table style="width: 100%;"><tr>
<td>sen</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Sensitivity Analysis for a Matched Comparison in an Observational Study.
</h2>

<h3>Description</h3>

<p>Each matched set contains one treated
individual and one or more controls.
Uses Huber's M-statistic as the basis for
the test, for instance, a mean.  Matched sets of different sizes
use different <code class="reqn">\psi</code>-functions, creating what is called a fugue statistic.
Performs either a randomization
test (Gamma=1) or an analysis of sensitivity to departures from random
assignment (Gamma&gt;1).  For confidence intervals, use function senCI().
The method is described in Li and Rosenbaum (2019); see also Rosenbaum (2007,2013).
</p>


<h3>Usage</h3>

<pre><code class="language-R">sen(y, z, mset, gamma = 1, inner = NULL, trim = NULL, lambda = 1/2,
     tau = 0, alternative = "greater")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p> A vector of responses with no missing data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p> Treatment indicator, z=1 for treated, z=0 for control with
length(z)==length(y).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mset</code></td>
<td>
<p> Matched set indicator, 1, 2, ..., sum(z) with
length(mset)==length(y).  Matched set indicators should be either integers or a factor.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>

<p>gamma is the sensitivity parameter <code class="reqn">\Gamma</code>, where <code class="reqn">\Gamma \ge 1</code>.  Setting
<code class="reqn">\Gamma = 1</code> is equivalent to assuming ignorable treatment assignment given
the matched sets, and it performs a within-set randomization test.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inner</code></td>
<td>

<p>inner and trim together define the <code class="reqn">\psi</code>-function for the M-statistic.
If the largest matched set has k controls, then inner is either a scalar or
a vector with k=length(inner).  If inner is a scalar, then
the same value of inner is used, regardless of the number of controls.
Otherwise, inner[1] is used with one control, inner[2] is used with
two controls, etc.  If inner is NULL, default values of
inner=c(.8,.8,.6,.4,0,0,0,...,0) are used.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim</code></td>
<td>

<p>inner and trim together define the <code class="reqn">\psi</code>-function for the M-statistic.
If the largest matched set has k controls, then trim is either a scalar or
a vector with k=length(trim).  If trim is a scalar, then
the same value of trim is used, regardless of the number of controls.
Otherwise, trim[1] is used with one control, trim[2] is used with
two controls, etc.  If trim is NULL, default values of
trim=c(3,3,...,3) are used.  For each i, 0 &lt;= inner[i] &lt; trim[i] &lt; Inf.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>

<p>Before applying the <code class="reqn">\psi</code>-function to treated-minus-control differences,
the differences are scaled by dividing by the lambda quantile of all
within set absolute differences.  Typically, lambda = 1/2 for the median.
The value of lambda has no effect if trim=Inf and inner=0.  See Maritz (1979)
for the paired case and Rosenbaum (2007) for matched sets.
</p>
<p>An error will result unless 0 &lt; lambda &lt; 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>

<p>The null hypothesis asserts that the treatment has an additive effect, tau.
By default, tau=0, so by default the null hypothesis is Fisher's sharp null
hypothesis of no treatment effect.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>

<p>If alternative="greater", the null hypothesis of a treatment effect of tau
is tested against the alternative of a treatment effect larger than tau.  If
alternative="less", the null hypothesis of a treatment effect of tau
is tested against the alternative of a treatment effect smaller than tau.
In particular, alternative="less" is equivalent to: (i) alternative="greater",
(ii) y replaced by -y, and (iii) tau replaced by -tau.  See the note for
discussion of two-sided sensitivity analyses.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The novel element in the fugue package is the automatic use of different
<code class="reqn">\psi</code>-functions for matched sets of different sizes.  These
<code class="reqn">\psi</code>-functions have been selected to approximately equate the
design sensitivities in sets of unequal sizes when the errors are
Normal and the additive effect is half the standard deviation of
a matched pair difference; see Li and Rosenbaum (2019).  If you
disable this automatic feature by manually setting a single value for inner
and trim, then the results will agree with senm() in the R
package sensitivitymult.  For instance, using both sen() in the
fugue package and senm() in the sensitivitymult package will
yield the same deviate and P-value in:
data(nh1and3)
attach(nh1and3)
sen(homocysteine,z,mset,inner=0,gamma=1.9)
senm(homocysteine,z,mset,inner=0,trim=3,gamma=1.9)
Note that the sensitivitymult package is intended to
implement methods from Rosenbaum (2016,2019) that are
not implemented in the fugue package.
</p>
<p>For the given <code class="reqn">\Gamma</code>, sen() computes the upper bound on the 1-sided
P-value testing the null hypothesis
of an additive treatment effect tau against the alternative hypothesis of
a treatment effect larger than tau.  By default, sen() tests the null hypothesis of
no treatment effect against the alternative of a positive treatment effect.
The P-value is an approximate P-value
based on a Normal approximation to the null distribution; see Rosenbaum (2007).
</p>
<p>Matched sets of unequal size are weighted using weights that would
be efficient in a randomization test under a simple model with
additive set and treatment effects and errors with constant variance;
see Rosenbaum (2007).
</p>
<p>The upper bound on the P-value is based on the separable approximation
described in Gastwirth, Krieger and Rosenbaum (2000); see also
Rosenbaum (2007, 2018).
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pval </code></td>
<td>
<p>The upper bound on the 1-sided P-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviate </code></td>
<td>
<p>The deviate that was compared to the Normal
distribution to produce pval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic </code></td>
<td>
<p>The value of the M-statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expectation </code></td>
<td>
<p>The maximum expectation of the
M-statistic for the given <code class="reqn">\Gamma</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance </code></td>
<td>
<p>The maximum variance of the
M-statistic among treatment assignments
that achieve the maximum expectation.
Part of the separable approximation.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The function sen() performs 1-sided tests.  One approach
to a 2-sided, <code class="reqn">\alpha</code>-level test does both 1-sided tests
at level <code class="reqn">\alpha/2</code>, and rejects the null hypothesis if either
1-sided
test rejects.  Equivalently, a bound on the two sided
P-value is the smaller of 1 and twice the smaller of the two 1-sided
P-values.  This approach views a 2-sided test as two 1-sided tests
with a Bonferroni correction; see Cox (1977, Section 4.2).  In all
cases, this approach is a valid large sample test: a true
null hypothesis is falsely
rejected with probability at most <code class="reqn">\alpha</code> if the bias in
treatment assignment is at most <code class="reqn">\Gamma</code>; so, this procedure
is entirely safe to use.  For a randomization test, <code class="reqn">\Gamma=1</code>, this
Bonferroni procedure is not typically conservative. For large <code class="reqn">\Gamma</code>,
this Bonferroni procedure tends to be somewhat conservative.
</p>
<p>The examples reproduce some results from Li and Rosenbaum (2019).
</p>


<h3>Author(s)</h3>

<p>Xinran Li and Paul R. Rosenbaum.
</p>


<h3>References</h3>

<p>Cox, D. R. (1977).  The role of signficance tests (with Discussion).
Scand. J. Statist. 4, 49-70.
</p>
<p>Huber, P. (1981) Robust Statistics.  New York: John Wiley.
(M-estimates based on M-statistics.)
</p>
<p>Li, X. and Rosenbaum, P. R. (2019) Maintaining high constant
design sensitivity in observational studies with matched sets of
varying sizes.  Manuscript.
</p>
<p>Maritz, J. S. (1979). A note on exact robust confidence
intervals for location. Biometrika 66 163â€“166. (Introduces
exact permutation tests based on M-statistics by redefining
the scaling parameter.)
</p>
<p>Rosenbaum, P. R. (2007). Sensitivity analysis for m-estimates, tests
and confidence intervals in matched observational studies.
Biometrics 63 456-64. (R package sensitivitymv) &lt;doi:10.1111/j.1541-0420.2006.00717.x&gt;
</p>
<p>Rosenbaum, P. R. (2013). Impact of multiple matched controls on
design sensitivity in observational studies. Biometrics 69 118-127.
(Introduces inner trimming.) &lt;doi:10.1111/j.1541-0420.2012.01821.x&gt;
</p>
<p>Rosenbaum, P. R. (2014). Weighted M-statistics with superior design
sensitivity in matched observational studies with multiple controls.
J. Am. Statist. Assoc. 109 1145-1158. (R package sensitivitymw)
&lt;doi:10.1080/01621459.2013.879261&gt;
</p>
<p>Rosenbaum, P. R. (2015).  Two R packages for sensitivity analysis
in observational studies.  Observational Studies, v. 1. (Free on-line.)
</p>
<p>Rosenbaum, P. R. (2016) Using Scheffe projections for multiple outcomes
in an observational study of smoking and periondontal disease.  Annals of
Applied Statistics, 10, 1447-1471. &lt;doi:10.1214/16-AOAS942&gt;
</p>
<p>Rosenbaum, P. R. (2018). Sensitivity analysis for stratified comparisons
in an observational study of the effect of smoking on homocysteine levels.
The Annals of Applied Statistics, 12(4), 2312-2334.
&lt;doi:10.1214/18-AOAS1153&gt;
</p>
<p>Rosenbaum, P. R. (2019). Combining planned and discovered comparisons
in observational studies.
Biostatistics, to appear. &lt;doi.org/10.1093/biostatistics/kxy055&gt;
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Reproduces results from Table 3 of Li and Rosenbaum (2019)
data(nh1and3)
attach(nh1and3)
sen(homocysteine,z,mset,gamma=1)
sen(homocysteine,z,mset,gamma=1.9)
sen(homocysteine,z,mset,inner=0,gamma=1.9)
amplify(1.9,c(3,3.5,4))
detach(nh1and3)
</code></pre>


</div>