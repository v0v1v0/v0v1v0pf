<div class="container">

<table style="width: 100%;"><tr>
<td>flexsurvrtrunc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Flexible parametric models for right-truncated, uncensored data defined by times of initial and final events.</h2>

<h3>Description</h3>

<p>This function estimates the distribution of the time between an initial and final event, in situations where individuals are only observed if they have experienced both events before a certain time, thus they are right-truncated at this time.   The time of the initial event provides information about the time from initial to final event, given the truncated observation scheme, and initial events are assumed to occur with an exponential growth rate.
</p>


<h3>Usage</h3>

<pre><code class="language-R">flexsurvrtrunc(
  t,
  tinit,
  rtrunc,
  tmax,
  data = NULL,
  method = "joint",
  dist,
  theta = NULL,
  fixed.theta = TRUE,
  inits = NULL,
  fixedpars = NULL,
  dfns = NULL,
  integ.opts = NULL,
  cl = 0.95,
  optim_control = list()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>Vector of time differences between an initial and final event for a set of individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tinit</code></td>
<td>
<p>Absolute time of the initial event for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rtrunc</code></td>
<td>
<p>Individual-specific right truncation points on the same scale as <code>t</code>, so that each individual's survival time <code>t</code> would not have been observed if it was greater than the corresponding element of <code>rtrunc</code>.  Only used in <code>method="joint"</code>.  In <code>method="final"</code>, the right-truncation is implicit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tmax</code></td>
<td>
<p>Maximum possible time between initial and final events that could have been observed.  This is only used in <code>method="joint"</code>, and is ignored in <code>method="final"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data frame containing <code>t</code>, <code>rtrunc</code> and <code>tinit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>If <code>"joint"</code> then the "joint-conditional" method is used.  If <code>"final"</code> then the "conditional-on-final" method is used.   The "conditional-on-initial" method can be implemented by using <code>flexsurvreg</code> with a <code>rtrunc</code> argument.  These methods are all described in Seaman et al. (2020).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>Typically, one of the strings in the first column of the
following table, identifying a built-in distribution.  This table also
identifies the location parameters, and whether covariates on these
parameters represent a proportional hazards (PH) or accelerated failure
time (AFT) model.  In an accelerated failure time model, the covariate
speeds up or slows down the passage of time.  So if the coefficient
(presented on the log scale) is log(2), then doubling the covariate value
would give half the expected survival time.
</p>

<table>
<tr>
<td style="text-align: left;"> <code>"gengamma"</code> </td>
<td style="text-align: left;"> Generalized gamma (stable) </td>
<td style="text-align: left;"> mu
  </td>
<td style="text-align: left;"> AFT </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"gengamma.orig"</code> </td>
<td style="text-align: left;"> Generalized gamma (original) </td>
<td style="text-align: left;">
  scale </td>
<td style="text-align: left;"> AFT </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"genf"</code> </td>
<td style="text-align: left;"> Generalized F (stable) </td>
<td style="text-align: left;"> mu </td>
<td style="text-align: left;">
  AFT </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"genf.orig"</code> </td>
<td style="text-align: left;"> Generalized F (original) </td>
<td style="text-align: left;"> mu </td>
<td style="text-align: left;"> AFT
  </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"weibull"</code> </td>
<td style="text-align: left;"> Weibull </td>
<td style="text-align: left;"> scale </td>
<td style="text-align: left;"> AFT </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"gamma"</code>
  </td>
<td style="text-align: left;"> Gamma </td>
<td style="text-align: left;"> rate </td>
<td style="text-align: left;"> AFT </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"exp"</code> </td>
<td style="text-align: left;"> Exponential </td>
<td style="text-align: left;"> rate
  </td>
<td style="text-align: left;"> PH </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"llogis"</code> </td>
<td style="text-align: left;"> Log-logistic </td>
<td style="text-align: left;"> scale </td>
<td style="text-align: left;"> AFT </td>
</tr>
<tr>
<td style="text-align: left;">
  <code>"lnorm"</code> </td>
<td style="text-align: left;"> Log-normal </td>
<td style="text-align: left;"> meanlog </td>
<td style="text-align: left;"> AFT </td>
</tr>
<tr>
<td style="text-align: left;"> <code>"gompertz"</code>
  </td>
<td style="text-align: left;"> Gompertz </td>
<td style="text-align: left;"> rate </td>
<td style="text-align: left;"> PH </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p><code>"exponential"</code> and <code>"lognormal"</code> can be used as aliases for
<code>"exp"</code> and <code>"lnorm"</code>, for compatibility with
<code>survreg</code>.
</p>
<p>Alternatively, <code>dist</code> can be a list specifying a custom distribution.
See section “Custom distributions” below for how to construct this list.
</p>
<p>Very flexible spline-based distributions can also be fitted with
<code>flexsurvspline</code>.
</p>
<p>The parameterisations of the built-in distributions used here are the same
as in their built-in distribution functions: <code>dgengamma</code>,
<code>dgengamma.orig</code>, <code>dgenf</code>,
<code>dgenf.orig</code>, <code>dweibull</code>, <code>dgamma</code>,
<code>dexp</code>, <code>dlnorm</code>, <code>dgompertz</code>,
respectively.  The functions in base R are used where available,
otherwise, they are provided in this package.
</p>
<p>A package vignette "Distributions reference" lists the survivor functions
and covariate effect parameterisations used by each built-in distribution.
</p>
<p>For the Weibull, exponential and log-normal distributions,
<code>flexsurvreg</code> simply works by calling <code>survreg</code> to
obtain the maximum likelihood estimates, then calling <code>optim</code>
to double-check convergence and obtain the covariance matrix for
<code>flexsurvreg</code>'s preferred parameterisation.
</p>
<p>The Weibull parameterisation is different from that in
<code>survreg</code>, instead it is consistent with
<code>dweibull</code>.  The <code>"scale"</code> reported by
<code>survreg</code> is equivalent to <code>1/shape</code> as defined
by <code>dweibull</code> and hence <code>flexsurvreg</code>.  The first
coefficient <code>(Intercept)</code> reported by <code>survreg</code>
is equivalent to <code>log(scale)</code> in <code>dweibull</code> and
<code>flexsurvreg</code>.
</p>
<p>Similarly in the exponential distribution, the rate, rather than the mean,
is modelled on covariates.
</p>
<p>The object <code>flexsurv.dists</code> lists the names of the built-in
distributions, their parameters, location parameter, functions used to
transform the parameter ranges to and from the real line, and the
functions used to generate initial values of each parameter for
estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>Initial value (or fixed value) for the exponential growth rate <code>theta</code>. Defaults to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.theta</code></td>
<td>
<p>Should <code>theta</code> be fixed at its initial value or estimated.  This only applies to <code>method="joint"</code>.  For <code>method="final"</code>, <code>theta</code> must be fixed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inits</code></td>
<td>
<p>Initial values for the parameters of the parametric survival distributon. If not supplied, a heuristic is used. as is done in <code>flexsurvreg</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixedpars</code></td>
<td>
<p>Integer indices of the parameters of the survival distribution that should be fixed to their values supplied in <code>inits</code>.   Same length as <code>inits</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfns</code></td>
<td>
<p>An alternative way to define a custom survival distribution (see
section “Custom distributions” below).  A list whose components may
include <code>"d"</code>, <code>"p"</code>, <code>"h"</code>, or <code>"H"</code> containing the
probability density, cumulative distribution, hazard, or cumulative hazard
functions of the distribution.  For example,
</p>
<p><code>list(d=dllogis, p=pllogis)</code>.
</p>
<p>If <code>dfns</code> is used, a custom <code>dlist</code> must still be provided, but
<code>dllogis</code> and <code>pllogis</code> need not be visible from the global
environment.  This is useful if <code>flexsurvreg</code> is called within other
functions or environments where the distribution functions are also
defined dynamically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integ.opts</code></td>
<td>
<p>List of named arguments to pass to
<code>integrate</code>, if a custom density or hazard is provided without
its cumulative version.  For example,
</p>
<p><code>integ.opts = list(rel.tol=1e-12)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl</code></td>
<td>
<p>Width of symmetric confidence intervals for maximum likelihood
estimates, by default 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim_control</code></td>
<td>
<p>List to supply as the <code>control</code> argument to <code>optim</code> to control the likelihood maximisation.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Covariates are not currently supported.
</p>
<p>Note that <code>flexsurvreg</code>, with an <code>rtrunc</code> argument, can fit models for a similar kind of data, but those models ignore the information provided by the time of the initial event.
</p>
<p>A nonparametric estimator of survival under right-truncation is also provided in <code>survrtrunc</code>.  See Seaman et al. (2020) for a full comparison of the alternative models.
</p>


<h3>References</h3>

<p>Seaman, S., Presanis, A. and Jackson, C. (2020) Estimating a Time-to-Event
Distribution from Right-Truncated Data in an Epidemic: a Review of Methods
</p>


<h3>See Also</h3>

<p><code>flexsurvreg</code>, <code>survrtrunc</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1) 
## simulate time to initial event
X &lt;- rexp(1000, 0.2)
## simulate time between initial and final event
T &lt;- rgamma(1000, 2, 10) 

## right-truncate to keep only those with final event time
## before tmax
tmax &lt;- 40
obs &lt;- X + T &lt; tmax 
rtrunc &lt;- tmax - X
dat &lt;- data.frame(X, T, rtrunc)[obs,]

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="gamma", theta=0.2)

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="gamma", theta=0.2, fixed.theta=FALSE)

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="gamma", theta=0.2, inits=c(1, 8))

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="gamma", theta=0.2, method="final")

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="gamma", fixed.theta=TRUE)

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="weibull", fixed.theta=TRUE)

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="lnorm", fixed.theta=TRUE)

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="gengamma", fixed.theta=TRUE)

flexsurvrtrunc(t=T, rtrunc=rtrunc, tinit=X, tmax=40, data=dat,
                dist="gompertz", fixed.theta=TRUE)

</code></pre>


</div>