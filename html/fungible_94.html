<div class="container">

<table style="width: 100%;"><tr>
<td>RnpdMAP</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate Random NPD R matrices from a user-supplied population R</h2>

<h3>Description</h3>

<p>Generate a list of Random NPD (pseudo) R matrices with a user-defined fixed
minimum eigenvalue from a user-supplied population R using the method of
alternating projections.
</p>


<h3>Usage</h3>

<pre><code class="language-R">RnpdMAP(
  Rpop,
  Lp = NULL,
  NNegEigs = 1,
  NSmoothPosEigs = 4,
  NSubjects = NULL,
  NSamples = 0,
  MaxIts = 15000,
  PRINT = FALSE,
  Seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Rpop</code></td>
<td>
<p>input (PD or PSD) p x p Population correlation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lp</code></td>
<td>
<p>desired minimum eigenvalue in the NPD matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NNegEigs</code></td>
<td>
<p>number of eigenvalues &lt; 0 in Rnpd.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NSmoothPosEigs</code></td>
<td>
<p>number of eigenvalues &gt; 0 to smooth: the smallest
NSmoothPosEigs &gt; 0  will be smoothed toward 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NSubjects</code></td>
<td>
<p>sample size (required when NSamples &gt; 0) parameter used to
generate sample correlation matrices. Default = NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NSamples</code></td>
<td>
<p>generate NSamples sample R matrices. If NSamples = 0 the
program will attempt to find Rnpd such that ||Rpop - Rnpd||_2 is minimized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MaxIts</code></td>
<td>
<p>maximum number of projection iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PRINT</code></td>
<td>
<p>(logical) If TRUE the program will print the iteration history
for Lp. Default = NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Seed</code></td>
<td>
<p>Optional seed for random number generation.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Rpop</code></td>
<td>
<p>population (PD) correlation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>sample
correlation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rnpd</code></td>
<td>
<p>NPD improper (pseudo) correlation matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lp</code></td>
<td>
<p>desired value of minimum eigenvalue.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minEig</code></td>
<td>
<p>observed value
of minimum eigenvalue of Rnpd.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>0 = converged; 1 = not
converged in MaxIts iterations of the alternating projections algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feasible</code></td>
<td>
<p>logical) TRUE if max(abs(r_ij)) &lt;= 1. If FALSE then one or
more values in Rnpd &gt; 1 in absolute value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Seed</code></td>
<td>
<p>saved seed for
random number generator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prbs1</code></td>
<td>
<p>vector probabilities used to generate
eigenvalues &lt; 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prbs2</code></td>
<td>
<p>vector of probabilities used to smooth the
smallest NSmoothPosEigs towards zero.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Niels G. Waller
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(MASS)

Nvar = 20
Nfac = 4
NSubj = 2000
Seed = 123    

set.seed(Seed)

## Generate a vector of classical item difficulties
p &lt;- runif(Nvar)

cat("\nClassical Item Difficulties:\n")

print(rbind(1:Nvar,round(p,2)) )

summary(p)


## Convert item difficulties to quantiles
b &lt;- qnorm(p)


## fnc to compute root mean squared standard deviation
RMSD &lt;- function(A, B){
  sqrt(mean( ( A[lower.tri(A, diag = FALSE)] - B[lower.tri(B, diag = FALSE)] )^2))
}


## Generate vector of eigenvalues with clear factor structure
  L &lt;- eigGen(nDimensions = Nvar, 
            nMajorFactors = Nfac, 
            PrcntMajor = .60, 
            threshold  = .50)
          

## Generate a population R matrix with the eigenvalues in L
  Rpop &lt;- rGivens(eigs = L)$R
  
## Generate continuous data that will reproduce Rpop (exactly)
  X &lt;- mvrnorm(n = NSubj, mu = rep(0, Nvar), 
               Sigma = Rpop, empirical = TRUE)
               
while( any(colSums(X) == 0) ){
  warning("One or more variables have zero variance. Generating a new data set.") 
   X &lt;- mvrnorm(n = NSubj, mu = rep(0, Nvar), 
               Sigma = Rpop, empirical = TRUE)              
 }
 
## Cut X at thresholds given in b to produce binary data U
  U &lt;- matrix(0, nrow(X), ncol(X))
  for(j in 1:Nvar){
    U[X[,j] &lt;= b[j],j] &lt;- 1
  }
  
## Compute tetrachoric correlations
  Rtet &lt;- tetcor(U, Smooth = FALSE, PRINT = TRUE)$r
  # Calculate eigenvalues of tetrachoric R matrix
  Ltet &lt;- eigen(Rtet)$values
  
  if(Ltet[Nvar] &gt;= 0) stop("Rtet is P(S)D")
  
## Simulate NPD R matrix with minimum eigenvalue equal to 
  # min(Ltet)
  out &lt;- RnpdMAP(Rpop, 
               Lp = Ltet[Nvar], 
               NNegEigs = Nvar/5,
               NSmoothPosEigs = Nvar/5, 
               NSubjects = 150, 
               NSamples = 1, 
               MaxIts = 15000, 
               PRINT = FALSE, 
               Seed = Seed) 

## RLp is a NPD pseudo R matrix with min eigenvalue = min(Ltet)
  RLp &lt;- out[[1]]$Rnpd

## Calculate eigenvalues of simulated NPD R matrix (Rnpd)
  Lnpd &lt;- eigen(RLp, only.values = TRUE)$values
  
## Scree plots for observed and simulated NPD R matrices.  
  ytop &lt;- max(c(L,Lnpd,Ltet))
  pointSize = .8
  plot(1:Nvar, L, typ = "b", col = "darkgrey", lwd=3, 
       lty=1, 
       main = 
       "Eigenvalues of Rpop, Tet R, and Sim Tet R:
       \nSimulated vs Observed npd Tetrachoric R Matrices",
       ylim = c(-1, ytop),
       xlab = "Dimensions", 
       ylab = "Eigenvalues",
       cex = pointSize,cex.main = 1.2)
  points(1:Nvar, Lnpd, typ="b", 
         col = "red", lwd = 3, lty=2, cex=pointSize)
  points(1:Nvar, Ltet, typ="b", 
         col = "darkgreen", lwd = 3, lty = 3, cex= pointSize)
 
  legend("topright", 
         legend = c("eigs Rpop", "eigs Sim Rnpd", "eigs Emp Rnpd"), 
         col = c("darkgrey", "red","darkgreen"), 
         lty = c(1,2,3), 
         lwd = c(4,4,4), cex = 1.5)
  
  abline(h = 0, col = "grey", lty = 2, lwd = 4)
 
  cat("\nRMSD(Rpop, Rtet) = ", round(rmsd(Rpop, Rtet), 3))
  cat("\nRMSD(Rpop, RLp) = ",  round(rmsd(Rpop, RLp),  3))

</code></pre>


</div>