<div class="container">

<table style="width: 100%;"><tr>
<td>est_env</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimates a <code>fixest</code> estimation from a <code>fixest</code> environment</h2>

<h3>Description</h3>

<p>This is a function advanced users which allows to estimate any <code>fixest</code> estimation from a
<code>fixest</code> environment obtained with <code>only.env = TRUE</code> in a <code>fixest</code> estimation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">est_env(env, y, X, weights, endo, inst)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>An environment obtained from a <code>fixest</code> estimation with <code>only.env = TRUE</code>. This is
intended for advanced users so there is no error handling: any other kind of input will
fail with a poor error message.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A vector representing the dependent variable. Should be of the same length
as the number of observations in the initial estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>A matrix representing the independent variables. Should be of the same dimension
as in the initial estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>A vector of weights (i.e. with only positive values). Should be of
the same length as the number of observations in the initial estimation. If identical
to the scalar 1, this will mean that no weights will be used in the estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>endo</code></td>
<td>
<p>A matrix representing the endogenous regressors in IV estimations. It should
be of the same dimension as the original endogenous regressors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inst</code></td>
<td>
<p>A matrix representing the instruments in IV estimations. It should be of
the same dimension as the original instruments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function has been created for advanced users, mostly to avoid overheads
when making simulations with <code>fixest</code>.
</p>
<p>How can it help you make simulations? First make a core estimation with <code>only.env = TRUE</code>,
and usually with <code>only.coef = TRUE</code> (to avoid having extra things that take time to compute).
Then loop while modifying the appropriate things directly in the environment. Beware that
if you make a mistake here (typically giving stuff of the wrong length),
then you can make the R session crash because there is no more error-handling!
Finally estimate with <code>est_env(env = core_env)</code> and store the results.
</p>
<p>Instead of <code>est_env</code>, you could use directly <code>fixest</code> estimations too, like <code>feols</code>,
since they accept the <code>env</code> argument. The function <code>est_env</code> is only here to add a
bit of generality to avoid the trouble to the user to write conditions
(look at the source, it's just a one liner).
</p>
<p>Objects of main interest in the environment are:
</p>

<dl>
<dt>lhs</dt>
<dd>
<p>The left hand side, or dependent variable.</p>
</dd>
<dt>linear.mat</dt>
<dd>
<p>The matrix of the right-hand-side, or explanatory variables.</p>
</dd>
<dt>iv_lhs</dt>
<dd>
<p>The matrix of the endogenous variables in IV regressions.</p>
</dd>
<dt>iv.mat</dt>
<dd>
<p>The matrix of the instruments in IV regressions.</p>
</dd>
<dt>weights.value</dt>
<dd>
<p>The vector of weights.</p>
</dd>
</dl>
<p>I strongly discourage changing the dimension of any of these elements, or else crash can occur.
However, you can change their values at will (given the dimension stay the same).
The only exception is the weights, which tolerates changing its dimension: it can
be identical to the scalar <code>1</code> (meaning no weights), or to something of the length the
number of observations.
</p>
<p>I also discourage changing anything in the fixed-effects (even their value)
since this will almost surely lead to a crash.
</p>
<p>Note that this function is mostly useful when the overheads/estimation ratio is high.
This means that OLS will benefit the most from this function. For GLM/Max.Lik. estimations,
the ratio is small since the overheads is only a tiny portion of the total estimation time.
Hence this function will be less useful for these models.
</p>


<h3>Value</h3>

<p>It returns the results of a <code>fixest</code> estimation: the one that was summoned when
obtaining the environment.
</p>


<h3>Author(s)</h3>

<p>Laurent Berge
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Let's make a short simulation
# Inspired from Grant McDermott bboot function
# See https://twitter.com/grant_mcdermott/status/1487528757418102787

# Simple function that computes a Bayesian bootstrap
bboot = function(x, n_sim = 100){
  # We bootstrap on the weights
  # Works with fixed-effects/IVs
  #  and with any fixest function that accepts weights

  core_env = update(x, only.coef = TRUE, only.env = TRUE)
  n_obs = x$nobs

  res_all = vector("list", n_sim)
  for(i in 1:n_sim){
    ## begin: NOT RUN
    ## We could directly assign in the environment:
    # assign("weights.value", rexp(n_obs, rate = 1), core_env)
    # res_all[[i]] = est_env(env = core_env)
    ##   end: NOT RUN

    ## Instead we can use the argument weights, which does the same
    res_all[[i]] = est_env(env = core_env, weights = rexp(n_obs, rate = 1))
  }

  do.call(rbind, res_all)
}


est = feols(mpg ~ wt + hp, mtcars)

boot_res = bboot(est)
coef = colMeans(boot_res)
std_err = apply(boot_res, 2, sd)

# Comparing the results with the main estimation
coeftable(est)
cbind(coef, std_err)





</code></pre>


</div>