<div class="container">

<table style="width: 100%;"><tr>
<td>add_flowmap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add a flow map to a ggplot</h2>

<h3>Description</h3>

<p>Add a flow map to a ggplot
</p>


<h3>Usage</h3>

<pre><code class="language-R">add_flowmap(
  p,
  flowdat = NULL,
  od = NULL,
  nodes = NULL,
  outline_linewidth = 0.01,
  alpha = 0.8,
  nodes_alpha = 0.8,
  outline_col = "black",
  k_nodes = NULL,
  node_buffer_factor = 1.2,
  node_radius_factor = 1,
  edge_offset_factor = 1,
  node_fill_factor = NULL,
  edge_width_factor = 1.2,
  arrow_point_angle = 45,
  add_legend = "none",
  legend_nudge_x = 0,
  legend_nudge_y = 0,
  legend_col = "gray"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>The plot to which the flowmap should be added.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flowdat</code></td>
<td>
<p>Input dataframe. See details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>od</code></td>
<td>
<p>As an alternative to <code>flowdat</code>, dataframe with the origin-destination pairs and the flow between them.  Must contain the columns o, d, value. <code>nodes</code> must be provided as well. See details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodes</code></td>
<td>
<p>As an alternative to <code>flowdat</code>, a dataframe with the nodes of the network. Must contain the columns name, x, y. See details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outline_linewidth</code></td>
<td>
<p>The linewidth of the outline of the arrows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Opacity of the edges.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodes_alpha</code></td>
<td>
<p>Opacity of the nodes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outline_col</code></td>
<td>
<p>Color of the outline of the edges.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k_nodes</code></td>
<td>
<p>Number of clusters to group nodes into. If defined, nodes will be clustered hierarchically based on spatial proximity. By default, no clustering will be applied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node_buffer_factor</code></td>
<td>
<p>Controls the distance between the nodes and the edges ( in multiple of the nodes' radii).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node_radius_factor</code></td>
<td>
<p>Controls the size of the nodes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>edge_offset_factor</code></td>
<td>
<p>Controls the distance between the parallel arrows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node_fill_factor</code></td>
<td>
<p>Controls the downscaling of the fill of the nodes ( as to not outshine the edges ).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>edge_width_factor</code></td>
<td>
<p>Controls the width of the edges.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arrow_point_angle</code></td>
<td>
<p>Controls the pointiness of the edges.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_legend</code></td>
<td>
<p>Add a legend for width to the plot? Must be one of "none","bottom","top","left", or "right". (Experimental)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_nudge_x</code></td>
<td>
<p>Adjusts the horizontal position of the legend in map units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_nudge_y</code></td>
<td>
<p>Adjusts the vertical position of the legend in map units.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_col</code></td>
<td>
<p>If <code>add_legend</code>, controls the color of the legend. Default is grey.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function requires as inputs a dataframe <code>flowdat</code> which contains for every combination of two nodes a and b the coordinates of these nodes as well as the intensity of flow between those nodes in both directions (a to b, b to a). The dataframe should have the following columns:
</p>

<ul>
<li> <p><strong>id_a:</strong> The unique id of node a
</p>
</li>
<li> <p><strong>id_b:</strong> The unique id of node b
</p>
</li>
<li> <p><strong>xa:</strong> The x coordinate of node a
</p>
</li>
<li> <p><strong>ya:</strong> The y coordinate of node a
</p>
</li>
<li> <p><strong>xb:</strong> The x coordinate of node b
</p>
</li>
<li> <p><strong>yb:</strong> The y coordinate of node b
</p>
</li>
<li> <p><strong>flow_ab:</strong> The intensity of flow from node a to node b
</p>
</li>
<li> <p><strong>flow_ba:</strong> The intensity of flow from node b to node a
</p>
</li>
</ul>
<p>Alternatively, the function can take as input a dataframe <code>od</code> which contains the origin-destination pairs and the flow between them. The dataframe should have the following columns:
</p>

<ul>
<li> <p><strong>o:</strong> The unique id of the origin node
</p>
</li>
<li> <p><strong>d:</strong> The unique id of the destination node
</p>
</li>
<li> <p><strong>value:</strong> The intensity of flow between the origin and destination
</p>
</li>
</ul>
<p>In this case, the function also requires a dataframe <code>nodes</code> which contains the coordinates of the nodes. The dataframe should have the following columns:
</p>

<ul>
<li> <p><strong>name:</strong> The unique id of the node
</p>
</li>
<li> <p><strong>x:</strong> The x coordinate of the node
</p>
</li>
<li> <p><strong>y:</strong> The y coordinate of the node
</p>
</li>
</ul>
<p>The function will impose coord_equal() on the ggplot.
</p>
<p>Inspired by <a href="https://flowmap.gl/">flowmap.gl</a>.
</p>


<h3>Value</h3>

<p>The ggplot with an additional polygon layer for the flow arrows and an additional polygon layer for the nodes
</p>


<h3>Author(s)</h3>

<p>Johannes Mast
</p>


<h3>Examples</h3>

<pre><code class="language-R">testdata &lt;-
data.frame(
 id_a = c("X1","X2","X3","X3","X1"),
 id_b = c("X8","X7","X1","X8","X7"),
 xa = c(2,14,10,10,2),
 ya = c(6,10,9,9,6),
 xb = c(10,4,2,10,4),
 yb = c(4,10,6,4,10),
 flow_ab = c(2,1,1,1,1),
 flow_ba = c(5,1,1,1,2)
)
library(ggplot2)
plot &lt;- ggplot()
plot |&gt; add_flowmap(testdata)
</code></pre>


</div>