<div class="container">

<table style="width: 100%;"><tr>
<td>portEsDecomp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Decompose portfolio ES into individual factor contributions</h2>

<h3>Description</h3>

<p>Compute the factor contributions to Expected Tail Loss or 
Expected Shortfall (ES) of portfolio returns  based on Euler's theorem, given 
the fitted factor model. The partial derivative of ES with respect to factor 
beta is computed as the expected factor return given portfolio return is less 
than or equal to its value-at-risk (VaR). Option to choose between 
non-parametric and Normal.
</p>


<h3>Usage</h3>

<pre><code class="language-R">portEsDecomp(object, ...)

## S3 method for class 'ffm'
portEsDecomp(
  object,
  weights = NULL,
  factor.cov,
  p = 0.05,
  type = c("np", "normal"),
  invert = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>fit object of class  <code>ffm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other optional arguments passed to <code>quantile</code> and 
optional arguments passed to <code>cov</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>a vector of weights of the assets in the portfolio, names of 
the vector should match with asset names. Default is NULL, in which case an 
equal weights will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor.cov</code></td>
<td>
<p>optional user specified factor covariance matrix with 
named columns; defaults to the sample covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>tail probability for calculation. Default is 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>one of "np" (non-parametric) or "normal" for calculating Es. 
Default is "np".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>invert</code></td>
<td>
<p>a logical variable to choose if change ES to positive number, default
is False</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The factor model for a portfolio's return at time <code>t</code> has the 
form <br><br><code>R(t) = beta'f(t) + e(t) = beta.star'f.star(t)</code> <br><br> 
where, <code>beta.star=(beta,sig.e)</code> and <code>f.star(t)=[f(t)',z(t)]'</code>. By 
Euler's theorem, the ES of the portfolio's return is given by:
<br><br><code>ES.fm = sum(cES_k) = sum(beta.star_k*mES_k)</code> <br><br>
where, summation is across the <code>K</code> factors and the residual, 
<code>cES</code> and <code>mES</code> are the component and marginal 
contributions to <code>ES</code> respectively. The marginal contribution to ES is
defined as the expected value of <code>F.star</code>, conditional on the loss 
being less than or equal to <code>portVaR</code>. This is estimated as a sample 
average of the observations in that data window.
</p>


<h3>Value</h3>

<p>A list containing 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>portES</code></td>
<td>
<p>factor model ES of portfolio returns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mES</code></td>
<td>
<p>length-(K + 1) vector of marginal contributions to Es.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cES</code></td>
<td>
<p>length-(K + 1) vector of component contributions to Es.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pcES</code></td>
<td>
<p>length-(K + 1) vector of percentage component contributions to Es.</p>
</td>
</tr>
</table>
<p>Where, K is the number of factors.
</p>


<h3>Author(s)</h3>

<p>Douglas Martin, Lingjie Yi
</p>


<h3>See Also</h3>

<p><code>fitFfm</code>
for the different factor model fitting functions.
</p>
<p><code>portSdDecomp</code> for factor model Sd decomposition.
<code>portVaRDecomp</code> for factor model VaR decomposition.
</p>


</div>