<div class="container">

<table style="width: 100%;"><tr>
<td>df2aggmat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cross-sectional aggregation matrix of a dataframe</h2>

<h3>Description</h3>

<p>This function allows the user to easily build the (<code class="reqn">n_a \times n_b</code>)
cross-sectional aggregation matrix starting from a data frame.
</p>


<h3>Usage</h3>

<pre><code class="language-R">df2aggmat(formula, data, sep = "_", sparse = TRUE, top_label = "Total",
          verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Specification of the hierarchical structure: grouped hierarchies are specified
using <code>~ g1 * g2</code> and nested hierarchies are specified using <code>~ parent / child</code>.
Mixtures of the two formulations are also possible, like <code>~ g1 * (grandparent / parent / child)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A dataset in which each column contains the values of the variables in the formula
and each row identifies a bottom level time series.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep</code></td>
<td>
<p>Character to separate the names of the aggregated series, (<em>default</em> is "<code>_</code>").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse</code></td>
<td>
<p>Option to return sparse matrices (<em>default</em> is <code>TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>top_label</code></td>
<td>
<p>Label of the top level variable (<em>default</em> is "<code>Total</code>").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If <code>TRUE</code> (<em>default</em>), hierarchy informations are printed.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A (<code>na x nb</code>) matrix.
</p>


<h3>See Also</h3>

<p>Utilities: 
<code>FoReco2matrix()</code>,
<code>aggts()</code>,
<code>balance_hierarchy()</code>,
<code>commat()</code>,
<code>csprojmat()</code>,
<code>cstools()</code>,
<code>ctprojmat()</code>,
<code>cttools()</code>,
<code>lcmat()</code>,
<code>recoinfo()</code>,
<code>res2matrix()</code>,
<code>shrink_estim()</code>,
<code>teprojmat()</code>,
<code>tetools()</code>,
<code>unbalance_hierarchy()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Balanced hierarchy
#         T
#    |--------|
#    A        B
#  |---|   |--|--|
# AA   AB  BA BB BC
# Names of the bottom level variables
data_bts &lt;- data.frame(X1 = c("A", "A", "B", "B", "B"),
                       X2 = c("A", "B", "A", "B", "C"),
                       stringsAsFactors = FALSE)
# Cross-sectional aggregation matrix
agg_mat &lt;- df2aggmat(~ X1 / X2, data_bts, sep = "", verbose = FALSE)

## Unbalanced hierarchy
#                 T
#       |---------|---------|
#       A         B         C
#     |---|     |---|     |---|
#    AA   AB   BA   BB   CA   CB
#  |----|         |----|
# AAA  AAB       BBA  BBB
# Names of the bottom level variables
data_bts &lt;- data.frame(X1 = c("A", "A", "A", "B", "B", "B", "C", "C"),
                       X2 = c("A", "A", "B", "A", "B", "B", "A", "B"),
                       X3 = c("A", "B", NA, NA, "A", "B", NA, NA),
                       stringsAsFactors = FALSE)
# Cross-sectional aggregation matrix
agg_mat &lt;- df2aggmat(~ X1 / X2 / X3, data_bts, sep = "", verbose = FALSE)

## Group of two hierarchies
#     T          T         T | A  | B  | C
#  |--|--|  X  |---|  -&gt;  ---+----+----+----
#  A  B  C     M   F       M | AM | BM | CM
#                          F | AF | BF | CF
# Names of the bottom level variables
data_bts &lt;- data.frame(X1 = c("A", "A", "B", "B", "C", "C"),
                       Y1 = c("M", "F", "M", "F", "M", "F"),
                       stringsAsFactors = FALSE)
# Cross-sectional aggregation matrix
agg_mat &lt;- df2aggmat(~ Y1 * X1, data_bts, sep = "", verbose = FALSE)

</code></pre>


</div>