<div class="container">

<table style="width: 100%;"><tr>
<td>fsm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Finite Selection Model (FSM)</h2>

<h3>Description</h3>

<p>Generates a randomized assignment of a group of units to multiple groups of pre-determined 
sizes using the Finite Selection Model (FSM).
</p>


<h3>Usage</h3>

<pre><code class="language-R">fsm(
  data_frame,
  SOM,
  s_function = "Dopt",
  Q_initial = NULL,
  eps = 0.001,
  ties = "random",
  intercept = TRUE,
  standardize = TRUE,
  units_print = TRUE,
  index_col = TRUE,
  Pol_mat = NULL,
  w_pol = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data_frame</code></td>
<td>
<p>A data frame containing a column of unit indices (optional) and covariates (or transformations thereof).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SOM</code></td>
<td>
<p>A selection order matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s_function</code></td>
<td>
<p>Specifies a selection function, a string among <code>'constant'</code>, <code>'Dopt'</code>, 
<code>'Aopt'</code>, <code>'max pc'</code>, <code>'min pc'</code>, <code>'Dopt pc'</code>, <code>'max average'</code>, <code>'min average'</code>,
<code>'Dopt average'</code>. <code>'constant'</code> selection function puts a constant value on every unselected unit. 
<code>'Dopt'</code> use the D-optimality criteria based on the full set of covariates to select units. 
<code>'Aopt'</code> uses the A-optimality criteria. <code>'max pc'</code> (respectively, <code>'min pc'</code>) selects that 
unit that has the maximum (respectively, minimum) value of the first principal component. 
<code>'Dopt pc'</code> uses the D-optimality criteria on the first principal component, <code>'max average'</code> 
(respectively, <code>'min average'</code>) selects that unit that has the maximum (respectively, minimum) 
value of the simple average of the covariates. <code>'Dopt average'</code> uses the D-optimality criteria on the 
simple average of the covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q_initial</code></td>
<td>
<p>A (optional) non-singular matrix (called 'initial matrix') that is added the <code class="reqn">(X^T X)</code> 
matrix of the choosing treatment group at any stage, when the <code class="reqn">(X^T X)</code> matrix of that treatment group
at that stage is non-invertible. If <code>FALSE</code>, the <code class="reqn">(X^T X)</code> matrix for the full set of observations is used
as the non-singular matrix. Applicable if <code>s_function = 'Dopt'</code> or <code>'Aopt'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>Proportionality constant for <code>Q_initial</code>, the default value is 0.001.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ties</code></td>
<td>
<p>Specifies how to deal with ties in the values of the selection function. If <code>ties = 'random'</code>,
a unit is selected randomly from the set of candidate units. If <code>ties = 'smallest'</code>, the unit 
that appears earlier in the data frame, i.e. the unit with the smallest index gets selected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>if <code>TRUE</code>, the design matrix of each treatment group includes a column of intercepts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>standardize</code></td>
<td>
<p>if <code>TRUE</code>, the columns of the <code class="reqn">X</code> matrix other than the column for the intercept (if any), 
are standardized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units_print</code></td>
<td>
<p>if <code>TRUE</code>, the function automatically prints the candidate units at each step of selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index_col</code></td>
<td>
<p>if <code>TRUE</code>, data_frame contains a column of unit indices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Pol_mat</code></td>
<td>
<p>Policy matrix. Applicable only when <code>s_function = 'Aopt'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w_pol</code></td>
<td>
<p>A vector of policy weights. Applicable only when <code>s_function = 'Aopt'</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list containing the following items.
</p>
<p><code>data_frame_allocated</code>:  The original data frame augmented with the column of the treatment indicator.
</p>
<p><code>som_appended</code>:  The SOM with augmented columns for the indices and covariate values for units selected.
</p>
<p><code>som_split</code>:  som_appended, split by the levels of the treatment.
</p>
<p><code>crit_print</code>:  The value of the objective function, at each stage of build up process. At each stage, 
the unit that maximizes the objective function is selected.
</p>


<h3>Author(s)</h3>

<p>Ambarish Chattopadhyay, Carl N. Morris and Jose R. Zubizarreta
</p>


<h3>References</h3>

<p>Chattopadhyay, A., Morris, C. N., and Zubizarreta, J. R. (2020), “Randomized and Balanced Allocation of 
Units into Treatment Groups Using the Finite Selection Model for <code>R</code>”.
</p>
<p>Morris, C. (1979), “A finite selection model for experimental design of the health insurance study”,
Journal of Econometrics, 11(1), 43–61.
</p>
<p>Morris, C., Hill, J. (2000), “The health insurance experiment: design using the finite selection model”, 
Public policy and statistics: case studies from RAND, Springer Science &amp; Business Media, 29–53.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load the data.
df_sample = data.frame(index = 1:12, x = c(20,30,40,40,50,60,20,30,40,40,50,60))
# Generate an SOM with N = 12, n1 = n2 = 6.
som_sample = som(n_treat = 2, treat_sizes = c(6,6), method = 'SCOMARS', control = TRUE, 
marginal_treat = rep(6/12,12))
# Assign units given the SOM.
f = fsm(data_frame = df_sample, SOM = som_sample, s_function = 'Dopt', 
eps = 0.001, ties = 'random', intercept = TRUE, standardize = TRUE, units_print = TRUE, 
index_col = TRUE)
</code></pre>


</div>