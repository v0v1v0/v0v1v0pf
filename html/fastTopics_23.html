<div class="container">

<table style="width: 100%;"><tr>
<td>embedding_plot_2d</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>PCA, t-SNE and UMAP Plots</h2>

<h3>Description</h3>

<p>Visualize the structure of the Poisson NMF loadings or
the multinomial topic model topic proportions by projection onto
a 2-d surface. <code>plot_hexbin_plot</code> is most useful for
visualizing the PCs of a data set with thousands of samples or
more.
</p>


<h3>Usage</h3>

<pre><code class="language-R">embedding_plot_2d(
  fit,
  Y,
  fill = "loading",
  k,
  fill.label,
  ggplot_call = embedding_plot_2d_ggplot_call,
  plot_grid_call = function(plots) do.call(plot_grid, plots)
)

embedding_plot_2d_ggplot_call(
  Y,
  fill,
  fill.type = c("loading", "numeric", "factor", "none"),
  fill.label,
  font.size = 9
)

pca_plot(
  fit,
  Y,
  pcs = 1:2,
  n = 10000,
  fill = "loading",
  k,
  fill.label,
  ggplot_call = embedding_plot_2d_ggplot_call,
  plot_grid_call = function(plots) do.call(plot_grid, plots),
  ...
)

tsne_plot(
  fit,
  Y,
  n = 2000,
  fill = "loading",
  k,
  fill.label,
  ggplot_call = embedding_plot_2d_ggplot_call,
  plot_grid_call = function(plots) do.call(plot_grid, plots),
  ...
)

umap_plot(
  fit,
  Y,
  n = 2000,
  fill = "loading",
  k,
  fill.label,
  ggplot_call = embedding_plot_2d_ggplot_call,
  plot_grid_call = function(plots) do.call(plot_grid, plots),
  ...
)

pca_hexbin_plot(
  fit,
  Y,
  pcs = 1:2,
  bins = 40,
  breaks = c(0, 1, 10, 100, 1000, Inf),
  ggplot_call = pca_hexbin_plot_ggplot_call,
  ...
)

pca_hexbin_plot_ggplot_call(Y, bins, breaks, font.size = 9)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>An object of class “poisson_nmf_fit” or
“multinom_topic_model_fit”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>The n x 2 matrix containing the 2-d embedding, where n is
the number of rows in <code>fit$L</code>. If not provided, the embedding
will be computed automatically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill</code></td>
<td>
<p>The quantity to map onto the fill colour of the points
in the PCA plot. Set <code>fill = "loading"</code> to vary the fill
colour according to the loadings (or topic proportions) of the
select topiced or topics. Alternatively, <code>fill</code> may be set to a
data vector with one entry per row of <code>fit$L</code>, in which case
the data are mapped to the fill colour of the points. When
<code>fill = "none"</code>, the fill colour is not varied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>The dimensions or topics selected by number or name. When
<code>fill = "loading"</code>, one plot is created per selected dimension
or topic; when <code>fill = "loading"</code> and <code>k</code> is not
specified, all dimensions or topics are plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill.label</code></td>
<td>
<p>The label used for the fill colour legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ggplot_call</code></td>
<td>
<p>The function used to create the plot. Replace
<code>embedding_plot_2d_ggplot_call</code> or <code>pca_hexbin_plot_ggplot_call</code>
with your own function to customize the appearance of the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_grid_call</code></td>
<td>
<p>When <code>fill = "loading"</code> and multiple
topics (<code>k</code>) are selected, this is the function used to
arrange the plots into a grid using <code>plot_grid</code>.
It should be a function accepting a single argument, <code>plots</code>,
a list of <code>ggplot</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill.type</code></td>
<td>
<p>The type of variable mapped to fill colour. The
fill colour is not varied when <code>fill.type = "none"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>font.size</code></td>
<td>
<p>Font size used in plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pcs</code></td>
<td>
<p>The two principal components (PCs) to be plotted,
specified by name or number.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>The maximum number of points to plot. If <code>n</code> is less
than the number of rows of <code>fit$L</code>, the rows are subsampled at
random. This argument is ignored if <code>Y</code> is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to
<code>pca_from_topics</code>, <code>tsne_from_topics</code> or
<code>umap_from_topics</code>. These additional arguments are only
used if <code>Y</code> is not provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins</code></td>
<td>
<p>Number of bins used to create hexagonal 2-d
histogram. Passed as the “bins” argument to
<code>stat_bin_hex</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>To produce the hexagonal histogram, the counts are
subdivided into intervals based on <code>breaks</code>. Passed as the
“breaks” argument to <code>cut</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is a lightweight interface primarily intended to
expedite creation of plots for visualizing the loadings or topic
proportions; most of the heavy lifting is done by
‘ggplot2’. The 2-d embedding itself is computed by invoking
<code>pca_from_topics</code>, <code>tsne_from_topics</code> or
<code>umap_from_topics</code>. For more control over the plot's
appearance, the plot can be customized by modifying the
<code>ggplot_call</code> and <code>plot_grid_call</code> arguments.
</p>
<p>An effective 2-d visualization may also require some fine-tunning
of the settings, such as the t-SNE “perplexity”, or the
number of samples included in the plot. The PCA, UMAP, t-SNE
settings can be controlled by the additional arguments
(...). Alternatively, a 2-d embedding may be pre-computed, and
passed as argument <code>Y</code>.
</p>


<h3>Value</h3>

<p>A <code>ggplot</code> object.
</p>


<h3>See Also</h3>

<p><code>pca_from_topics</code>,
<code>tsne_from_topics</code>,
<code>umap_from_topics</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)
data(pbmc_facs)

# Get the Poisson NMF and multinomial topic models fitted to the
# PBMC data.
fit1 &lt;- multinom2poisson(pbmc_facs$fit)
fit2 &lt;- pbmc_facs$fit

# Plot the first two PCs of the loadings matrix (for the
# multinomial topic model, "fit2", the loadings are the topic
# proportions).
subpop &lt;- pbmc_facs$samples$subpop
p1 &lt;- pca_plot(fit1,k = 1)
p2 &lt;- pca_plot(fit2)
p3 &lt;- pca_plot(fit2,fill = "none")
p4 &lt;- pca_plot(fit2,pcs = 3:4,fill = "none")
p5 &lt;- pca_plot(fit2,fill = fit2$L[,1])
p6 &lt;- pca_plot(fit2,fill = subpop)
p7 &lt;- pca_hexbin_plot(fit1)
p8 &lt;- pca_hexbin_plot(fit2)


# Plot the loadings using t-SNE.
p1 &lt;- tsne_plot(fit1,k = 1)
p2 &lt;- tsne_plot(fit2)
p3 &lt;- tsne_plot(fit2,fill = subpop)

# Plot the loadings using UMAP.
p1 &lt;- umap_plot(fit1,k = 1)
p2 &lt;- umap_plot(fit2)
p3 &lt;- umap_plot(fit2,fill = subpop)


</code></pre>


</div>