<div class="container">

<table style="width: 100%;"><tr>
<td>control_charts_pca</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>T2 and SPE control charts for multivariate functional data</h2>

<h3>Description</h3>

<p>This function builds a data frame needed to plot
the Hotelling's T2 and squared prediction error (SPE)
control charts
based on multivariate functional principal component analysis
(MFPCA) performed
on multivariate functional data, as Capezza et al. (2020)
for the multivariate functional covariates.
The training data have already been used to fit the model.
An optional tuning data set can be provided to estimate
the control chart limits.
A phase II data set contains the observations
to be monitored with the control charts.
</p>


<h3>Usage</h3>

<pre><code class="language-R">control_charts_pca(
  pca,
  components = NULL,
  tuning_data = NULL,
  newdata,
  alpha = 0.05,
  limits = "standard",
  seed,
  nfold = 5,
  ncores = 1,
  tot_variance_explained = 0.9,
  single_min_variance_explained = 0,
  absolute_error = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pca</code></td>
<td>
<p>An object of class <code>pca_mfd</code>
obtained by doing MFPCA on the
training set of multivariate functional data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>components</code></td>
<td>
<p>A vector of integers with the components over which
to project the multivariate functional data.
If this is not NULL, the arguments <code>single_min_variance_explained</code>
and <code>tot_variance_explained</code> are ignored.
If NULL, components are selected such that
the total fraction of variance explained by them
is at least equal to the argument <code>tot_variance_explained</code>,
where only components explaining individually a fraction of variance
at least equal to the argument <code>single_min_variance_explained</code>
are considered to be retained.
Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuning_data</code></td>
<td>
<p>An object of class <code>mfd</code> containing
the tuning set of the multivariate functional data, used to estimate the
T2 and SPE control chart limits.
If NULL, the training data, i.e. the data used to fit the MFPCA model,
are also used as the tuning data set, i.e. <code>tuning_data=pca$data</code>.
Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>An object of class <code>mfd</code> containing
the phase II set of the multivariate functional data to be monitored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>If it is a number between 0 and 1,
it defines the overall type-I error probability and the Bonferroni
correction is applied by setting the type-I error probability
in the two control charts equal to <code>alpha/2</code>.
If you want to set manually the Type-I error probabilities in the
two control charts, then the argument <code>alpha</code> must be
a named list
with two elements, named <code>T2</code> and <code>spe</code>,
respectively, each containing
the desired Type I error probability of
the corresponding control chart.
Default value is 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limits</code></td>
<td>
<p>A character value.
If "standard", it estimates the control limits on the tuning
data set. If "cv", the function calculates the control limits only on the
training data using cross-validation
using <code>calculate_cv_limits</code>. Default is "standard".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>If <code>limits=="cv"</code>,
since the split in the k groups is random,
you can fix a seed to ensure reproducibility.
Deprecated: use <code>set.seed()</code> before calling
the function for reproducibility.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfold</code></td>
<td>
<p>If <code>limits=="cv"</code>, this gives the number of groups k
used for k-fold cross-validation.
If it is equal to the number of observations in the training data set,
then we have
leave-one-out cross-validation.
Otherwise, this argument is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>If <code>limits=="cv"</code>, if you want perform the analysis
in the k groups in parallel,
give the number of cores/threads.
Otherwise, this argument is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tot_variance_explained</code></td>
<td>
<p>The minimum fraction of variance
that has to be explained
by the set of multivariate functional principal components
retained into the MFPCA model
fitted on the functional covariates.
Default is 0.9.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>single_min_variance_explained</code></td>
<td>
<p>The minimum fraction of variance
that has to be explained
by each multivariate functional principal component
such that it is retained into the MFPCA model.
Default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>absolute_error</code></td>
<td>
<p>If FALSE, the SPE statistic, which monitors the principal components
not retained in the MFPCA model, is calculated as the sum
of the integrals of the squared prediction error functions, obtained
as the difference between the actual functions and their approximation
after projection over the selected principal components.
If TRUE, the SPE statistic is calculated by replacing the square of
the prediction errors with the absolute value, as proposed by
Capizzi and Masarotto (2018).
Default value is FALSE.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>data.frame</code> with as many rows as the number of
multivariate functional observations in the phase II data set and
the following columns:
</p>

<ul>
<li>
<p> one <code>id</code> column identifying the multivariate functional observation
in the phase II data set,
</p>
</li>
<li>
<p> one <code>T2</code> column containing the Hotelling T2 statistic
calculated for all observations,
</p>
</li>
<li>
<p> one column per each functional variable,
containing its contribution to the T2 statistic,
</p>
</li>
<li>
<p> one <code>spe</code> column containing the SPE statistic calculated
for all observations,
</p>
</li>
<li>
<p> one column per each functional variable,
containing its contribution to the SPE statistic,
</p>
</li>
<li> <p><code>T2_lim</code> gives the upper control limit of
the Hotelling's T2 control chart,
</p>
</li>
<li>
<p> one <code>contribution_T2_*_lim</code> column per each
functional variable giving the
limits of the contribution of that variable
to the Hotelling's T2 statistic,
</p>
</li>
<li> <p><code>spe_lim</code> gives the upper control limit of the SPE control chart
</p>
</li>
<li>
<p> one <code>contribution_spe*_lim</code> column per each
functional variable giving the
limits of the contribution of that variable to the SPE statistic.
</p>
</li>
</ul>
<h3>References</h3>

<p>Capezza C, Lepore A, Menafoglio A, Palumbo B, Vantini S. (2020)
Control charts for
monitoring ship operating conditions and CO2 emissions
based on scalar-on-function regression.
<em>Applied Stochastic Models in Business and Industry</em>,
36(3):477â€“500.
<a href="doi:10.1002/asmb.2507">doi:10.1002/asmb.2507</a>
</p>
<p>Capizzi, G., &amp; Masarotto, G. (2018).
Phase I distribution-free analysis with the R package dfphase1.
In <em>Frontiers in Statistical Quality Control 12 (pp. 3-19)</em>.
Springer International Publishing.
</p>


<h3>See Also</h3>

<p><code>regr_cc_fof</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(funcharts)
data("air")
air &lt;- lapply(air, function(x) x[1:220, , drop = FALSE])
fun_covariates &lt;- c("CO", "temperature")
mfdobj_x &lt;- get_mfd_list(air[fun_covariates],
                         n_basis = 15,
                         lambda = 1e-2)
y &lt;- rowMeans(air$NO2)
y1 &lt;- y[1:100]
y_tuning &lt;- y[101:200]
y2 &lt;- y[201:220]
mfdobj_x1 &lt;- mfdobj_x[1:100]
mfdobj_x_tuning &lt;- mfdobj_x[101:200]
mfdobj_x2 &lt;- mfdobj_x[201:220]
pca &lt;- pca_mfd(mfdobj_x1)
cclist &lt;- control_charts_pca(pca = pca,
                             tuning_data = mfdobj_x_tuning,
                             newdata = mfdobj_x2)
plot_control_charts(cclist)

</code></pre>


</div>