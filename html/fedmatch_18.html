<div class="container">

<table style="width: 100%;"><tr>
<td>multivar_match</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Matching by computing multivar_scores based on several variables</h2>

<h3>Description</h3>

<p><code>multivar_match</code> computes a multivar_score between each pair of observations between
datasets x and y using several variables, then executes a merge by picking the
highest multivar_score pair for each observation in x.
</p>


<h3>Usage</h3>

<pre><code class="language-R">multivar_match(
  data1,
  data2,
  by = NULL,
  by.x = NULL,
  by.y = NULL,
  unique_key_1,
  unique_key_2,
  logit = NULL,
  missing = FALSE,
  wgts = NULL,
  compare_type = "diff",
  blocks = NULL,
  blocks.x = NULL,
  blocks.y = NULL,
  nthread = 1,
  top = 1,
  threshold = NULL,
  suffixes = c("_1", "_2")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data1</code></td>
<td>
<p>data.frame. First to-merge dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data2</code></td>
<td>
<p>data.frame. Second to-merge dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>character string. Variables to merge on (common across data 1 and data 2). See <code>merge</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by.x</code></td>
<td>
<p>character string. Variable to merge on in data1. See <code>merge</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by.y</code></td>
<td>
<p>character string. Variable to merge on in data2. See <code>merge</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unique_key_1</code></td>
<td>
<p>character vector. Primary key of data1 that uniquely identifies each row (can be multiple fields)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unique_key_2</code></td>
<td>
<p>character vector. Primary key of data2 that uniquely identifies each row (can be multiple fields)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logit</code></td>
<td>
<p>a glm or lm model as a result from a logit regression on a verified dataset. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missing</code></td>
<td>
<p>boolean T/F, whether or not to treat missing (NA) observations as its own binary column for each column in by. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wgts</code></td>
<td>
<p>rather than a lm model, you can supply weights to calculate multivar_score. Can be weights from <code>calculate_weights</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare_type</code></td>
<td>
<p>a vector with the same length as "by" that describes how to compare the variables. Options are "in", "indicator", "substr", "difference", "ratio", "stringdist", and "wgt_jaccard_dist". See the Multivar Matching Vignette for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocks</code></td>
<td>
<p>variable present in both data sets to "block" on before computing scores. multivar_scores will only be computed for observations that share a block. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocks.x</code></td>
<td>
<p>name of blocking variables in x. cannot supply both blocks and blocks.x</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocks.y</code></td>
<td>
<p>name of blocking variables in y. cannot supply both blocks and blocks.y</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nthread</code></td>
<td>
<p>integer. Number of cores to use when computing all combinations. See <code>parallel::makecluster()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>top</code></td>
<td>
<p>integer. Number of matches to return for each observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>numeric. Minimum score for a match to be included in the result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suffixes</code></td>
<td>
<p>see <code>merge</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The best way to understand this function is to see the vignette 'Multivar_matching'.
</p>
<p>There are two ways of performing this match: either with or without a pre-trained logit.
To use a logit, you must have a verified set of matches. The names of the variables
in this set must match the names of the variables in the data you pass into <code>multivar_match</code>.
Without a pre-trained logit, you must have a set of weights for each variable that you
want in the comparison. These can either be made up ahead of time, or you can
use a verified set of matches and <code>calculate_weights</code>.
</p>


<h3>Value</h3>

<p>a data.table, the resultant match, including columns from both data sets.
</p>


</div>