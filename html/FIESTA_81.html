<div class="container">

<table style="width: 100%;"><tr>
<td>spGetEstUnit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Spatial wrapper - Extracts point attribute values and area from a simple
feature or raster estimation unit layer.</h2>

<h3>Description</h3>

<p>Wrapper to get point attribute values and area from a simple feature or
raster layer of estimation units and calculates area. Points are reprojected
on-the-fly to projection of unit_layer using PROJ.4 transformation parameters
and sf spTransform function.  - Point attribute extraction from
simple feature (spExtractPoly) or from raster (spExtractRast) - Calculate
area by estimation unit(s) (areacalc.poly/areacalc.pixel)
</p>


<h3>Usage</h3>

<pre><code class="language-R">spGetEstUnit(
  xyplt,
  xyplt_dsn = NULL,
  uniqueid = "PLT_CN",
  unittype = "POLY",
  unit_layer,
  unit_dsn = NULL,
  unitvar = NULL,
  unit.filter = NULL,
  areavar = NULL,
  areaunits = "acres",
  keepNA = FALSE,
  returnxy = FALSE,
  showext = FALSE,
  savedata = FALSE,
  exportsp = FALSE,
  exportNA = FALSE,
  spMakeSpatial_opts = NULL,
  savedata_opts = NULL,
  vars2keep = NULL,
  gui = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xyplt</code></td>
<td>
<p>Data frame, sf object, full pathname to *.csv or *shp, or layer
name in a geodatabase. Includes XY coordinates and unique identifier.  If
non-spatial, include options in spMakeSpatial_opts parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xyplt_dsn</code></td>
<td>
<p>String. Name of database where xyplt is. The dsn varies by
driver. See gdal OGR vector formats (https://www.gdal.org/ogr_formats.html).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uniqueid</code></td>
<td>
<p>String.* Unique identifier of xyplt rows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unittype</code></td>
<td>
<p>String. Spatial layer type of unit_layer ("POLY", "RASTER").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unit_layer</code></td>
<td>
<p>String or sf object. The name of the estimation unit
layer. The layer name may be a full pathname to a file, the
basename to a file, a spatial layer name from a database, or a
SpatialPolygons object with a defined projection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unit_dsn</code></td>
<td>
<p>String. The data source name (dsn; i.e., folder or database
name) of unit_layer. The dsn varies by driver. See gdal OGR vector formats
(https://www.gdal.org/ogr_formats.html). Optional.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitvar</code></td>
<td>
<p>String. Name of estimation unit variable in unit_layer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unit.filter</code></td>
<td>
<p>String. Filter to subset unit_layer spatial layer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>areavar</code></td>
<td>
<p>String. Name of area variable unit variable in unit_layer. If
NULL, calculates area by unitvar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>areaunits</code></td>
<td>
<p>String. Output area units ("acres", "hectares",
"sqmeters").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keepNA</code></td>
<td>
<p>Logical. If TRUE, returns data frame of NA values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnxy</code></td>
<td>
<p>Logical. If TRUE, returns xy data as sf object (spxyplt).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showext</code></td>
<td>
<p>Logical. If TRUE, layer extents are displayed in plot window.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedata</code></td>
<td>
<p>Logical. If TRUE, the input data with extracted values are
saved to outfolder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exportsp</code></td>
<td>
<p>Logical. If TRUE, the extracted strata point data are
exported to outfolder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exportNA</code></td>
<td>
<p>Logical. If TRUE, NA values are exported to outfolder.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spMakeSpatial_opts</code></td>
<td>
<p>List. See help(spMakeSpatial_options()) for a list
of options. Use to convert X/Y values to simple feature (sf) coordinates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedata_opts</code></td>
<td>
<p>List. See help(savedata_options()) for a list
of options. Only used when savedata = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars2keep</code></td>
<td>
<p>String vector. Attributes in SAdoms, other than domvar to
include in dunitlut output and extract to pltassgn points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gui</code></td>
<td>
<p>Logical. If gui, user is prompted for parameters.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>*If variable = NULL, then it will prompt user for input.
</p>
<p>If there is a raster and simple feature layer, and the projection of the
simple feature is different than the projection of the raster, the
simple feature object is transformed to the projection of raster (See note
about on-the-fly projection conversion).
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pltunit</code></td>
<td>
<p> Data frame. Input point data with extracted
estimation unit and strata values appended. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sppltunit</code></td>
<td>

<p>SpatialPointsDataframe. Spatial point data with extracted estimation unit
values appended. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitarea</code></td>
<td>
<p> Data frame. Area by estimation unit. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitvar</code></td>
<td>
<p> Data frame. Variable name for estimation unit in unitarea. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>acrevar</code></td>
<td>
<p> Data frame. Variable name for area in unitarea. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pltassgnid</code></td>
<td>
<p> String. Unique identifier of plot. </p>
</td>
</tr>
</table>
<p>If savedata=TRUE, pltstrat and unitarea are saved to outfolder (Default
name: *_'date'.csv).  If exportshp=TRUE, the SpatialPointsDataFrame object
is exported to outfolder (Default name: datext_'date'.shp). Variable names
are truncated to 10 characters or less (See note below). Name changes are
output to 'outfn'_newnames_'data'.csv in outfolder.
</p>


<h3>Note</h3>

<p>If exportsp=TRUE:<br> If out_fmt="shp", the st_write (sf) function is
called. The ArcGIS driver truncates variable names to 10 characters or less.
Variable names are changed before export using an internal function
(trunc10shp). If Spatial object has more than 1 record, it will be returned
but not exported.
</p>
<p>On-the-fly projection conversion<br> The spTransform (sf) method is used
for on-the-fly map projection conversion and datum transformation using
PROJ.4 arguments. Datum transformation only occurs if the +datum tag is
present in the both the from and to PROJ.4 strings. The +towgs84 tag is used
when no datum transformation is needed. PROJ.4 transformations assume NAD83
and WGS84 are identical unless other transformation parameters are
specified.  Be aware, providing inaccurate or incomplete CRS information may
lead to erroneous data shifts when reprojecting. See spTransform help
documentation for more details.
</p>
<p>unitarea<br> Area by estimation unit is calculated and returned as object
named unitarea.  Area is based on the projection of unit_layer. If no
unit_layer input, than area is calculated from pixel counts.
</p>


<h3>Author(s)</h3>

<p>Tracey S. Frescino, Chris Toney
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Set up data from FIESTA
WYbhfn &lt;- system.file("extdata",
                      "sp_data/WYbighorn_adminbnd.shp",
                      package = "FIESTA")
                      
# Create a `SpatialPoints` object from `WYplt`
WYspplt &lt;- spMakeSpatialPoints(xyplt = WYplt, 
                               xy.uniqueid = "CN", 
                               xvar = "LON_PUBLIC", 
                               yvar = "LAT_PUBLIC", 
                               xy.crs = 4269)
                               
# Get estimation unit acres for Bighorn National Forest
spGetEstUnit(xyplt = WYplt, 
             uniqueid = "CN", 
             unit_layer = WYbhfn, 
             spMakeSpatial_opts = list(xvar = "LON_PUBLIC", 
                                       yvar = "LAT_PUBLIC", 
                                       xy.crs = 4269))
</code></pre>


</div>