<div class="container">

<table style="width: 100%;"><tr>
<td>msfit.flexsurvreg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cumulative intensity function for parametric multi-state models</h2>

<h3>Description</h3>

<p>Cumulative transition-specific intensity/hazard functions for
fully-parametric multi-state or competing risks models, using a
piecewise-constant approximation that will allow prediction using the
functions in the <span class="pkg">mstate</span> package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">msfit.flexsurvreg(
  object,
  t,
  newdata = NULL,
  variance = TRUE,
  tvar = "trans",
  trans,
  B = 1000
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Output from <code>flexsurvreg</code> or
<code>flexsurvspline</code>, representing a fitted survival model object.
</p>
<p>The model should have been fitted to data consisting of one row for each
observed transition and additional rows corresponding to censored times to
competing transitions.  This is the "long" format, or counting process
format, as explained in the <span class="pkg">flexsurv</span> vignette.
</p>
<p>The model should contain a categorical covariate indicating the transition.
In <code>flexsurv</code> this variable can have any name, indicated here by the
<code>tvar</code> argument.  In the Cox models demonstrated by <span class="pkg">mstate</span> it is
usually included in model formulae as <code>strata(trans)</code>, but note that
the <code>strata</code> function does not do anything in <span class="pkg">flexsurv</span>.  The
formula supplied to <code>flexsurvreg</code> should be precise about which
parameters are assumed to vary with the transition type.
</p>
<p>Alternatively, if the parameters (including covariate effects) are assumed
to be different between different transitions, then a list of
transition-specific models can be formed.  This list has one component for
each permitted transition in the multi-state model.  This is more
computationally efficient, particularly for larger models and datasets.
See the example below, and the vignette.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>Vector of times.  These do not need to be the same as the observed
event times, and since the model is parametric, they can be outside the
range of the data.  A grid of more frequent times will provide a better
approximation to the cumulative hazard trajectory for prediction with
<code>probtrans</code> or <code>mssample</code>, at the
cost of greater computational expense.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>A data frame specifying the values of covariates in the
fitted model, other than the transition number.  This must be specified if
there are other covariates. The variable names should be the same as those
in the fitted model formula.  There must be either one value per covariate
(the typical situation) or <code class="reqn">n</code> values per covariate, a different one
for each of the <code class="reqn">n</code> allowed transitions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance</code></td>
<td>
<p>Calculate the variances and covariances of the transition
cumulative hazards (<code>TRUE</code> or <code>FALSE</code>).  This is based on
simulation from the normal asymptotic distribution of the estimates, which
is computationally-expensive.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tvar</code></td>
<td>
<p>Name of the categorical variable in the model formula that
represents the transition number.  This should have been defined as a factor,
with factor levels that 
correspond to elements of <code>trans</code>, conventionally a sequence of
integers starting from 1.  Not required if <code>x</code> is a list of
transition-specific models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trans</code></td>
<td>
<p>Matrix indicating allowed transitions in the multi-state
model, in the format understood by <span class="pkg">mstate</span>: a matrix of integers whose
<code class="reqn">r,s</code> entry is <code class="reqn">i</code> if the <code class="reqn">i</code>th transition type (reading across
rows) is <code class="reqn">r,s</code>, and has <code>NA</code>s on the diagonal and where the
<code class="reqn">r,s</code> transition is disallowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>Number of simulations from the normal asymptotic distribution used
to calculate variances.  Decrease for greater speed at the expense of
accuracy.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>"msfit"</code>, in the same form as the objects
used in the <span class="pkg">mstate</span> package.  The <code>msfit</code> method
from <span class="pkg">mstate</span> returns the equivalent cumulative intensities for Cox
regression models fitted with <code>coxph</code>.
</p>


<h3>Author(s)</h3>

<p>C. H. Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a>
</p>


<h3>References</h3>

<p>Liesbeth C. de Wreede, Marta Fiocco, Hein Putter (2011).
<span class="pkg">mstate</span>: An R Package for the Analysis of Competing Risks and
Multi-State Models. <em>Journal of Statistical Software</em>, 38(7), 1-30.
<a href="https://doi.org/10.18637/jss.v038.i07">doi:10.18637/jss.v038.i07</a>
</p>
<p>Mandel, M. (2013). "Simulation based confidence intervals for functions
with complicated derivatives." The American Statistician 67(2):76-81
</p>


<h3>See Also</h3>

<p><span class="pkg">flexsurv</span> provides alternative functions designed
specifically for predicting from parametric multi-state models without
calling <span class="pkg">mstate</span>.  These include <code>pmatrix.fs</code> and
<code>pmatrix.simfs</code> for the transition probability matrix, and
<code>totlos.fs</code> and <code>totlos.simfs</code> for expected total
lengths of stay in states.  These are generally more efficient than going
via <span class="pkg">mstate</span>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## 3 state illness-death model for bronchiolitis obliterans
## Compare clock-reset / semi-Markov multi-state models

## Simple exponential model (reduces to Markov)

bexp &lt;- flexsurvreg(Surv(years, status) ~ trans,
                    data=bosms3, dist="exp")
tmat &lt;- rbind(c(NA,1,2),c(NA,NA,3),c(NA,NA,NA))
mexp &lt;- msfit.flexsurvreg(bexp, t=seq(0,12,by=0.1),
                          trans=tmat, tvar="trans", variance=FALSE)

## Cox semi-parametric model within each transition

bcox &lt;- coxph(Surv(years, status) ~ strata(trans), data=bosms3)

if (require("mstate")){

mcox &lt;- mstate::msfit(bcox, trans=tmat)

## Flexible parametric spline-based model 

bspl &lt;- flexsurvspline(Surv(years, status) ~ trans + gamma1(trans),
                       data=bosms3, k=3)
mspl &lt;- msfit.flexsurvreg(bspl, t=seq(0,12,by=0.1),
                         trans=tmat, tvar="trans", variance=FALSE)

## Compare fit: exponential model is OK but the spline is better

plot(mcox, lwd=1, xlim=c(0, 12), ylim=c(0,4))
cols &lt;- c("black","red","green")
for (i in 1:3){
    lines(mexp$Haz$time[mexp$Haz$trans==i], mexp$Haz$Haz[mexp$Haz$trans==i],
             col=cols[i], lwd=2, lty=2)
    lines(mspl$Haz$time[mspl$Haz$trans==i], mspl$Haz$Haz[mspl$Haz$trans==i],
             col=cols[i], lwd=3)
}
legend("topright", lwd=c(1,2,3), lty=c(1,2,1),
   c("Cox", "Exponential", "Flexible parametric"), bty="n")

}

## Fit a list of models, one for each transition
## More computationally efficient, but only valid if parameters
## are different between transitions.

## Not run: 
bexp.list &lt;- vector(3, mode="list")
for (i in 1:3) { 
  bexp.list[[i]] &lt;- flexsurvreg(Surv(years, status) ~ 1, subset=(trans==i),
                                data=bosms3, dist="exp")
}

## The list of models can be passed to this and other functions,
## as if it were a single multi-state model. 

msfit.flexsurvreg(bexp.list, t=seq(0,12,by=0.1), trans=tmat)

## End(Not run)

</code></pre>


</div>