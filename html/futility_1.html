<div class="container">

<table style="width: 100%;"><tr>
<td>completeTrial.byArm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Treatment Arm-Specific Simulation-Based Completion of a Randomized Efficacy Trial with a Time-to-Event Endpoint and Fixed Follow-up Using an Interim Data-set</h2>

<h3>Description</h3>

<p>Considers MITT data collected through an interim timepoint and generates independent time-to-event data-sets, by treatment arm, to assess the distribution of the number of treatment arm-specific endpoints
at the end of the follow-up period. A Bayesian model for treatment arm-specific endpoint rates is used for generating future data (see the vignette).
</p>


<h3>Usage</h3>

<pre><code class="language-R">completeTrial.byArm(interimData, nTrials, trtNames, N, enrollRate = NULL,
  enrollRatePeriod, eventPriorWeight, eventPriorRate,
  fixedDropOutRate = NULL, ppAnalysis = FALSE, missVaccProb = NULL,
  ppAtRiskTimePoint = NULL, fuTime, visitSchedule,
  visitSchedule2 = NULL, saveFile = NULL, saveDir = NULL,
  randomSeed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>interimData</code></td>
<td>
<p>a data frame capturing observed MITT data at an interim timepoint that contains one row per enrolled participant in the MITT cohort and the following variables: <code>arm</code> (treatment arm), <code>schedule2</code> (an indicator that a participant follows the <code>visitSchedule2</code> schedule, e.g., participants who discontinue study product administration may remain in primary follow-up on a different schedule), <code>entry</code> (number of weeks since the reference date until the enrollment date), <code>exit</code> (number of weeks since the reference date until the trial exit date defined as the date of either infection diagnosis, dropout, or primary follow-up completion, whichever occurs first; <code>NA</code> for participants still in primary follow-up), <code>last_visit_dt</code> (number of weeks since the reference date until the last visit date), <code>event</code> (event indicator), <code>dropout</code> (dropout indicator), <code>complete</code> (indicator of completed follow-up), <code>followup</code> (indicator of being in primary follow-up). The reference date is defined as the enrollment date of the first participant. The variables <code>entry</code>, <code>exit</code>, and <code>last_visit_dt</code> use week as the unit of time. Month is defined as 52/12 weeks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nTrials</code></td>
<td>
<p>the number of trials to be simulated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trtNames</code></td>
<td>
<p>a character vector of treatment labels as specified in <code>interimData$arm</code> determining the order of treatment arms in other input arguments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>a numeric vector specifying the target number of enrolled participants in each treatment arm, with the arms in the same order as in <code>trtNames</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enrollRate</code></td>
<td>
<p>a treatment arm-pooled weekly enrollment rate used for completing enrollment if <code>interimData</code>'s enrollment is incomplete. If <code>NULL</code> (default), the rate is calculated as the average over the last <code>enrollRatePeriod</code> weeks of enrollment in <code>interimData</code>. If equal to a numeric value, then <code>enrollRatePeriod</code> is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enrollRatePeriod</code></td>
<td>
<p>the length (in weeks) of the time period preceding the time of the last enrolled participant in <code>interimData</code> that the average weekly enrollment rate will be based on and used for completing enrollment. If <code>NULL</code> (default), then <code>enrollRate</code> must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eventPriorWeight</code></td>
<td>
<p>a numeric value in <code class="reqn">[0,1]</code> representing a weight assigned to the prior gamma distribution of the treatment arm-specific event rates at the time when 50% of the estimated person-time at risk in each arm has been accumulated (see the vignette)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eventPriorRate</code></td>
<td>
<p>a numeric vector of treatment arm-specific prior mean incidence rates for the endpoint, expressed as numbers of events per person-year at risk, with the arms in the same order as in <code>trtNames</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixedDropOutRate</code></td>
<td>
<p>the pre-trial assumed annual treatment arm-pooled dropout rate. If <code>NULL</code> (default), then the observed treatment arm-pooled dropout rate is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppAnalysis</code></td>
<td>
<p>a logical value (<code>FALSE</code> by default) indicating whether an indicator of membership in the per-protocol cohort shall be generated based on complete MITT data. If <code>TRUE</code>, then <code>interimData</code> must include two additional variables: <code>missVacc</code> (an indicator of a missed vaccination) and <code>pp</code> (an indicator of membership in the per-protocol cohort; <code>NA</code> for participants with an indeterminate status).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missVaccProb</code></td>
<td>
<p>a probability that a participant misses at least one vaccination. If <code>NULL</code> (default) and <code>ppAnalysis=TRUE</code>, then <code>missVaccProb</code> is calculated as the sample proportion of MITT participants in <code>interimData</code> with a missed vaccination using the <code>missVacc</code> variable. If <code>ppAnalysis=TRUE</code>, then the indicator of a missed vaccination for participants in <code>interimData</code> with <code>pp=NA</code> and future enrolled participants is sampled from the Bernoulli distribution with probability <code>missVaccProb</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppAtRiskTimePoint</code></td>
<td>
<p>a minimal follow-up time (in weeks) for a participant to qualify for inclusion in the per-protocol cohort (<code>NULL</code> by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fuTime</code></td>
<td>
<p>a follow-up time (in weeks) of each participant</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>visitSchedule</code></td>
<td>
<p>a numeric vector of visit weeks at which testing for the endpoint is conducted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>visitSchedule2</code></td>
<td>
<p>a numeric vector of visit weeks at which testing for the endpoint is conducted in a subset of participants (e.g., those who discontinue administration of the study product but remain in follow-up). If <code>NULL</code> (default), everyone is assumed to follow <code>visitSchedule</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveFile</code></td>
<td>
<p>a character string specifying an <code>.RData</code> file storing the output list. If <code>NULL</code> and <code>saveDir</code> is specified, the file name will be generated. If, in turn, <code>saveFile</code> is specified but <code>saveDir</code> equals <code>NULL</code>, then <code>saveFile</code> is ignored, and the output list will be returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>saveDir</code></td>
<td>
<p>a character string specifying a path for the output directory. If supplied, the output is saved as an <code>.RData</code> file in the directory; otherwise the output is returned as a list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>randomSeed</code></td>
<td>
<p>seed of the random number generator for simulation reproducibility</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>If <code>saveDir</code> is specified, the output list (named <code>trialObj</code>) is saved as an <code>.RData</code> file; otherwise it is returned. The output object is a list with the following components:
</p>

<ul>
<li> <p><code>trialData</code>: a list with <code>nTrials</code> components each of which is a <code>data.frame</code> with the variables <code>arm</code>, <code>entry</code>, <code>exit</code>, <code>event</code>, and <code>dropout</code> storing the treatment assignments, enrollment times, study exit times, event indicators, and dropout indicators, respectively. The observed follow-up times can be recovered as <code>exit</code> - <code>entry</code>. If <code>ppAnalysis=TRUE</code>, then the indicators of belonging to the per-protocol cohort (named <code>pp</code>) are included.
</p>
</li>
<li> <p><code>nTrials</code>: the number of simulated trials
</p>
</li>
<li> <p><code>N</code>: the total number of enrolled trial participants
</p>
</li>
<li> <p><code>rates</code>: a list with three components:
</p>

<ul>
<li> <p><code>enrollRate</code>: the treatment arm-pooled <em>weekly</em> enrollment rate
</p>
</li>
<li> <p><code>dropRate</code>: <code>fixedDropOutRate</code>, or, if <code>NULL</code>, the <em>annual</em> treatment arm-pooled dropout rate in <code>interimData</code>
</p>
</li>
<li> <p><code>eventPostRate</code>: a list with <code>length(trtNames)</code> components (labeled by the levels of the <code>arm</code> variable in <code>interimData</code>) each of which is a numeric vector of length <code>nTrials</code> of the sampled treatment arm-specific posterior <em>annual</em> event rates
</p>
</li>
</ul>
</li>
<li> <p><code>BetaOverBetaPlusTk</code>: a list with <code>length(trtNames)</code> components (labeled by the levels of the <code>arm</code> variable in <code>interimData</code>) each of which is the arm-specific weight placed on the prior mean event rate
</p>
</li>
<li> <p><code>TkOverTstar</code>: a list with <code>length(trtNames)</code> components (labeled by the levels of the <code>arm</code> variable in <code>interimData</code>) each of which is the ratio of the observed arm-specific person-time at risk to the estimated total arm-specific person-time at risk, with the arm-specific event rates set equal to the components of <code>eventPriorRate</code> in the estimator for the total arm-specific person-time at risk
</p>
</li>
<li> <p><code>randomSeed</code>: seed of the random number generator for simulation reproducibility
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>completeTrial.pooledArms</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">arm &lt;- rep(c("C3","T1","T2"), each=250)
schedule &lt;- rbinom(length(arm), 1, 0.01)
entry &lt;- rpois(length(arm), lambda=60)
entry &lt;- entry - min(entry)
last_visit_dt &lt;- entry + runif(length(arm), min=0, max=80)
event &lt;- rbinom(length(arm), 1, 0.01)
dropout &lt;- rbinom(length(arm), 1, 0.02)
dropout[event==1] &lt;- 0
exit &lt;- rep(NA, length(arm))
exit[event==1] &lt;- last_visit_dt[event==1] + 5
exit[dropout==1] &lt;- last_visit_dt[dropout==1] + 5
followup &lt;- ifelse(event==1 | dropout==1, 0, 1)
interimData &lt;- data.frame(arm=arm, schedule2=schedule, entry=entry, exit=exit,
last_visit_dt=last_visit_dt, event=event, dropout=dropout, complete=0, followup=followup)

completeData &lt;- completeTrial.byArm(interimData=interimData, nTrials=5,
trtNames=c("C3","T1","T2"), N=c(500,500,500), enrollRatePeriod=24, eventPriorWeight=0.5,
eventPriorRate=c(0.001,0.0004,0.0004), fuTime=80, visitSchedule=seq(0, 80, by=4),
visitSchedule2=c(0,seq(from=8,to=80,by=12)), randomSeed=9)
### alternatively, to save the .RData output file (no '&lt;-' needed):
completeTrial.byArm(interimData=interimData, nTrials=5, trtNames=c("C3","T1","T2"),
N=c(500,500,500), enrollRatePeriod=24, eventPriorWeight=0.5,
eventPriorRate=c(0.001,0.0004,0.0004), fuTime=80, visitSchedule=seq(0, 80, by=4),
visitSchedule2=c(0,seq(from=8,to=80,by=12)), saveDir="./", randomSeed=9)

</code></pre>


</div>